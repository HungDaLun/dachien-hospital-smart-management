# 企業 AI 知識庫與 Agent 管理平台 - 網站規格書 (System Specification) v1.2

**文件版本：** 1.2
**日期：** 2026-01-02
**專案名稱：** Enterprise AI Knowledge Agent Platform (EAKAP)
**核心技術：** 
1. **Primary Storage**: S3-compatible Object Storage (Generic Source of Truth) - AWS S3 (Cloud) or **MinIO (Local Appliance)**
2. **Runtime Engine**: Google Gemini 1.5/2.0 API (File Search & Gems Concept) with Multi-Model Adapter Design
3. **Visualization Engine**: React Flow / D3.js for DIKW Graph

---

## 1. 專案概述 (Project Overview)

### 1.1 目標 (Vision)
打造一個企業級的「AI Agent 工廠與知識運籌中心」。本平台旨在解決企業導入 AI 時面臨的「知識分散」、「操作標準不一」與「權限失控」三大痛點。
本專案採用 **「Hub and Spoke (軸輻式)」** 架構：以自建儲存為核心 (Hub)，動態同步至各類 AI 模型 (Spoke)。首階段導入 Gemini File Search 技術作為主要運算引擎，但保留未來隨時切換至 OpenAI/Claude 等模型的彈性，確保企業擁有資料主權。

### 1.2 核心價值主張
1.  **集中化知識管理**：單一來源（Single Source of Truth），避免同樣的文件在不同 Agent 間重複上傳且版本不一。
2.  **標準化 Agent 產出**：透過統一的 System Prompt 與強制的知識庫綁定，確保全公司產出品質一致。
3.  **精細化權限控管**：結合 Role-Based Access Control (RBAC) 與標籤系統，確保「對的人用對的 Agent，讀對的資料」。
3.  **精細化權限控管**：結合 Role-Based Access Control (RBAC)、部門圍籬與標籤系統，確保「對的人用對的 Agent，讀對的資料」。
4.  **DIKW 知識可視化**：將 Data (資料) -> Information (資訊) -> Knowledge (知識) -> Wisdom (智慧) 的轉化過程具象化，建立企業大腦的成長回饋迴圈。
5.  **部門知識即戰力 (Department as a Brain)**：支援以「組織架構」為單位的知識綁定，解決企業各部門數據孤島問題，讓跨部門協作更高效。

---

## 2. 系統架構 (System Architecture)

### 2.1 高層次架構圖 (High-Level Design - Hub & Spoke)

```mermaid
graph TD
    User[使用者 (Web)] -->|HTTPS| Frontend[前端 Next.js]
    Frontend -->|API| Backend[後端 API Gateway]
    
    subgraph SovereignZone[企業自有資產區 (Hub)]
        Backend --> Auth[權限管理系統]
        Backend --> AgentMgr[Agent 配置管理器]
        Backend --> FrameworkEngine[動態框架引擎 (New)]
        Backend --> DB[(PostgreSQL)]
        Backend --> S3[(S3 Storage)]
    end
    
    subgraph SmartWorker[AI 館長與加工廠]
        Files[上傳檔案] -->|Auto-Tag Dept| DeptPool[部門知識池]
        Files -->|Parse & Clean| Markdown[Markdown 轉換]
        Markdown -->|Extract| Info[資訊萃取]
        Info -->|Fill| Knowledge[知識框架填充]
    end
    
    subgraph RuntimeGemini[AI 運算層 (Spoke)]
        Backend -.->|Sync| G_Storage[Gemini File Storage]
        Backend -->|Generate| G_Model[Gemini Models]
        G_Model <-->|Retrieval| G_Storage
    end
```

### 2.2 核心流程邏輯 (The Knowledge Pipeline)
1.  **資料上傳 (Ingestion)**：
    *   使用者上傳原始檔案 (PDF/Doc) 至 S3。
    *   觸發 **AI 館長 (Librarian Worker)**：
        *   **Step A (清洗)**：將原始檔轉為純淨 Markdown，去除雜訊。
        *   **Step A (清洗)**：將原始檔轉為純淨 Markdown，去除雜訊。
        *   **Step B (治理)**：AI 分析內容，建議檔名與分類（如 `A2-Product-Spec.md`），需人工確認。同時自動根據上傳者身份，打上「部門標籤」。
        *   **Step C (萃取)**：AI 掃描檔案中的關鍵資訊，填入動態知識框架 (如 SWOT)。
2.  **知識同步 (Sync)**：
    *   將「清洗後的 Markdown」同步至 Gemini File Search，確保 AI 讀到的是高品質資料。
3.  **Agent 建構**：管理員設定 Prompt + 選擇需要的 `Tags` 或直接綁定 `Department` + **綁定技能 (Skills)**。
    *   **AI 顧問 (Advisor)**：若不確定該如何設定，可詢問 AI 顧問，它會根據目標（如「我想做個報價助手」）推薦應勾選的知識文件。
4.  **對話執行 (Runtime)**：
    *   使用者發送訊息。
    *   Agent 依據 Skills 設定，強制調用知識庫工具 (Grounding)。
    *   Gemini API 進行回答並標註引用來源。

### 2.3 外部整合架構 (Enterprise Brain Integration)
本平台作為「Headless Knowledge Service」，提供標準介面供外部工具調用 (OpenAI-Compatible API)。

---

## 3. 使用者角色與權限 (User Roles & Permissions)

(維持原案，無變更)
| 角色 | 代號 | 權限描述 | 典型使用者 |
| :--- | :--- | :--- | :--- |
| **超級管理員** | `SUPER_ADMIN` | **全能權限**。可管理所有部門、所有 Agent、所有文件、所有人員設定。 | 知識長 (CKO)、IT 主管 |
| **部門管理員** | `DEPT_ADMIN` | **部門級全權**。僅能管理所屬部門的 Agent 與文件。無法看見其他部門資料。 | 部門主管 |
| **知識維護者** | `EDITOR` | **僅維護內容**。可上傳/更新/刪除文件，在聊天室測試 Agent，但**不可修改 Agent 的 System Prompt**。 | 資深員工、專案經理 |
| **一般使用者** | `USER` | **僅使用**。只能與被授權的 Agent 對話。無法接觸後台。 | 一般員工、實習生 |

---

## 4. 功能模組規格 (Functional Requirements)

### 4.1 身份驗證與授權模組 (IAM)
(維持原案)

### 4.2 知識庫管理系統 (KMS) - "The Brain"
此模組負責管理原本構想中的「15 個資料夾」，但透過**標籤 (Tags)** 讓結構更靈活。

*   **F-04 多格式文件上傳與清洗**：
    *   上傳後自動觸發 **Gemini Flash** 直讀轉換，生成 `markdown_content`。
    *   提供「原檔預覽」與「AI 閱讀版預覽」對照。
*   **F-05 智慧治理建議**：
    *   系統自動分析內容，建議標準化命名（部門+名稱+版本）。
    *   **部門自動歸戶**：檔案上傳時自動繼承上傳者之 Department ID，實現「零操作」的部門知識庫建立。
    *   使用者只需點擊「接受建議」即可完成規範化存檔。
*   **F-06 動態框架引擎 (Dynamic Framework Engine)** 【NEW】：
    *   **定義管理**：後台可新增 JSON 定義的知識框架（如 SWOT, PESTLE）。
    *   **自動填表**：每當新文件上傳，系統自動嘗試將資訊填入相關框架的 Slot 中。
    *   **框架狀態**：記錄每個框架實例的「完整度 (Completeness)」與「信心度 (Confidence)」。

### 4.3 Agent 建構工廠 (Agent Ops) - "The Factory"
*   **F-09 Agent 規則引擎升級**：
    *   **混合綁定策略**：
        *   `By Folder`: 綁定特定目錄。
        *   `By Tag`: 綁定特定主題 (如 #2024Q1)。
        *   `By Department` 【NEW】: 一鍵綁定整個部門與其下屬子部門的所有文件 (如「綁定：財務部」)。
*   **F-20 AI 建構顧問 (Agent Architect)** 【NEW】：
    *   **深度意圖分析**：使用者輸入自然語言（e.g.,「我想做一個能幫業務快速回應客戶抱怨的助理」）。
    *   **專業策略推薦**：AI 顧問分析後回覆：「建議綁定『客服部/QA手冊』與『業務部/產品規格書』」。
    *   **Prompt Engineering 自動化**：
        *   系統不只設定參數，而是直接**生成一份結構完整的「System Prompt (系統指令)」**。
        *   **指令結構規範** (參考 K-0 標準)：包含 `角色與使命`、`知識庫調用規則` (當 User 問 A 時查 B 文件)、`輸出格式規範`、`思考路徑 (Chain of Thought)` 與 `法規/合規邊界`。
        *   這確保了 Agent 不只是「會講話」，而是「有紀律」地執行任務。
    *   **一鍵套用**：使用者檢視生成的指令後，點擊確認即可完成 Agent 設置。

### 4.4 前台對話介面 (Chat UI) - "The Interface"
(維持原案)

### 4.5 企業大腦戰情室 (Brain Dashboard) 【NEW】
*   **F-17 DIKW 星系圖 (Galaxy View)**：
    *   **視覺化**：首頁顯示 Data -> Info -> Knowledge -> Wisdom 同心圓互動圖。
    *   **動態回饋**：上傳文件時，顯示光線傳輸動畫，點亮對應的知識節點。
    *   **鑽取 (Drill-down)**：點擊亮起的節點 (如 SWOT)，展開詳細卡片，顯示 AI 填寫的內容與引用來源。
    *   **解鎖提示**：告訴使用者「再上傳一份競品價格表，即可解鎖『定價策略建議』」。

---

## 5. 資料庫設計概念 (Schema Concept)

### 核心變更：新增動態框架支援 (JSONB)

```sql
-- 知識框架定義 (Meta-Frameworks)
-- 用於定義 SWOT, PESTLE 等結構，不寫死欄位
TABLE knowledge_frameworks (
  id UUID PRIMARY KEY,
  name VARCHAR(100),       -- e.g., "SWOT Analysis"
  description TEXT,
  structure_schema JSONB,  -- e.g., { "sections": ["Strengths", "Weaknesses",...] }
  visual_type VARCHAR(50)  -- e.g., "quadrant", "list", "timeline"
);

-- 知識實例 (Knowledge Instances)
-- 儲存 AI 填寫的內容
TABLE knowledge_instances (
  id UUID PRIMARY KEY,
  framework_id UUID REFERENCES knowledge_frameworks(id),
  target_subject VARCHAR(200), -- e.g., "Competitor X", "Q1 Strategy"
  content_data JSONB,          -- e.g., { "Strengths": ["Good price"], "Weaknesses": [...] }
  completeness_score FLOAT,    -- 0.0 - 1.0
  confidence_score FLOAT,      -- 0.0 - 1.0
  source_file_ids UUID[],      -- 關聯的原始檔案 ID (Data Lineage)
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

-- 既有 Files 表增加清洗後內容
-- 既有 Files 表增加清洗後內容
ALTER TABLE files ADD COLUMN markdown_content TEXT; -- 存放 AI 轉譯後的乾淨文本
ALTER TABLE files ADD COLUMN metadata_analysis JSONB; -- 存放 AI 分析後的治理建議
ALTER TABLE files ADD COLUMN department_id UUID REFERENCES departments(id); -- 【NEW】部門歸屬，支援快速篩選與權限控制
```

---

## 6. 非功能需求 (Non-functional Requirements)
(維持原案，強調 UX 動畫流暢度)

---

## 7. 開發時程預估 (Roadmap)

### Phase 1: MVP (資料流與基礎對話) - 預計 4 週
*   Week 1: 環境與上傳上傳基礎。
*   Week 2: **AI 館長 Pipeline** (PDF -> Markdown 轉換與自動命名建議)。
*   Week 3: 基礎 Chat 與 Agent 設定。
*   Week 4: 整合測試與上線。

### Phase 2: 企業大腦視覺化 (DIKW Engine) - 預計 6 週 【NEW】
*   Week 5: **動態框架引擎** (資料庫 Schema 與 Knowledge Mapper Agent)。
*   Week 6: **DIKW 前端星系圖** (React Flow 整合)。
*   Week 7: 實作 SWOT 與 VPC 兩個核心框架的自動填寫邏輯。
*   Week 8: 引用來源與信心度視覺化。
*   Week 9-10: 優化動畫效果與「解鎖」體驗。

---

## 8. 一體機落地部署指南
(維持原案)

---

## 9. 前端設計規範
(維持原案)

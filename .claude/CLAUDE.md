# EAKAP é€²éšçŸ¥è­˜æ¶æ§‹ç³»çµ±è¨­è¨ˆ
**ç‰ˆæœ¬ï¼š** v3.1
**å»ºç«‹æ—¥æœŸï¼š** 2026-01-01
**æœ€å¾Œæ›´æ–°ï¼š** 2026-01-06
**è¨­è¨ˆç›®æ¨™ï¼š** å»ºç«‹ä¸€å¥—æ¥µåº¦å°ˆæ¥­ã€å…·æŠ€è¡“èˆ‡å…§å®¹é–€æª»çš„çŸ¥è­˜æ¶æ§‹ç³»çµ±ï¼Œè®“ AI Agent èƒ½ç²¾æº–è§£è®€èˆ‡é‹ç”¨ä¼æ¥­çŸ¥è­˜

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

### æ ¸å¿ƒåƒ¹å€¼ä¸»å¼µ

æœ¬ç³»çµ±ä¸åƒ…åƒ…æ˜¯æ–‡ä»¶åˆ†é¡ç³»çµ±ï¼Œè€Œæ˜¯ä¸€å¥—**ã€Œèªç¾©çŸ¥è­˜æ¶æ§‹å¼•æ“ã€**ï¼Œå…·å‚™ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š

#### åŸºç¤èƒ½åŠ›ï¼ˆv2.0ï¼‰
1. **å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•**ï¼šè¶…è¶Šå‚³çµ±åˆ†é¡ï¼Œå»ºç«‹èªç¾©ã€æ™‚åºã€é—œè¯ã€æ¬Šé‡å››ç¶­ç´¢å¼•
2. **æ™ºèƒ½çŸ¥è­˜è·¯ç”±**ï¼šAgent å»ºç«‹æ™‚è‡ªå‹•é¸æ“‡æœ€ç›¸é—œçš„çŸ¥è­˜ä¾†æº
3. **çŸ¥è­˜å“è³ªè©•ä¼°**ï¼šAI è‡ªå‹•è©•ä¼°çŸ¥è­˜çš„å®Œæ•´æ€§ã€æº–ç¢ºæ€§ã€æ™‚æ•ˆæ€§
4. **èªç¾©çŸ¥è­˜åœ–è­œ**ï¼šå»ºç«‹çŸ¥è­˜ä¹‹é–“çš„èªç¾©é—œè¯ï¼Œæ”¯æ´æ¨ç†èˆ‡ç™¼ç¾
5. **çŸ¥è­˜æ¼”åŒ–è¿½è¹¤**ï¼šè¿½è¹¤çŸ¥è­˜çš„ç‰ˆæœ¬æ¼”é€²èˆ‡ä¾è³´é—œä¿‚

#### é€²éšèƒ½åŠ›ï¼ˆv3.0 æ–°å¢ï¼‰
6. **çŸ¥è­˜è¡°æ¸›æ¨¡å‹**ï¼šä¾çŸ¥è­˜é¡å‹è‡ªå‹•è¨ˆç®—ã€ŒçŸ¥è­˜ä¿é®®æœŸã€ï¼Œé¿å…ä½¿ç”¨éæ™‚çŸ¥è­˜
7. **åé¥‹å­¸ç¿’è¿´è·¯**ï¼šå¾ Agent ä½¿ç”¨çµæœå­¸ç¿’ï¼ŒæŒçºŒå„ªåŒ–çŸ¥è­˜å“è³ªè©•åˆ†
8. **çŸ¥è­˜ç¢ç‰‡èšåˆ**ï¼šè‡ªå‹•ç™¼ç¾ä¸¦æ•´åˆåˆ†æ•£çš„çŸ¥è­˜ç¢ç‰‡ï¼Œå»ºæ§‹å®Œæ•´çŸ¥è­˜å–®å…ƒ
9. **é«˜æ•ˆèƒ½èªç¾©æœå°‹**ï¼šä½¿ç”¨ ANN æ¼”ç®—æ³•å¯¦ç¾è¬ç´šæ–‡ä»¶çš„å³æ™‚èªç¾©æœå°‹
10. **ä¸»å‹•æ¨é€æ©Ÿåˆ¶**ï¼šçŸ¥è­˜è®Šæ›´æ™‚ä¸»å‹•é€šçŸ¥ç›¸é—œ Agentï¼Œé¿å…ä½¿ç”¨éæ™‚çŸ¥è­˜

### æŠ€è¡“é–€æª»

- **è¤‡é›œåº¦é–€æª»**ï¼šå¤šå±¤æ¬¡ AI æ¨ç†ã€èªç¾©åˆ†æã€é—œè¯è¨ˆç®—
- **å…§å®¹é–€æª»**ï¼šåŸºæ–¼ DIKW ç†è«–ã€çŸ¥è­˜ç®¡ç†æœ€ä½³å¯¦è¸ã€ä¼æ¥­æ²»ç†æ¨™æº–
- **å¯¦ä½œé–€æª»**ï¼šéœ€è¦æ·±åº¦ç†è§£ AI Agent é‹ä½œæ©Ÿåˆ¶ã€çŸ¥è­˜åœ–è­œæŠ€è¡“ã€èªç¾©æœå°‹

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### 1. å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•ç³»çµ±ï¼ˆMulti-dimensional Knowledge Indexï¼‰

#### 1.1 å››ç¶­ç´¢å¼•æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•ç³»çµ± (MDKI)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ èªç¾©ç¶­åº¦     â”‚  â”‚ æ™‚åºç¶­åº¦     â”‚  â”‚ é—œè¯ç¶­åº¦     â”‚ â”‚
â”‚  â”‚ Semantic     â”‚  â”‚ Temporal     â”‚  â”‚ Relational   â”‚ â”‚
â”‚  â”‚ - Embedding  â”‚  â”‚ - Created    â”‚  â”‚ - Framework  â”‚ â”‚
â”‚  â”‚ - Keywords   â”‚  â”‚ - Updated    â”‚  â”‚ - Dependency â”‚ â”‚
â”‚  â”‚ - Topics     â”‚  â”‚ - ValidUntil â”‚  â”‚ - Hierarchy  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ¬Šé‡ç¶­åº¦     â”‚  â”‚ å“è³ªç¶­åº¦     â”‚  â”‚ å¯ç”¨æ€§ç¶­åº¦   â”‚ â”‚
â”‚  â”‚ Weight       â”‚  â”‚ Quality      â”‚  â”‚ Availability â”‚ â”‚
â”‚  â”‚ - Relevance  â”‚  â”‚ - Completenessâ”‚ â”‚ - Access     â”‚ â”‚
â”‚  â”‚ - Authority  â”‚  â”‚ - Accuracy   â”‚  â”‚ - Status     â”‚ â”‚
â”‚  â”‚ - Usage      â”‚  â”‚ - Freshness   â”‚  â”‚ - Permission â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 ç´¢å¼•å¯¦ä½œè¨­è¨ˆ

```typescript
// lib/knowledge/indexing/multi-dimensional-index.ts

/**
 * å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•
 */
export interface MultiDimensionalKnowledgeIndex {
    // èªç¾©ç¶­åº¦
    semantic: {
        embedding: number[];           // å‘é‡åµŒå…¥ï¼ˆ1536 ç¶­ï¼‰
        keywords: string[];              // é—œéµè©ï¼ˆTF-IDF åŠ æ¬Šï¼‰
        topics: string[];                // ä¸»é¡Œæ¨™ç±¤
        entities: Entity[];              // å¯¦é«”è­˜åˆ¥ï¼ˆäººç‰©ã€çµ„ç¹”ã€ç”¢å“ç­‰ï¼‰
        concepts: Concept[];              // æ¦‚å¿µæå–ï¼ˆæŠ½è±¡æ¦‚å¿µï¼‰
    };
    
    // æ™‚åºç¶­åº¦
    temporal: {
        created_at: string;              // å»ºç«‹æ™‚é–“
        updated_at: string;              // æ›´æ–°æ™‚é–“
        valid_from: string;              // ç”Ÿæ•ˆæ™‚é–“
        valid_until: string | null;      // å¤±æ•ˆæ™‚é–“
        version: string;                 // ç‰ˆæœ¬è™Ÿ
        lifecycle_stage: LifecycleStage; // ç”Ÿå‘½é€±æœŸéšæ®µ
    };
    
    // é—œè¯ç¶­åº¦
    relational: {
        framework_id: string | null;     // æ‰€å±¬çŸ¥è­˜æ¡†æ¶
        instance_id: string | null;      // çŸ¥è­˜å¯¦ä¾‹ ID
        parent_file_id: string | null;   // çˆ¶æª”æ¡ˆï¼ˆè¡ç”Ÿé—œä¿‚ï¼‰
        child_file_ids: string[];        // å­æª”æ¡ˆï¼ˆè¡ç”Ÿé—œä¿‚ï¼‰
        related_file_ids: string[];      // ç›¸é—œæª”æ¡ˆï¼ˆèªç¾©é—œè¯ï¼‰
        dependency_chain: string[];      // ä¾è³´éˆï¼ˆçŸ¥è­˜ä¾è³´ï¼‰
    };
    
    // æ¬Šé‡ç¶­åº¦
    weight: {
        relevance_score: number;          // ç›¸é—œåº¦è©•åˆ†ï¼ˆ0-1ï¼‰
        authority_score: number;         // æ¬Šå¨æ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        usage_frequency: number;         // ä½¿ç”¨é »ç‡
        citation_count: number;         // å¼•ç”¨æ¬¡æ•¸
        agent_usage_count: number;       // Agent ä½¿ç”¨æ¬¡æ•¸
    };
    
    // å“è³ªç¶­åº¦
    quality: {
        completeness_score: number;      // å®Œæ•´æ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        accuracy_score: number;          // æº–ç¢ºæ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        freshness_score: number;         // æ™‚æ•ˆæ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        consistency_score: number;       // ä¸€è‡´æ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        validation_status: ValidationStatus; // é©—è­‰ç‹€æ…‹
    };
    
    // å¯ç”¨æ€§ç¶­åº¦
    availability: {
        access_level: AccessLevel;       // å­˜å–å±¤ç´š
        department_restrictions: string[]; // éƒ¨é–€é™åˆ¶
        tag_restrictions: TagRestriction[]; // æ¨™ç±¤é™åˆ¶
        status: FileStatus;              // æª”æ¡ˆç‹€æ…‹
        dikw_level: DIKWLevel;           // DIKW å±¤ç´š
    };
}
```

### 2. æ™ºèƒ½çŸ¥è­˜è·¯ç”±ç³»çµ±ï¼ˆIntelligent Knowledge Routingï¼‰

#### 2.1 Agent çŸ¥è­˜è·¯ç”±æ¼”ç®—æ³•

ç•¶ Agent å»ºç«‹æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•é¸æ“‡æœ€ç›¸é—œçš„çŸ¥è­˜ä¾†æºï¼š

```typescript
// lib/knowledge/routing/agent-knowledge-router.ts

/**
 * Agent çŸ¥è­˜è·¯ç”±æ¼”ç®—æ³•
 * 
 * ç›®æ¨™ï¼šæ ¹æ“š Agent çš„ä»»å‹™æè¿°ï¼Œè‡ªå‹•é¸æ“‡æœ€ç›¸é—œçš„çŸ¥è­˜ä¾†æº
 */
export class AgentKnowledgeRouter {
    /**
     * ç‚º Agent é¸æ“‡çŸ¥è­˜ä¾†æº
     */
    async routeKnowledgeForAgent(
        agentDescription: string,
        agentSkills: AgentSkill[],
        departmentId: string | null
    ): Promise<KnowledgeRoute[]> {
        
        // Step 1: èªç¾©åŒ¹é…ï¼ˆä½¿ç”¨ Embedding ç›¸ä¼¼åº¦ï¼‰
        const semanticMatches = await this.findSemanticMatches(
            agentDescription,
            agentSkills,
            departmentId
        );
        
        // Step 2: æ¡†æ¶åŒ¹é…ï¼ˆæ ¹æ“š Agent Skills åŒ¹é…çŸ¥è­˜æ¡†æ¶ï¼‰
        const frameworkMatches = await this.findFrameworkMatches(
            agentSkills,
            departmentId
        );
        
        // Step 3: DIKW å±¤ç´šéæ¿¾ï¼ˆå„ªå…ˆé¸æ“‡ Knowledge å’Œ Wisdom å±¤ç´šï¼‰
        const dikwFiltered = this.filterByDIKWLevel(
            [...semanticMatches, ...frameworkMatches],
            ['knowledge', 'wisdom'] // å„ªå…ˆå±¤ç´š
        );
        
        // Step 4: å“è³ªéæ¿¾ï¼ˆéæ¿¾ä½å“è³ªçŸ¥è­˜ï¼‰
        const qualityFiltered = this.filterByQuality(
            dikwFiltered,
            { minCompleteness: 0.7, minAccuracy: 0.8 }
        );
        
        // Step 5: æ™‚æ•ˆæ€§éæ¿¾ï¼ˆéæ¿¾éæœŸçŸ¥è­˜ï¼‰
        const temporalFiltered = this.filterByTemporal(
            qualityFiltered,
            { maxAge: 365 } // æœ€å¤š 1 å¹´
        );
        
        // Step 6: æ¬Šé‡æ’åºï¼ˆç¶œåˆç›¸é—œåº¦ã€æ¬Šå¨æ€§ã€ä½¿ç”¨é »ç‡ï¼‰
        const ranked = this.rankByWeight(temporalFiltered, {
            relevanceWeight: 0.4,
            authorityWeight: 0.3,
            usageWeight: 0.3
        });
        
        // Step 7: å¤šæ¨£æ€§å¹³è¡¡ï¼ˆç¢ºä¿çŸ¥è­˜ä¾†æºå¤šæ¨£åŒ–ï¼‰
        const diversified = this.ensureDiversity(ranked, {
            maxPerFramework: 3,
            maxPerCategory: 5,
            minTotalSources: 5,
            maxTotalSources: 20
        });
        
        return diversified;
    }
}
```

### 3. çŸ¥è­˜å“è³ªè©•ä¼°ç³»çµ±ï¼ˆKnowledge Quality Assessmentï¼‰

#### 3.1 å¤šç¶­åº¦å“è³ªè©•ä¼°

```typescript
// lib/knowledge/quality/quality-assessor.ts

/**
 * çŸ¥è­˜å“è³ªè©•ä¼°ç³»çµ±
 * 
 * è‡ªå‹•è©•ä¼°çŸ¥è­˜çš„å®Œæ•´æ€§ã€æº–ç¢ºæ€§ã€æ™‚æ•ˆæ€§ã€ä¸€è‡´æ€§
 */
export class KnowledgeQualityAssessor {
    /**
     * è©•ä¼°çŸ¥è­˜å“è³ª
     */
    async assessQuality(
        fileId: string,
        content: string,
        metadata: any
    ): Promise<QualityAssessment> {
        
        // 1. å®Œæ•´æ€§è©•ä¼°
        const completeness = await this.assessCompleteness(content, metadata);
        
        // 2. æº–ç¢ºæ€§è©•ä¼°
        const accuracy = await this.assessAccuracy(content, metadata);
        
        // 3. æ™‚æ•ˆæ€§è©•ä¼°
        const freshness = await this.assessFreshness(metadata);
        
        // 4. ä¸€è‡´æ€§è©•ä¼°
        const consistency = await this.assessConsistency(content, metadata);
        
        // 5. çµæ§‹åŒ–ç¨‹åº¦è©•ä¼°
        const structure = await this.assessStructure(content);
        
        // 6. ç¶œåˆè©•åˆ†
        const overallScore = this.calculateOverallScore({
            completeness,
            accuracy,
            freshness,
            consistency,
            structure
        });
        
        return {
            completeness,
            accuracy,
            freshness,
            consistency,
            structure,
            overall_score: overallScore,
            recommendations: this.generateRecommendations({
                completeness,
                accuracy,
                freshness,
                consistency,
                structure
            })
        };
    }
}
```

### 4. èªç¾©çŸ¥è­˜åœ–è­œï¼ˆSemantic Knowledge Graphï¼‰

#### 4.1 çŸ¥è­˜é—œè¯ç™¼ç¾

```typescript
// lib/knowledge/graph/semantic-graph-builder.ts

/**
 * èªç¾©çŸ¥è­˜åœ–è­œå»ºæ§‹å™¨
 * 
 * è‡ªå‹•ç™¼ç¾çŸ¥è­˜ä¹‹é–“çš„èªç¾©é—œè¯
 */
export class SemanticKnowledgeGraphBuilder {
    /**
     * å»ºæ§‹çŸ¥è­˜åœ–è­œ
     */
    async buildGraph(fileIds: string[]): Promise<KnowledgeGraph> {
        const nodes: GraphNode[] = [];
        const edges: GraphEdge[] = [];
        
        // 1. å»ºç«‹ç¯€é»ï¼ˆæª”æ¡ˆã€çŸ¥è­˜å¯¦ä¾‹ã€æ¡†æ¶ï¼‰
        for (const fileId of fileIds) {
            const file = await this.getFile(fileId);
            nodes.push({
                id: fileId,
                type: 'file',
                label: file.filename,
                data: {
                    dikw_level: file.dikw_level,
                    category: file.category_id,
                    department: file.department_id
                }
            });
        }
        
        // 2. ç™¼ç¾èªç¾©é—œè¯
        const semanticEdges = await this.discoverSemanticRelations(nodes);
        edges.push(...semanticEdges);
        
        // 3. ç™¼ç¾ä¾è³´é—œä¿‚
        const dependencyEdges = await this.discoverDependencies(nodes);
        edges.push(...dependencyEdges);
        
        return {
            nodes,
            edges,
            metadata: {
                node_count: nodes.length,
                edge_count: edges.length,
                density: edges.length / (nodes.length * (nodes.length - 1))
            }
        };
    }
}
```

### 5. çŸ¥è­˜æ¼”åŒ–è¿½è¹¤ç³»çµ±ï¼ˆKnowledge Evolution Trackingï¼‰

#### 5.1 ç‰ˆæœ¬æ¼”é€²è¿½è¹¤

```typescript
// lib/knowledge/evolution/evolution-tracker.ts

/**
 * çŸ¥è­˜æ¼”åŒ–è¿½è¹¤ç³»çµ±
 * 
 * è¿½è¹¤çŸ¥è­˜çš„ç‰ˆæœ¬æ¼”é€²ã€ä¾è³´é—œä¿‚ã€å½±éŸ¿ç¯„åœ
 */
export class KnowledgeEvolutionTracker {
    /**
     * è¿½è¹¤çŸ¥è­˜æ¼”åŒ–
     */
    async trackEvolution(fileId: string): Promise<EvolutionChain> {
        // 1. å–å¾—ç‰ˆæœ¬æ­·å²
        const versions = await this.getVersionHistory(fileId);
        
        // 2. åˆ†æè®Šæ›´å…§å®¹
        const changes = await this.analyzeChanges(versions);
        
        // 3. è¿½è¹¤ä¾è³´å½±éŸ¿
        const impact = await this.trackDependencyImpact(fileId);
        
        // 4. å»ºæ§‹æ¼”åŒ–éˆ
        return {
            file_id: fileId,
            versions,
            changes,
            impact,
            evolution_path: this.buildEvolutionPath(versions, changes)
        };
    }
}
```

---

## ğŸ†• v3.0 é€²éšå­ç³»çµ±è¨­è¨ˆ

### 6. çŸ¥è­˜è¡°æ¸›æ¨¡å‹ï¼ˆKnowledge Decay Modelï¼‰

#### 6.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šä¸åŒé¡å‹çš„çŸ¥è­˜æœ‰ä¸åŒçš„ã€Œä¿é®®æœŸã€ï¼Œç°¡å–®çš„æ™‚é–“é–¾å€¼ç„¡æ³•ç²¾æº–åˆ¤æ–·çŸ¥è­˜æ˜¯å¦éæ™‚ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹ä¾æ“šçŸ¥è­˜é¡å‹çš„ã€Œè¡°æ¸›æ›²ç·šæ¨¡å‹ã€ï¼Œè‡ªå‹•è¨ˆç®—çŸ¥è­˜çš„æœ‰æ•ˆæ€§åˆ†æ•¸ã€‚

#### 6.2 è¡°æ¸›æ›²ç·šé¡å‹å®šç¾©

```typescript
// lib/knowledge/decay/knowledge-decay-model.ts

export enum KnowledgeDecayType {
    STABLE = 'stable',         // ç©©å®šå‹ï¼ˆå¦‚æ³•è¦ã€æ”¿ç­–ï¼‰
    TECHNICAL = 'technical',   // æŠ€è¡“å‹ï¼ˆå¦‚ API æ–‡ä»¶ï¼‰
    MARKET = 'market',         // å¸‚å ´å‹ï¼ˆå¦‚ç«¶å“åˆ†æï¼‰
    EVENT = 'event',           // äº‹ä»¶å‹ï¼ˆå¦‚æœƒè­°è¨˜éŒ„ï¼‰
    PROCEDURAL = 'procedural', // æµç¨‹å‹ï¼ˆå¦‚ SOPï¼‰
    REFERENCE = 'reference'    // åƒè€ƒå‹ï¼ˆå¦‚ç™¾ç§‘çŸ¥è­˜ï¼‰
}

/**
 * è¡°æ¸›æ›²ç·šé…ç½®è¡¨
 * 
 * åŠè¡°æœŸè¨­è¨ˆç†å¿µï¼š
 * - ç©©å®šå‹ï¼šæ³•è¦é€šå¸¸ 3-5 å¹´æ›´æ–°ï¼Œè¨­å®š 1095 å¤©ï¼ˆ3 å¹´ï¼‰
 * - æŠ€è¡“å‹ï¼šæŠ€è¡“è¿­ä»£å¿«ï¼Œè¨­å®š 365 å¤©ï¼ˆ1 å¹´ï¼‰
 * - å¸‚å ´å‹ï¼šå¸‚å ´è®ŠåŒ–è¿…é€Ÿï¼Œè¨­å®š 90 å¤©ï¼ˆ3 å€‹æœˆï¼‰
 * - äº‹ä»¶å‹ï¼šæœƒè­°è¨˜éŒ„æ™‚æ•ˆæ€§æœ€çŸ­ï¼Œè¨­å®š 30 å¤©ï¼ˆ1 å€‹æœˆï¼‰
 */
export const DECAY_CURVES: Map<KnowledgeDecayType, DecayCurve> = new Map([
    [KnowledgeDecayType.STABLE, {
        type: KnowledgeDecayType.STABLE,
        halfLife: 1095,  // 3 å¹´
        minValidScore: 0.3,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.TECHNICAL, {
        type: KnowledgeDecayType.TECHNICAL,
        halfLife: 365,   // 1 å¹´
        minValidScore: 0.4,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.MARKET, {
        type: KnowledgeDecayType.MARKET,
        halfLife: 90,    // 3 å€‹æœˆ
        minValidScore: 0.5,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.EVENT, {
        type: KnowledgeDecayType.EVENT,
        halfLife: 30,    // 1 å€‹æœˆ
        minValidScore: 0.3,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.PROCEDURAL, {
        type: KnowledgeDecayType.PROCEDURAL,
        halfLife: 548,   // 1.5 å¹´
        minValidScore: 0.5,
        decayFunction: 'step'  // SOP éæœŸå°±æ˜¯éæœŸï¼Œæ²’æœ‰æ¼¸é€²
    }],
    [KnowledgeDecayType.REFERENCE, {
        type: KnowledgeDecayType.REFERENCE,
        halfLife: 730,   // 2 å¹´
        minValidScore: 0.4,
        decayFunction: 'linear'
    }]
]);
```

#### 6.3 è³‡æ–™åº«çµæ§‹æ“´å……

```sql
-- æ–°å¢æ¬„ä½åˆ° files è¡¨
ALTER TABLE files ADD COLUMN IF NOT EXISTS decay_type VARCHAR(20) DEFAULT 'reference';
ALTER TABLE files ADD COLUMN IF NOT EXISTS decay_score DECIMAL(3,2) DEFAULT 1.0;
ALTER TABLE files ADD COLUMN IF NOT EXISTS decay_status VARCHAR(20) DEFAULT 'fresh';
ALTER TABLE files ADD COLUMN IF NOT EXISTS valid_until TIMESTAMPTZ DEFAULT NULL;

-- å»ºç«‹ç´¢å¼•ä»¥åŠ é€Ÿè¡°æ¸›ç‹€æ…‹æŸ¥è©¢
CREATE INDEX IF NOT EXISTS idx_files_decay_status 
    ON files(decay_status) WHERE gemini_state = 'SYNCED';
```

---

### 7. åé¥‹å­¸ç¿’è¿´è·¯ï¼ˆFeedback Learning Loopï¼‰

#### 7.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šç³»çµ±åªè¨˜éŒ„çŸ¥è­˜è¢«ä½¿ç”¨æ¬¡æ•¸ï¼Œä½†ä¸çŸ¥é“ä½¿ç”¨æ•ˆæœå¥½ä¸å¥½ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹å®Œæ•´çš„åé¥‹æ”¶é›†èˆ‡å­¸ç¿’æ©Ÿåˆ¶ï¼Œè®“çŸ¥è­˜å“è³ªè©•åˆ†èƒ½å¤ æŒçºŒå„ªåŒ–ã€‚

#### 7.2 åé¥‹é¡å‹å®šç¾©

```typescript
// lib/knowledge/feedback/feedback-types.ts

export enum FeedbackSource {
    USER_EXPLICIT = 'user_explicit',     // ä½¿ç”¨è€…æ˜ç¢ºåé¥‹ï¼ˆæŒ‰è®š/å€’è®šï¼‰
    USER_IMPLICIT = 'user_implicit',     // ä½¿ç”¨è€…éš±æ€§åé¥‹ï¼ˆç¹¼çºŒå°è©±/é‡æ–°æå•ï¼‰
    AGENT_SELF = 'agent_self',           // Agent è‡ªæˆ‘è©•ä¼°
    SYSTEM_AUDIT = 'system_audit'        // ç³»çµ±å¯©è¨ˆ
}

export enum FeedbackType {
    HELPFUL = 'helpful',               // æœ‰å¹«åŠ©
    NOT_HELPFUL = 'not_helpful',       // æ²’å¹«åŠ©
    OUTDATED = 'outdated',            // è³‡è¨Šéæ™‚
    INACCURATE = 'inaccurate',        // è³‡è¨Šä¸æ­£ç¢º
    INCOMPLETE = 'incomplete',         // è³‡è¨Šä¸å®Œæ•´
    IRRELEVANT = 'irrelevant',        // èˆ‡å•é¡Œç„¡é—œ
    PERFECT = 'perfect'               // å®Œç¾å›ç­”
}
```

#### 7.3 è³‡æ–™åº«çµæ§‹

```sql
-- åé¥‹äº‹ä»¶è¡¨
CREATE TABLE IF NOT EXISTS knowledge_feedback_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    file_id UUID REFERENCES files(id) ON DELETE CASCADE,
    agent_id UUID REFERENCES agents(id) ON DELETE SET NULL,
    session_id VARCHAR(255),
    
    source VARCHAR(30) NOT NULL,
    sentiment VARCHAR(10) NOT NULL,
    score DECIMAL(3,2) NOT NULL,
    feedback_type VARCHAR(30) NOT NULL,
    details JSONB DEFAULT '{}',
    context JSONB DEFAULT '{}',
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- æ–°å¢æ¬„ä½åˆ° files è¡¨
ALTER TABLE files ADD COLUMN IF NOT EXISTS feedback_score DECIMAL(3,2) DEFAULT 0.5;
ALTER TABLE files ADD COLUMN IF NOT EXISTS feedback_count INTEGER DEFAULT 0;
ALTER TABLE files ADD COLUMN IF NOT EXISTS positive_ratio DECIMAL(3,2) DEFAULT 0.5;
ALTER TABLE files ADD COLUMN IF NOT EXISTS needs_review BOOLEAN DEFAULT FALSE;
```

---

### 8. çŸ¥è­˜ç¢ç‰‡èšåˆï¼ˆKnowledge Fragment Aggregationï¼‰

#### 8.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šä¼æ¥­çŸ¥è­˜å¾€å¾€åˆ†æ•£åœ¨å¤šä»½æ–‡ä»¶ä¸­ï¼ŒAgent åªèƒ½ç²å–ç‰‡æ®µè¦–è§’ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šè‡ªå‹•ç™¼ç¾è¨è«–åŒä¸€æ¦‚å¿µçš„æ–‡ä»¶ï¼Œèšåˆæˆå®Œæ•´çš„ã€ŒçŸ¥è­˜å–®å…ƒã€ã€‚

#### 8.2 çŸ¥è­˜å–®å…ƒå®šç¾©

```typescript
// lib/knowledge/aggregation/knowledge-unit.ts

export interface KnowledgeUnit {
    id: string;
    concept_id: string;           // æ ¸å¿ƒæ¦‚å¿µ ID
    concept_name: string;         // æ¦‚å¿µåç¨±ï¼ˆå¦‚ã€Œå“¡å·¥é›¢è·æµç¨‹ã€ï¼‰
    concept_description: string;  // æ¦‚å¿µæè¿°
    source_files: SourceFile[];   // çµ„æˆæ­¤çŸ¥è­˜å–®å…ƒçš„æ–‡ä»¶
    synthesized_knowledge: string;  // AI åˆæˆçš„çµ±ä¸€çŸ¥è­˜
    conflicts: ConflictRecord[];    // ç™¼ç¾çš„è¡çª
    conflict_resolution: string;    // è¡çªè§£æ±ºèªªæ˜
    completeness_score: number;     // çŸ¥è­˜å®Œæ•´åº¦
    confidence_score: number;       // ç¶œåˆä¿¡å¿ƒåº¦
    coverage_map: CoverageMap;      // çŸ¥è­˜è¦†è“‹åœ°åœ–
    created_at: string;
    updated_at: string;
    auto_generated: boolean;
}
```

#### 8.3 è³‡æ–™åº«çµæ§‹

```sql
-- çŸ¥è­˜å–®å…ƒè¡¨
CREATE TABLE IF NOT EXISTS knowledge_units (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    concept_id VARCHAR(255) NOT NULL UNIQUE,
    concept_name VARCHAR(500) NOT NULL,
    concept_description TEXT,
    source_files JSONB NOT NULL DEFAULT '[]',
    synthesized_knowledge TEXT,
    conflicts JSONB DEFAULT '[]',
    conflict_resolution TEXT,
    completeness_score DECIMAL(3,2) DEFAULT 0,
    confidence_score DECIMAL(3,2) DEFAULT 0,
    coverage_map JSONB DEFAULT '{}',
    auto_generated BOOLEAN DEFAULT TRUE,
    needs_human_review BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- çŸ¥è­˜å–®å…ƒèˆ‡æ–‡ä»¶çš„é—œè¯è¡¨
CREATE TABLE IF NOT EXISTS knowledge_unit_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    unit_id UUID REFERENCES knowledge_units(id) ON DELETE CASCADE,
    file_id UUID REFERENCES files(id) ON DELETE CASCADE,
    contribution TEXT,
    coverage_areas JSONB DEFAULT '[]',
    weight DECIMAL(3,2) DEFAULT 1.0,
    UNIQUE(unit_id, file_id)
);
```

---

### 9. é«˜æ•ˆèƒ½èªç¾©æœå°‹ï¼ˆHigh-Performance Semantic Searchï¼‰

#### 9.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šå…©å…©æ¯”è¼ƒ Embedding çš„ O(nÂ²) æ¼”ç®—æ³•åœ¨è¬ç´šæ–‡ä»¶æ™‚æ¥µæ…¢ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ Approximate Nearest Neighbor (ANN) æ¼”ç®—æ³•å¯¦ç¾è¿‘ä¼¼å³æ™‚æœå°‹ã€‚

#### 9.2 PostgreSQL + pgvector å„ªåŒ–é…ç½®

```sql
-- ç¢ºä¿ pgvector æ“´å±•å·²å•Ÿç”¨
CREATE EXTENSION IF NOT EXISTS vector;

-- ç‚º content_embedding å»ºç«‹ HNSW ç´¢å¼•ï¼ˆæ¨è–¦ç”¨æ–¼é«˜ç¶­å‘é‡ï¼‰
CREATE INDEX IF NOT EXISTS idx_files_embedding_hnsw 
    ON files 
    USING hnsw (content_embedding vector_cosine_ops)
    WITH (m = 16, ef_construction = 64);

-- èªç¾©æœå°‹å‡½æ•¸ï¼ˆä½¿ç”¨ ANN ç´¢å¼•ï¼‰
CREATE OR REPLACE FUNCTION semantic_search_ann(
    query_embedding vector(1536),
    similarity_threshold FLOAT DEFAULT 0.7,
    match_count INTEGER DEFAULT 10,
    filter_department UUID DEFAULT NULL,
    filter_category UUID DEFAULT NULL,
    filter_dikw_level TEXT DEFAULT NULL
)
RETURNS TABLE(
    id UUID,
    filename TEXT,
    similarity FLOAT,
    snippet TEXT,
    dikw_level TEXT,
    decay_score FLOAT
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        f.id,
        f.filename,
        1 - (f.content_embedding <=> query_embedding) as similarity,
        LEFT(f.markdown_content, 200) as snippet,
        f.dikw_level,
        f.decay_score
    FROM files f
    WHERE f.gemini_state = 'SYNCED'
    AND f.content_embedding IS NOT NULL
    AND (filter_department IS NULL OR f.department_id = filter_department)
    AND (filter_category IS NULL OR f.category_id = filter_category)
    AND (filter_dikw_level IS NULL OR f.dikw_level = filter_dikw_level)
    AND 1 - (f.content_embedding <=> query_embedding) >= similarity_threshold
    ORDER BY f.content_embedding <=> query_embedding
    LIMIT match_count;
END;
$$ LANGUAGE plpgsql;
```

#### 9.3 æ•ˆèƒ½å°æ¯”

| æ¼”ç®—æ³• | æ™‚é–“è¤‡é›œåº¦ | 10,000 æª”æ¡ˆ | 100,000 æª”æ¡ˆ | ç²¾ç¢ºåº¦ |
|-------|-----------|-------------|--------------|--------|
| æš´åŠ›æ³• (Brute Force) | O(nÂ²) | ~5 åˆ†é˜ | ~8 å°æ™‚ | 100% |
| IVFFlat | O(nÂ·âˆšn) | ~3 ç§’ | ~30 ç§’ | ~95% |
| **HNSW** | O(nÂ·log n) | **<1 ç§’** | **~5 ç§’** | **~98%** |

---

### 10. ä¸»å‹•æ¨é€æ©Ÿåˆ¶ï¼ˆProactive Knowledge Pushï¼‰

#### 10.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šçŸ¥è­˜æ›´æ–°æ™‚ï¼Œä½¿ç”¨è©²çŸ¥è­˜çš„ Agent ä¸æœƒè‡ªå‹•çŸ¥é“ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹äº‹ä»¶é©…å‹•çš„ä¸»å‹•é€šçŸ¥ç³»çµ±ã€‚

#### 10.2 é€šçŸ¥äº‹ä»¶é¡å‹

```typescript
// lib/knowledge/push/notification-types.ts

export enum KnowledgeNotificationType {
    // ç·Šæ€¥é€šçŸ¥ï¼ˆéœ€ç«‹å³è™•ç†ï¼‰
    KNOWLEDGE_EXPIRED = 'knowledge_expired',
    CRITICAL_UPDATE = 'critical_update',
    CONFLICT_DETECTED = 'conflict_detected',
    
    // é‡è¦é€šçŸ¥ï¼ˆå»ºè­°ç•¶æ—¥è™•ç†ï¼‰
    KNOWLEDGE_UPDATED = 'knowledge_updated',
    QUALITY_DEGRADATION = 'quality_degradation',
    APPROACHING_EXPIRY = 'approaching_expiry',
    
    // è³‡è¨Šé€šçŸ¥ï¼ˆå¯ç¨å¾Œè™•ç†ï¼‰
    NEW_RELATED_KNOWLEDGE = 'new_related_knowledge',
    AGGREGATION_AVAILABLE = 'aggregation_available',
    FEEDBACK_SUMMARY = 'feedback_summary'
}
```

#### 10.3 è³‡æ–™åº«çµæ§‹

```sql
-- é€šçŸ¥è¡¨
CREATE TABLE IF NOT EXISTS knowledge_notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    type VARCHAR(50) NOT NULL,
    priority VARCHAR(10) NOT NULL,
    affected_files UUID[] DEFAULT '{}',
    affected_agents UUID[] DEFAULT '{}',
    affected_users UUID[] DEFAULT '{}',
    title TEXT NOT NULL,
    message TEXT NOT NULL,
    details JSONB DEFAULT '{}',
    suggested_actions JSONB DEFAULT '[]',
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    sent_at TIMESTAMPTZ,
    read_at TIMESTAMPTZ,
    resolved_at TIMESTAMPTZ,
    resolved_by UUID REFERENCES user_profiles(id)
);

-- Agent çŸ¥è­˜ä¾†æºé—œè¯è¡¨
CREATE TABLE IF NOT EXISTS agent_knowledge_sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id UUID REFERENCES agents(id) ON DELETE CASCADE,
    file_id UUID REFERENCES files(id) ON DELETE CASCADE,
    added_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(agent_id, file_id)
);

-- æ–°å¢æ¬„ä½åˆ° agents è¡¨
ALTER TABLE agents ADD COLUMN IF NOT EXISTS knowledge_status VARCHAR(30) DEFAULT 'up_to_date';
ALTER TABLE agents ADD COLUMN IF NOT EXISTS last_knowledge_alert TIMESTAMPTZ;
ALTER TABLE agents ADD COLUMN IF NOT EXISTS status_reason TEXT;

-- çŸ¥è­˜æ›´æ–°è§¸ç™¼å™¨
CREATE OR REPLACE FUNCTION notify_knowledge_update()
RETURNS TRIGGER AS $$
BEGIN
    PERFORM pg_notify(
        'knowledge_update',
        json_build_object(
            'file_id', NEW.id,
            'action', TG_OP,
            'updated_at', NEW.updated_at
        )::text
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_knowledge_update
    AFTER INSERT OR UPDATE ON files
    FOR EACH ROW
    WHEN (NEW.gemini_state = 'SYNCED')
    EXECUTE FUNCTION notify_knowledge_update();
```

---

## ğŸš€ å¯¦æ–½è·¯ç·šåœ–

### Phase 1-3: åŸºç¤å»ºè¨­ï¼ˆå·²å®Œæˆ âœ…ï¼‰

- âœ… å¯¦ä½œå¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•ç³»çµ±
- âœ… å¯¦ä½œ Agent çŸ¥è­˜è·¯ç”±ç³»çµ±
- âœ… å¯¦ä½œèªç¾©çŸ¥è­˜åœ–è­œ

### Phase 4: v3.0 é€²éšå­ç³»çµ±ï¼ˆè¦åŠƒä¸­ ğŸ“‹ï¼‰

#### Phase 4.1: çŸ¥è­˜æ™‚æ•ˆæ€§ç®¡ç†ï¼ˆé è¨ˆ 2-3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | çŸ¥è­˜è¡°æ¸›æ¨¡å‹ | ä¾çŸ¥è­˜é¡å‹è¨ˆç®—ä¿é®®æœŸ | 3 å¤© |
| P0 | è¡°æ¸›é¡å‹è‡ªå‹•æ¨æ–· | AI åˆ†ææ–‡ä»¶é¡å‹ | 2 å¤© |
| P1 | è¡°æ¸›ç‹€æ…‹è¦–è¦ºåŒ– | åœ¨æ–‡ä»¶åˆ—è¡¨é¡¯ç¤ºè¡°æ¸›ç‹€æ…‹ | 2 å¤© |
| P1 | éæœŸé è­¦å„€è¡¨æ¿ | é›†ä¸­é¡¯ç¤ºå³å°‡éæœŸçŸ¥è­˜ | 3 å¤© |

#### Phase 4.2: åé¥‹å­¸ç¿’ç³»çµ±ï¼ˆé è¨ˆ 3-4 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | é¡¯æ€§åé¥‹æ”¶é›† | ä½¿ç”¨è€…æŒ‰è®š/å€’è®š UI | 2 å¤© |
| P0 | åé¥‹è¨˜éŒ„èˆ‡çµ±è¨ˆ | è³‡æ–™åº«èˆ‡ API | 3 å¤© |
| P1 | éš±æ€§åé¥‹åˆ†æ | è¡Œç‚ºæ¨¡å¼æ¨æ–·æ»¿æ„åº¦ | 5 å¤© |
| P1 | å­¸ç¿’å¼•æ“ | å¾åé¥‹èª¿æ•´å“è³ªè©•åˆ† | 5 å¤© |

#### Phase 4.3: çŸ¥è­˜èšåˆç³»çµ±ï¼ˆé è¨ˆ 3-4 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | æ¦‚å¿µæå– | å¾æ–‡ä»¶æå–æ ¸å¿ƒæ¦‚å¿µ | 3 å¤© |
| P0 | èšåˆå€™é¸ç™¼ç¾ | æ‰¾å‡ºå¯æ•´åˆçš„æ–‡ä»¶ç¾¤ | 3 å¤© |
| P1 | çŸ¥è­˜åˆæˆå¼•æ“ | AI æ•´åˆå¤šä»½æ–‡ä»¶ | 5 å¤© |
| P1 | è¡çªåµæ¸¬ | æ‰¾å‡ºçŸ¥è­˜çŸ›ç›¾ | 3 å¤© |

#### Phase 4.4: æ•ˆèƒ½å„ªåŒ–ï¼ˆé è¨ˆ 1-2 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | HNSW ç´¢å¼•å»ºç«‹ | pgvector å‘é‡ç´¢å¼• | 1 å¤© |
| P0 | èªç¾©æœå°‹ RPC | å„ªåŒ–æœå°‹å‡½æ•¸ | 2 å¤© |
| P1 | æ‰¹é‡ç›¸ä¼¼åº¦è¨ˆç®— | ç”¨æ–¼åœ–è­œå»ºæ§‹ | 2 å¤© |

#### Phase 4.5: ä¸»å‹•æ¨é€ç³»çµ±ï¼ˆé è¨ˆ 2-3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | é€šçŸ¥è³‡æ–™æ¨¡å‹ | è³‡æ–™åº«çµæ§‹ | 1 å¤© |
| P0 | çŸ¥è­˜æ›´æ–°è§¸ç™¼å™¨ | è®Šæ›´è‡ªå‹•é€šçŸ¥ | 2 å¤© |
| P1 | é€šçŸ¥ä¸­å¿ƒ UI | ä½¿ç”¨è€…é€šçŸ¥ä»‹é¢ | 4 å¤© |

---


#### Phase 5: UX/UI Evolution (Galaxy 2.0)ï¼ˆè¦åŠƒä¸­ ğŸ“‹ï¼‰

#### 5.0 å…¨åŸŸä½ˆå±€è§£æ”¾ï¼šå…¨å¯¬ç•«å¸ƒ (Full-Width Canvas)

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰çš„ä»‹é¢å—é™æ–¼ä¸­é–“çª„ç‰ˆå®¹å™¨ (Centered Container)ï¼Œå°è‡´ã€Œæˆ°æƒ…ä¸­å¿ƒã€èˆ‡ã€Œæ˜Ÿç³»å¼•åŠ›æ¨¡å‹ã€ç¼ºä¹è¶³å¤ çš„å±•ç¤ºç©ºé–“ï¼Œè¦–è¦ºä¸Šä¸å¤ éœ‡æ’¼ï¼Œæ“ä½œä¹Ÿé¡¯å¾—ä¾·ä¿ƒã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ‰“ç ´å‚³çµ±ç¶²é çš„å…©å´ç•™ç™½ï¼Œæ¡ç”¨å…¨è¢å¹•å¯¬åº¦è¨­è¨ˆã€‚
- **å…¨åŸŸæ»¿ç‰ˆ**ï¼šå°‡é ‚éƒ¨å°èˆªåˆ— (Navbar) èˆ‡ä¸»è¦å…§å®¹å€æ“´å±•è‡³è¦–çª—é‚Šç·£ (100% Viewport Width)ã€‚
- **æ²‰æµ¸å¼é«”é©—**ï¼šè®“æ·±è‰²æ˜Ÿç³»èƒŒæ™¯å»¶ä¼¸è‡³æ•´å€‹ç•«é¢ï¼Œå‰µé€ ç„¡é‚Šéš›çš„å®‡å®™æ„Ÿã€‚
- **å½ˆæ€§ç©ºé–“**ï¼šç‚ºå·¦å´æ§åˆ¶é¢æ¿æä¾›æ›´å¯¬è£•çš„æ“ä½œå€ï¼Œå³å´åœ–è­œå‰‡æ“æœ‰å½±é™¢ç´šçš„è¦–è¦ºå¼µåŠ›ã€‚


#### 5.1 æ ¸å¿ƒä»‹é¢é‡æ§‹ï¼šæˆ°æƒ…ä¸­å¿ƒ (Control Center)

**æ ¸å¿ƒå•é¡Œ**ï¼šç´”åœ–å½¢ä»‹é¢åœ¨å¤§é‡æ–‡ä»¶æª¢ç´¢æ™‚æ•ˆç‡ä½è½ï¼Œæ“ä½œé«”é©—ï¼ˆç¸®æ”¾/å¹³ç§»ï¼‰ä¸ä½³ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¡ç”¨ã€Œé›™å…¨ä»‹é¢ã€ï¼Œçµåˆå‚³çµ±åˆ—è¡¨çš„é«˜æ•ˆèˆ‡åœ–è­œçš„æ´å¯Ÿã€‚

- **å·¦å´ï¼šæ§åˆ¶é¢æ¿ (30% å¯¬åº¦)**
  - é«˜æ•ˆåˆ—è¡¨è¦–åœ–ï¼šæ”¯æ´å¿«é€Ÿç¯©é¸ã€æœå°‹ã€æ’åºã€‚
  - å°ç„¦äº’å‹• (Focus Interaction)ï¼šé»æ“Šåˆ—è¡¨é …ç›®ï¼Œå³å´åœ–è­œè‡ªå‹•é£›è¡Œå°ç„¦ã€‚
- **å³å´ï¼šæ˜Ÿç³»è¦–åœ– (70% å¯¬åº¦)**
  - è¦–è¦ºåŒ–é—œè¯ï¼šå±•ç¤ºè¢«é¸ä¸­é …ç›®çš„å‘¨é‚ŠçŸ¥è­˜ã€‚
  - æ‡¸æµ®è³‡è¨Šå¡ (Floating Details)ï¼šæ»‘é¼ æ‡¸åœé¡¯ç¤ºæ‘˜è¦èˆ‡é—œéµæ•¸æ“šã€‚

#### 5.2 è¦–è¦ºæ¼”ç®—æ³•å‡ç´šï¼šå¼•åŠ›æ˜Ÿç³»æ¨¡å‹ (Force-Directed Galaxy)

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰çš„é¡ç¥ç¶“ç¶²çµ¡ä½ˆå±€ï¼ˆåˆ†å±¤å‚ç›´æ’åˆ—ï¼‰åœ¨ç¯€é»å¢å¤šæ™‚æœƒå½¢æˆç„¡é™å‚ç›´å»¶ä¼¸çš„ã€Œæ‘©å¤©å¤§æ¨“ã€ï¼Œé›£ä»¥ç€è¦½ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå°å…¥ D3-Force æˆ–å„å‘ç•°æ€§åŠ›å°å‘æ¼”ç®—æ³• (Force-Directed)ã€‚

- **æ˜Ÿç³»å¼•åŠ›**ï¼šç›¸é—œè¯çš„çŸ¥è­˜ç¯€é»ï¼ˆå¦‚åŒä¸€å“ç‰Œã€åŒä¸€ä¸»é¡Œï¼‰å› å¼•åŠ›è‡ªå‹•èšé›†æˆåœ˜ (Cluster)ã€‚
- **èªç¾©äº’æ–¥**ï¼šä¸ç›¸é—œçš„çŸ¥è­˜ç¾¤é«”ï¼ˆå¦‚ä¸åŒå“ç‰Œï¼‰å› æ–¥åŠ›è‡ªå‹•ç–é›¢ï¼Œå½¢æˆå¤šæ˜Ÿç³»åˆ†ä½ˆã€‚
- **ç©ºé–“åˆ©ç”¨**ï¼šè‡ªå‹•åˆ©ç”¨ 3D/2D å…¨ç•«å¸ƒç©ºé–“ï¼Œé¿å…å–®ä¸€è»¸å‘éåº¦å»¶ä¼¸ã€‚

#### 5.3 DIKW å®Œæ•´å±¤ç´šè¦–è¦ºåŒ–

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰è¦–è¦ºä¸Šåƒ…æœ‰ Data (è—) èˆ‡ Knowledge (ç¶ )ï¼Œç¼ºä¹ Information èˆ‡ Wisdom å±¤ç´šã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šè£œå…¨å››å±¤ç´šå®šç¾©èˆ‡è¦–è¦ºå¯¦ä½œã€‚

| å±¤ç´š | é¡è‰² | å®šç¾© | å¯¦é«”ç¯„ä¾‹ |
|-----|-----|-----|---------|
| **Data** | ğŸ”µ è—è‰² | åŸå§‹æ–‡ä»¶ | ä¸Šå‚³çš„ PDF/Markdown æ–‡ä»¶ |
| **Information** | ğŸ’  é’è‰² | çµæ§‹åŒ–äº‹å¯¦ | è‡ªå‹•èƒå–çš„å¯¦é«” (Entity)ã€é—œéµå­—ç¯€é» |
| **Knowledge** | ğŸŸ¢ ç¶ è‰² | çµæ§‹åŒ–æ¡†æ¶ | åƒ¹å€¼ä¸»å¼µç•«å¸ƒã€SWOT åˆ†æã€çŸ¥è­˜åœ–è­œé—œè¯ |
| **Wisdom** | ğŸŸ£ ç´«è‰² | æ±ºç­–/æˆ°ç•¥ | Agent ç”¢å‡ºçš„ Artifacts (å¦‚æˆ°ç•¥è¦åŠƒæ›¸)ã€æ±ºç­–å»ºè­° |

**å¯¦ä½œè·¯å¾‘**ï¼š
1. **Information å±¤**ï¼šå•Ÿå‹• NLP Named Entity Recognition (NER)ï¼Œå¾ Markdown ä¸­æŠ½å–å‡ºé—œéµå¯¦é«”ä½œç‚ºç¨ç«‹ç¯€é»ã€‚
2. **Wisdom å±¤**ï¼šå°‡ Agent çš„è¼¸å‡º (Artifacts) è¦–ç‚ºç¨ç«‹ç¯€é»ï¼Œé€£çµå…¶åƒè€ƒçš„ Knowledge ç¯€é»ï¼Œå½¢æˆæ±ºç­–æ”¯æ’éˆã€‚

---

## ğŸ–ï¸ Phase 6: ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Executive Command Center)

### æ ¸å¿ƒåƒ¹å€¼å®šä½ï¼šå¾ã€Œè¢«å‹•å„€è¡¨æ¿ã€é€²åŒ–ç‚ºã€Œä¸»å‹•æ™ºæ…§ä¸­æ¨ã€

**æ ¸å¿ƒç†å¿µ**ï¼šæ‹’çµ•ã€Œåœ–è¡¨å¢“åœ°ã€ (Dashboard Graveyard)ã€‚
å‚³çµ±æˆ°æƒ…å®¤å¾€å¾€å †ç Œå¤§é‡æ•¸æ“šèˆ‡åœ–è¡¨ï¼Œå°è‡´è³‡è¨Šéè¼‰ä¸”è¢«å¿½ç•¥ã€‚
æ–°å‹æ…‹çš„æˆ°æƒ…ä¸­æ¨å¿…é ˆå…·å‚™ **Agentic Workflow** çš„ç‰¹è³ªï¼Œå¼·èª¿ **ã€ŒAI ä¸»å‹•ç™¼ç¾ã€** èˆ‡ **ã€Œå°è©±å¼æ¢æŸ¥ã€**ã€‚

#### ç³»çµ±å®šä½å°æ¯”

| ç¶­åº¦ | å‚³çµ±å„€è¡¨æ¿ (Passive) | ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Agentic) |
|-----|-------------------|----------------------|
| **æ ¸å¿ƒåƒ¹å€¼** | å‘ˆç¾æ•¸æ“š (Data Presentation) | **ä¸»å‹•æ´å¯Ÿ (Active Insight)** |
| **è§¸ç™¼æ¨¡å¼** | åç­‰è€é—†æŸ¥çœ‹ | **AI ä¸»å‹•æ¨æ’­ç•°å¸¸èˆ‡æ©Ÿæœƒ** |
| **äº’å‹•æ·±åº¦** | åªèƒ½çœ‹ï¼Œä¸èƒ½å• | **åœ–è¡¨å³å…¥å£ï¼Œé»æ“Šå³å°è©±** |
| **è³‡æ–™ä¾†æº** | å¿…é ˆæ˜¯å®Œç¾çµæ§‹åŒ–æ•¸æ“š | **å®¹ç´é›œäº‚æ–‡ä»¶ (CSV/PDF)ï¼ŒAI è‡ªå‹•èª¿å’Œ** |
| **æ±ºç­–é‚è¼¯** | äººæ‰¾å•é¡Œ -> äººæ‰¾ç­”æ¡ˆ | **AI æ‰¾å•é¡Œ -> äººèˆ‡ AI å…±å‰µç­”æ¡ˆ** |

---

### 6.1 ç³»çµ±æ¶æ§‹è¨­è¨ˆ

#### 6.1.1 ä¸‰å±¤æ™ºæ…§æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ğŸ–ï¸ ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Executive Command Center)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚  â”ƒ  Layer 1: ä¸»å‹•æ…‹å‹¢æ„ŸçŸ¥ (Active Situational Awareness)    â”ƒ  â”‚
â”‚  â”ƒ  ä¸åªæ˜¯ KPI å¡ç‰‡ï¼Œè€Œæ˜¯ã€Œç•°å¸¸ã€èˆ‡ã€Œæ©Ÿæœƒã€çš„æ¨æ’­æµ             â”ƒ  â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¯ æˆ°ç•¥   â”‚ ğŸ“Š ç‡Ÿé‹   â”‚ ğŸ’° è²¡å‹™   â”‚ âš ï¸ é¢¨éšª   â”‚ ğŸŒ æƒ…è³‡   â”‚  â”‚
â”‚  â”‚ "è½å¾Œ5%!" â”‚ "ç•°å¸¸æ´»èº" â”‚ "æ¯›åˆ©ä¸‹æ»‘" â”‚ "åˆè¦è­¦å‘Š" â”‚ "å°æ‰‹é™åƒ¹" â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚  â”ƒ  Layer 2: å°è©±å¼éƒ¨é–€æƒ…å ± (Conversational Intelligence)   â”ƒ  â”‚
â”‚  â”ƒ  è‡ªå‹•åŒæ­¥æ–‡ä»¶æ‘˜è¦ + é»æ“Šå³å•Ÿå‹•æ·±åº¦å°è©±                      â”ƒ  â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ’¼ æ¥­å‹™éƒ¨       â”‚ ğŸ­ ç”Ÿç”¢éƒ¨       â”‚ ğŸ’» ç ”ç™¼éƒ¨       â”‚      â”‚
â”‚  â”‚ [AI æ‘˜è¦ä¸²æµ]   â”‚ [AI æ‘˜è¦ä¸²æµ]   â”‚ [AI æ‘˜è¦ä¸²æµ]   â”‚      â”‚
â”‚  â”‚ â€¢ Q1å ±è¡¨(å·²è®€)  â”‚ â€¢ ç”¢ç·šäº‹æ•…å ±å‘Š   â”‚ â€¢ æŠ€è¡“è©•ä¼°æ–‡ä»¶   â”‚      â”‚
â”‚  â”‚ [ğŸ’¬ è©¢å•ç´°ç¯€]   â”‚ [ğŸ’¬ è©¢å•ç´°ç¯€]   â”‚ [ğŸ’¬ è©¢å•ç´°ç¯€]   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚  â”ƒ  Layer 3: æˆ°ç•¥é åˆ¤èˆ‡é€£çµ (Strategic Foresight)           â”ƒ  â”‚
â”‚  â”ƒ  è·¨éƒ¨é–€çŸ¥è­˜é€£çµ + æ¨¡æ“¬æ¨æ¼” + æ±ºç­–å»ºè­°                      â”ƒ  â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– AI æˆ°ç•¥é åˆ¤ (Proactive Alerts)                      â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚
â”‚  â”‚ ğŸ”´ [ç•°å¸¸] è²¡å‹™éƒ¨ã€Œæˆæœ¬ä¸Šå‡ã€ èˆ‡ æ¡è³¼éƒ¨ã€Œä¾›æ‡‰å•†æ¼²åƒ¹ã€é«˜åº¦ç›¸é—œ   â”‚
â”‚  â”‚     â†’ å»ºè­°ç«‹å³å•Ÿå‹•ä¾›æ‡‰éˆè­°åƒ¹æœƒè­°                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.2 é—œéµæ ¸å¿ƒï¼šæ•¸æ“šèª¿å’Œèˆ‡æƒ…å ±å±¤ (Data Harmonization & Intelligence Layer)

**æ ¸å¿ƒå•é¡Œ**ï¼š
1.  **è³‡æ–™æ ¼å¼æ··äº‚**ï¼šè²¡å‹™éƒ¨ä¸Šå‚³çš„ CSV æ ¼å¼æ¯æœˆéƒ½è®Šï¼Œç›´æ¥ç•«åœ–æœƒå´©æ½°ã€‚
2.  **ç¼ºä¹è§€é»**ï¼šåªå­˜æ•¸æ“šæ²’ç”¨ï¼Œé‡é»æ˜¯ã€Œé€™ä»£è¡¨ä»€éº¼ï¼Ÿã€ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šåœ¨æ–‡ä»¶èˆ‡æˆ°æƒ…å®¤ä¹‹é–“ï¼Œå»ºç«‹**ã€Œæ™ºæ…§ä¸­ä»‹å±¤ã€**ã€‚

1.  **Metric Store (æŒ‡æ¨™å„²å­˜åº«)** - è™•ç†ã€Œç¡¬æ•¸æ“šã€
    *   **AI ETL**ï¼šç•¶æª”æ¡ˆ (CSV/Excel/PDF) ä¸Šå‚³ï¼ŒAI è‡ªå‹•è¾¨è­˜ä¸¦æ“·å–é—œéµæŒ‡æ¨™ (Key Metrics)ã€‚
    *   **æ¨™æº–åŒ–**ï¼šå°‡ `Total Sales`, `Revenue`, `ç‡Ÿæ¥­é¡` çµ±ä¸€æ˜ å°„ç‚º `metric:revenue`ã€‚
    *   **è¡çªè§£æ±º**ï¼šæ¡ `Latest File Wins` æˆ– `Confidence Check` æ©Ÿåˆ¶ï¼Œç¢ºä¿æˆ°æƒ…å®¤æ•¸æ“šæºå–®ä¸€ä¸”ä¹¾æ·¨ã€‚

2.  **Insight Store (æ´å¯Ÿå„²å­˜åº«)** - è™•ç†ã€Œè»Ÿæƒ…å ±ã€
    *   **æ‘˜è¦åŒæ­¥**ï¼šç•¶æ–‡ä»¶è¢« AI è§£è®€åˆ†é¡å¾Œï¼Œå…¶ã€Œæ‘˜è¦ (Summary)ã€èˆ‡ã€Œé—œéµç™¼ç¾ (Findings)ã€è‡ªå‹•åŒæ­¥è‡³æˆ°æƒ…å®¤ã€‚
    *   **ä¸»å‹•æ¨é€**ï¼šè‹¥æ‘˜è¦ä¸­åŒ…å«ã€Œé¢¨éšªã€ã€ã€Œå»¶é²ã€ã€ã€Œè™§æã€ç­‰é—œéµå­—ï¼Œæå‡å„ªå…ˆç´šï¼Œä¸»å‹•æ¨æ’­çµ¦ä¸»ç®¡ã€‚

---

### 6.2 ç¬¬ä¸€å±¤ï¼šå…¨å±€æ…‹å‹¢æ„ŸçŸ¥ (5 å¤§ KPI æ¨¡çµ„)

#### 6.2.1 æˆ°ç•¥åŸ·è¡Œåº¦ (Strategy Execution)

**æ•¸æ“šä¾†æº**ï¼š
- å¾çŸ¥è­˜æª”æ¡ˆä¸­æå–çš„ OKR ç›®æ¨™ï¼ˆä½¿ç”¨ NLP è­˜åˆ¥ç›®æ¨™èªå¥ï¼‰
- å°ˆæ¡ˆç®¡ç†ç³»çµ± APIï¼ˆè‹¥æ•´åˆï¼‰
- éƒ¨é–€ä¸Šå‚³çš„é€²åº¦å ±å‘Šæ–‡ä»¶

**AI è¨ˆç®—é‚è¼¯**ï¼š
```typescript
// lib/war-room/kpi/strategy-execution.ts

export class StrategyExecutionCalculator {
    async calculateExecutionRate(userId: string): Promise<StrategyKPI> {
        // 1. å¾çŸ¥è­˜åº«æå–æœ¬å¹´åº¦ç›®æ¨™æ–‡ä»¶
        const goalDocs = await this.extractGoalDocuments(userId);

        // 2. AI è§£æç›®æ¨™èˆ‡å®Œæˆç‹€æ…‹
        const objectives = await this.parseObjectivesWithAI(goalDocs);

        // 3. è¨ˆç®—å®Œæˆç‡
        const completedCount = objectives.filter(o => o.status === 'completed').length;
        const executionRate = (completedCount / objectives.length) * 100;

        // 4. AI ç”Ÿæˆæ´å¯Ÿ
        const insight = await this.generateInsight(objectives, executionRate);

        return {
            execution_rate: executionRate,
            total_objectives: objectives.length,
            completed: completedCount,
            on_track: objectives.filter(o => o.status === 'on_track').length,
            at_risk: objectives.filter(o => o.status === 'at_risk').length,
            ai_insight: insight,
            trend: this.calculateTrend(executionRate)
        };
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **ç’°å½¢é€²åº¦åœ–** (Radial Progress)ï¼šä¸­å¤®é¡¯ç¤ºç¸½é«”é”æˆç‡ 82%
- **å­£åº¦é‡Œç¨‹ç¢‘æ™‚é–“è»¸**ï¼šQ1 âœ… â†’ Q2 ğŸ”„ â†’ Q3 â¸ï¸ â†’ Q4 ğŸ“…
- **AI æ´å¯Ÿæ°£æ³¡**ï¼šã€ŒQ1 è¶…å‰ 5%ï¼Œå»ºè­°ææ—©å•Ÿå‹• Q2 é—œéµå°ˆæ¡ˆã€

---

#### 6.2.2 ç‡Ÿé‹å¥åº·åº¦ (Operational Health)

**æ•¸æ“šä¾†æº**ï¼š
- å„éƒ¨é–€æ–‡ä»¶ä¸Šå‚³é »ç‡èˆ‡æ´»èºåº¦
- Agent ä½¿ç”¨ç‡èˆ‡å°è©±å“è³ª
- çŸ¥è­˜åº«æ›´æ–°é »ç‡
- è·¨éƒ¨é–€çŸ¥è­˜å¼•ç”¨æ¬¡æ•¸ï¼ˆå¾èªç¾©åœ–è­œå–å¾—ï¼‰

**å¥åº·åº¦è©•åˆ†å…¬å¼**ï¼š
```typescript
// lib/war-room/kpi/operational-health.ts

export class OperationalHealthCalculator {
    async calculateHealthScore(userId: string): Promise<OperationalKPI> {
        const departments = await this.getUserDepartments(userId);

        let totalScore = 0;
        const deptScores: DepartmentScore[] = [];

        for (const dept of departments) {
            // 1. æ–‡ä»¶æ´»èºåº¦ (40%)
            const docActivity = await this.calculateDocActivity(dept.id);

            // 2. Agent ä½¿ç”¨ç‡ (30%)
            const agentUsage = await this.calculateAgentUsage(dept.id);

            // 3. çŸ¥è­˜æµå‹•æ€§ (20%)ï¼šè·¨éƒ¨é–€å¼•ç”¨æ¬¡æ•¸
            const knowledgeFlow = await this.calculateKnowledgeFlow(dept.id);

            // 4. çŸ¥è­˜å“è³ª (10%)
            const qualityScore = await this.calculateAverageQuality(dept.id);

            const deptScore =
                docActivity * 0.4 +
                agentUsage * 0.3 +
                knowledgeFlow * 0.2 +
                qualityScore * 0.1;

            deptScores.push({
                department_id: dept.id,
                department_name: dept.name,
                score: deptScore,
                metrics: { docActivity, agentUsage, knowledgeFlow, qualityScore }
            });

            totalScore += deptScore;
        }

        const overallHealth = totalScore / departments.length;

        return {
            overall_health: overallHealth,
            status: this.getHealthStatus(overallHealth),
            department_scores: deptScores,
            knowledge_flow_heatmap: await this.generateFlowHeatmap(departments),
            ai_alerts: await this.detectAnomalies(deptScores)
        };
    }

    private getHealthStatus(score: number): string {
        if (score >= 0.8) return 'excellent';
        if (score >= 0.6) return 'good';
        if (score >= 0.4) return 'fair';
        return 'needs_attention';
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **é›·é”åœ–**ï¼šå„éƒ¨é–€æ´»èºåº¦æ¯”è¼ƒ
- **çŸ¥è­˜æµå‹•ç†±åŠ›åœ–**ï¼šéƒ¨é–€é–“çŸ¥è­˜å¼•ç”¨é—œä¿‚ï¼ˆåŠ›å°å‘åœ–ï¼‰
- **ç•°å¸¸åµæ¸¬**ï¼šã€Œè²¡å‹™éƒ¨æœ¬é€±ä¸Šå‚³é‡ â†“30%ï¼Œå¯èƒ½éœ€é—œæ³¨ã€

---

#### 6.2.3 è²¡å‹™ç‹€æ…‹ (Financial Status)

**æ•¸æ“šä¾†æº**ï¼š
- è²¡å‹™å ±è¡¨æ–‡ä»¶ï¼ˆAI è‡ªå‹•è§£æï¼‰
- æœƒè¨ˆç³»çµ± APIï¼ˆè‹¥æ•´åˆï¼‰
- é ç®— vs å¯¦éš›æ”¯å‡ºå°æ¯”

**AI è²¡å‹™åˆ†æ**ï¼š
```typescript
// lib/war-room/kpi/financial-status.ts

export class FinancialStatusAnalyzer {
    async analyzeFinancials(userId: string): Promise<FinancialKPI> {
        // 1. æå–æœ€æ–°è²¡å‹™æ–‡ä»¶
        const financialDocs = await this.extractFinancialDocuments(userId);

        // 2. AI è§£æé—œéµæ•¸æ“š
        const parsedData = await this.parseFinancialsWithAI(financialDocs);

        // 3. è¨ˆç®—é—œéµæŒ‡æ¨™
        const revenue = parsedData.revenue;
        const expenses = parsedData.expenses;
        const budgetVsActual = this.calculateBudgetVariance(parsedData);
        const burnRate = this.calculateBurnRate(parsedData);
        const runway = this.calculateRunway(parsedData);

        // 4. é æ¸¬æœªä¾†è¶¨å‹¢
        const forecast = await this.generateForecast(parsedData);

        // 5. AI é¢¨éšªåµæ¸¬
        const risks = await this.detectFinancialRisks(parsedData);

        return {
            revenue,
            expenses,
            profit_margin: (revenue - expenses) / revenue,
            budget_variance: budgetVsActual,
            burn_rate: burnRate,
            runway_months: runway,
            forecast_next_quarter: forecast,
            risks,
            ai_insight: await this.generateFinancialInsight(parsedData, risks)
        };
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **æŠ˜ç·šåœ– + é æ¸¬å€é–“**ï¼šç‡Ÿæ”¶è¶¨å‹¢ï¼ˆå¯¦éš› vs é ç®— vs AI é æ¸¬ï¼‰
- **ç‡ƒç‡’ç‡å„€è¡¨æ¿**ï¼šè³‡é‡‘å¯ç”¨æœˆæ•¸ï¼ˆRunwayï¼‰
- **æˆæœ¬çµæ§‹æ¨¹ç‹€åœ–**ï¼šå„éƒ¨é–€æ”¯å‡ºä½”æ¯”

---

#### 6.2.4 é¢¨éšªé è­¦ (Risk Alerts)

**é¢¨éšªä¾†æº**ï¼š
```typescript
// lib/war-room/kpi/risk-alerts.ts

export class RiskAlertSystem {
    async detectRisks(userId: string): Promise<RiskKPI> {
        const risks: Risk[] = [];

        // 1. çŸ¥è­˜æ™‚æ•ˆæ€§é¢¨éšª
        const knowledgeRisks = await this.detectKnowledgeDecay(userId);
        risks.push(...knowledgeRisks);

        // 2. å¤–éƒ¨æ–°èæƒ…è³‡é¢¨éšªï¼ˆä¾›æ‡‰éˆã€ç«¶çˆ­å°æ‰‹ã€æ³•è¦ï¼‰
        const externalRisks = await this.detectExternalRisks(userId);
        risks.push(...externalRisks);

        // 3. åˆè¦æ–‡ä»¶åˆ°æœŸé¢¨éšª
        const complianceRisks = await this.detectComplianceExpiry(userId);
        risks.push(...complianceRisks);

        // 4. å…§éƒ¨çŸ¥è­˜è¡çª
        const conflictRisks = await this.detectKnowledgeConflicts(userId);
        risks.push(...conflictRisks);

        // 5. éƒ¨é–€ç•°å¸¸æ´»å‹•
        const operationalRisks = await this.detectOperationalAnomalies(userId);
        risks.push(...operationalRisks);

        // æ’åºï¼šæŒ‰å½±éŸ¿åº¦ Ã— ç·Šæ€¥åº¦
        risks.sort((a, b) => (b.impact * b.urgency) - (a.impact * a.urgency));

        return {
            total_risks: risks.length,
            critical: risks.filter(r => r.level === 'critical').length,
            high: risks.filter(r => r.level === 'high').length,
            medium: risks.filter(r => r.level === 'medium').length,
            risks: risks.slice(0, 10), // é¡¯ç¤ºå‰ 10 å€‹æœ€é‡è¦
            risk_matrix: this.generateRiskMatrix(risks),
            timeline: this.generateRiskTimeline(risks)
        };
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **é¢¨éšªçŸ©é™£**ï¼šå½±éŸ¿åº¦ (Y è»¸) vs å¯èƒ½æ€§ (X è»¸)
- **æ™‚é–“è»¸é è­¦**ï¼šæœªä¾† 7/30/90 å¤©é¢¨éšªäº‹ä»¶
- **é¢¨éšªå¡ç‰‡**ï¼š
  ```
  ğŸ”´ é«˜é¢¨éšª | 15 å¤©å¾Œ
  ISO èªè­‰å³å°‡åˆ°æœŸï¼Œéœ€ç«‹å³ç”³è«‹çºŒæœŸ
  [æŸ¥çœ‹æ–‡ä»¶] [å•Ÿå‹•æµç¨‹] [å§”æ´¾è² è²¬äºº]
  ```

---

#### 6.2.5 å¤–éƒ¨æƒ…è³‡ä¸­å¿ƒ (External Intelligence)

**æ ¸å¿ƒåŠŸèƒ½**ï¼šä½¿ç”¨è€…è‡ªè¨‚ç›£æ§ä¸»é¡Œï¼ŒAI è‡ªå‹•æŠ“å–èˆ‡åˆ†æç›¸é—œæ–°è

**è³‡æ–™æ¨¡å‹**ï¼š
```typescript
// lib/war-room/intelligence/watch-topic.ts

export interface WatchTopic {
    id: string;
    user_id: string;
    name: string;                    // å¦‚ã€ŒåŠå°é«”ä¾›æ‡‰éˆå‹•æ…‹ã€
    keywords: string[];              // ['å°ç©é›»', 'æ™¶ç‰‡çŸ­ç¼º', 'ASML']
    news_sources: string[];          // ['Bloomberg', 'Reuters', 'TechCrunch']
    competitors: string[];           // ç«¶çˆ­å°æ‰‹åå–®
    suppliers: string[];             // ä¾›æ‡‰å•†åå–®
    customers: string[];             // é—œéµå®¢æˆ¶åå–®
    risk_threshold: 'low' | 'medium' | 'high'; // åªæ¨é€é”æ¨™çš„æ–°è
    notification_enabled: boolean;
    created_at: string;
}

export interface IntelligenceNews {
    id: string;
    topic_id: string;
    title: string;
    source: string;
    url: string;
    published_at: string;

    // AI åˆ†æçµæœ
    relevance_score: number;         // 0-1ï¼Œèˆ‡æ¥­å‹™çš„ç›¸é—œåº¦
    risk_level: 'low' | 'medium' | 'high' | 'critical';
    impact_areas: string[];          // ['supply_chain', 'pricing', 'competition']
    sentiment: 'positive' | 'neutral' | 'negative';
    ai_summary: string;              // 100 å­—æ‘˜è¦
    key_points: string[];            // 3-5 å€‹é‡é»
    affected_entities: {             // å½±éŸ¿çš„å¯¦é«”
        competitors?: string[];
        suppliers?: string[];
        customers?: string[];
    };

    // ä½¿ç”¨è€…äº’å‹•
    is_read: boolean;
    is_bookmarked: boolean;
    user_notes?: string;
}
```

**AI æ–°èåˆ†ææµç¨‹**ï¼š
```typescript
// lib/war-room/intelligence/news-analyzer.ts

export class NewsIntelligenceAnalyzer {
    /**
     * å®šæ™‚ä»»å‹™ï¼šæ¯å°æ™‚æŠ“å–èˆ‡åˆ†ææ–°è
     */
    async fetchAndAnalyzeNews() {
        const topics = await this.getAllActiveTopics();

        for (const topic of topics) {
            // 1. å¾ NewsAPI / Google News æŠ“å–
            const rawNews = await this.fetchNewsFromAPIs(topic);

            // 2. AI éæ¿¾ç›¸é—œæ€§
            const relevantNews = await this.filterByRelevance(rawNews, topic);

            // 3. AI æ·±åº¦åˆ†æ
            for (const news of relevantNews) {
                const analysis = await this.analyzeWithAI(news, topic);

                // 4. å„²å­˜åˆ°è³‡æ–™åº«
                await this.saveIntelligence({
                    ...news,
                    ...analysis,
                    topic_id: topic.id
                });

                // 5. é«˜é¢¨éšªæ–°èç«‹å³æ¨é€
                if (analysis.risk_level === 'critical' || analysis.risk_level === 'high') {
                    await this.sendInstantNotification(topic.user_id, news, analysis);
                }
            }
        }
    }

    /**
     * AI åˆ†æå–®ä¸€æ–°è
     */
    private async analyzeWithAI(
        news: RawNews,
        topic: WatchTopic
    ): Promise<NewsAnalysis> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­æƒ…å ±åˆ†æå°ˆå®¶ã€‚è«‹åˆ†æä»¥ä¸‹æ–°èå°ä¼æ¥­çš„å½±éŸ¿ï¼š

ã€æ–°èå…§å®¹ã€‘
æ¨™é¡Œï¼š${news.title}
ä¾†æºï¼š${news.source}
å…§å®¹ï¼š${news.content}

ã€ä¼æ¥­èƒŒæ™¯ã€‘
ç›£æ§ä¸»é¡Œï¼š${topic.name}
é—œæ³¨é—œéµå­—ï¼š${topic.keywords.join(', ')}
ç«¶çˆ­å°æ‰‹ï¼š${topic.competitors.join(', ')}
ä¾›æ‡‰å•†ï¼š${topic.suppliers.join(', ')}
é—œéµå®¢æˆ¶ï¼š${topic.customers.join(', ')}

è«‹ä»¥ JSON æ ¼å¼å›è¦†ï¼š
{
  "relevance_score": 0-1 ä¹‹é–“çš„æ•¸å­—,
  "risk_level": "low" | "medium" | "high" | "critical",
  "impact_areas": ["supply_chain", "pricing", "competition", "regulation", "technology"],
  "sentiment": "positive" | "neutral" | "negative",
  "ai_summary": "100å­—å…§çš„æ‘˜è¦",
  "key_points": ["é‡é»1", "é‡é»2", "é‡é»3"],
  "affected_entities": {
    "competitors": ["å—å½±éŸ¿çš„ç«¶çˆ­å°æ‰‹"],
    "suppliers": ["å—å½±éŸ¿çš„ä¾›æ‡‰å•†"],
    "customers": ["å—å½±éŸ¿çš„å®¢æˆ¶"]
  },
  "recommended_actions": ["å»ºè­°çš„æ‡‰å°æªæ–½"]
}
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ å¤–éƒ¨æƒ…è³‡ä¸­å¿ƒ (5 å‰‡é‡è¦æ›´æ–°)                           â”‚
â”‚ [âš™ï¸ ç®¡ç†ç›£æ§ä¸»é¡Œ]                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ ç·Šæ€¥ | 30 åˆ†é˜å‰ | ä¾›æ‡‰éˆé¢¨éšª                         â”‚
â”‚ ä¾›æ‡‰å•† XYZ å®£å¸ƒåœç”¢é—œéµçµ„ä»¶ ABC-123                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ ğŸ“ å½±éŸ¿é ˜åŸŸï¼šä¾›æ‡‰éˆã€ç”Ÿç”¢è¨ˆç•«                            â”‚
â”‚ ğŸ’¡ AI å»ºè­°ï¼š                                             â”‚
â”‚    1. ç«‹å³è¯ç¹«ä¾›æ‡‰å•† B è©¢å•æ›¿ä»£æ–¹æ¡ˆ                      â”‚
â”‚    2. è©•ä¼°åº«å­˜å¯æ”¯æ’å¤©æ•¸ï¼ˆé ä¼° 45 å¤©ï¼‰                   â”‚
â”‚    3. é€šçŸ¥ç”Ÿç”¢éƒ¨èª¿æ•´ Q2 æ’ç¨‹                             â”‚
â”‚ [ğŸ”— æŸ¥çœ‹æ–°è] [ğŸ’¬ è©¢å• AI] [âœ… æ¨™è¨˜å·²è™•ç†]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ é‡è¦ | 2 å°æ™‚å‰ | ç«¶çˆ­å‹•æ…‹                            â”‚
â”‚ ç«¶çˆ­å°æ‰‹æ¨å‡ºä½åƒ¹æ–¹æ¡ˆï¼Œåƒ¹æ ¼æ¯”æˆ‘å€‘ä½ 20%                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ ğŸ“ å½±éŸ¿é ˜åŸŸï¼šå®šåƒ¹ç­–ç•¥ã€å¸‚å ´ä½”æœ‰ç‡                        â”‚
â”‚ ğŸ’¡ AI å»ºè­°ï¼š                                             â”‚
â”‚    1. åˆ†æå°æ–¹æˆæœ¬çµæ§‹ï¼ˆå¯èƒ½çŠ§ç‰²åˆ©æ½¤æ¶å¸‚å ´ï¼‰             â”‚
â”‚    2. è©•ä¼°æ˜¯å¦è·Ÿé€²é™åƒ¹ vs å¼·åŒ–å·®ç•°åŒ–                     â”‚
â”‚ [ğŸ”— æŸ¥çœ‹æ–°è] [ğŸ’¬ è©¢å• AI] [ğŸ“Š ç«¶å“åˆ†æ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨è€…è¨­å®šä»‹é¢**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ç®¡ç†æƒ…è³‡ç›£æ§ä¸»é¡Œ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°å¢ç›£æ§ä¸»é¡Œ]                                         â”‚
â”‚                                                          â”‚
â”‚ ğŸ“Œ åŠå°é«”ä¾›æ‡‰éˆå‹•æ…‹                    [âœï¸ ç·¨è¼¯] [ğŸ—‘ï¸ åˆªé™¤]â”‚
â”‚    é—œéµå­—ï¼šå°ç©é›», æ™¶ç‰‡çŸ­ç¼º, ASML                        â”‚
â”‚    ä¾›æ‡‰å•†ï¼šXYZ Corp, ABC Ltd                             â”‚
â”‚    é¢¨éšªé–¾å€¼ï¼šğŸŸ¡ ä¸­ç­‰ä»¥ä¸Š                                 â”‚
â”‚    æœ¬é€±æ–°èï¼š12 å‰‡ï¼ˆ3 å‰‡é«˜é¢¨éšªï¼‰                         â”‚
â”‚                                                          â”‚
â”‚ ğŸ“Œ AI æŠ€è¡“è¶¨å‹¢                         [âœï¸ ç·¨è¼¯] [ğŸ—‘ï¸ åˆªé™¤]â”‚
â”‚    é—œéµå­—ï¼šGPT, Claude, LLM, AI Agent                   â”‚
â”‚    ç«¶çˆ­å°æ‰‹ï¼šOpenAI, Google, Microsoft                  â”‚
â”‚    é¢¨éšªé–¾å€¼ï¼šğŸŸ¢ å…¨éƒ¨é¡¯ç¤º                                 â”‚
â”‚    æœ¬é€±æ–°èï¼š8 å‰‡ï¼ˆ0 å‰‡é«˜é¢¨éšªï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6.3 ç¬¬äºŒå±¤ï¼šéƒ¨é–€æˆ°æƒ…æ¨¡çµ„

#### éƒ¨é–€å¡ç‰‡è³‡æ–™æ¨¡å‹

```typescript
// lib/war-room/department/department-card.ts

export interface DepartmentCard {
    department_id: string;
    department_name: string;
    department_icon: string;

    // å³æ™‚çµ±è¨ˆ
    stats: {
        total_files: number;
        files_updated_today: number;
        files_updated_this_week: number;
        active_agents: number;
        total_conversations_this_week: number;
        knowledge_health_score: number; // 0-100
    };

    // AI è‡ªå‹•ç”Ÿæˆçš„éƒ¨é–€æ—¥å ±èˆ‡æƒ…å ±æµ
    daily_brief: {
        generated_at: string;
        // ä¾†è‡ª Insight Store çš„åŒæ­¥æ‘˜è¦
        synced_insights: Array<{
            source_file: string;    // ä¾‹å¦‚ "2024_Q1_Revenue.csv"
            summary: string;        // "ç‡Ÿæ”¶æˆé•· 15%ï¼Œä½†æ¯›åˆ©ä¸‹é™ 2%"
            detected_at: string;
            significance: 'high' | 'medium' | 'low';
        }>;
        top_3_updates: string[];        // æœ€é‡è¦çš„ 3 å€‹æ›´æ–°
        key_metrics: Array<{
            label: string;
            value: string;
            trend: 'up' | 'down' | 'stable';
            change_percentage?: number;
            source_id?: string;     // é€£çµå› Metric Store
        }>;
        urgent_items: string[];         // éœ€ç«‹å³é—œæ³¨
        ai_summary: string;             // 100 å­—éƒ¨é–€ç¾æ³ç¸½çµ
    };

    // äº’å‹•åŠŸèƒ½
    actions: {
        start_conversation: boolean;
        view_full_report: boolean;
        download_pdf: boolean;
        view_knowledge_graph: boolean;
    };
}
```

#### AI éƒ¨é–€æ—¥å ±ç”Ÿæˆå™¨

```typescript
// lib/war-room/department/daily-brief-generator.ts

export class DepartmentDailyBriefGenerator {
    /**
     * ç‚ºå–®ä¸€éƒ¨é–€ç”Ÿæˆ AI æ—¥å ±
     */
    async generateDailyBrief(departmentId: string): Promise<DailyBrief> {
        // 1. å–å¾—éƒ¨é–€è¿‘ 7 å¤©çš„æ‰€æœ‰æ–‡ä»¶æ›´æ–°
        const recentFiles = await this.getRecentFiles(departmentId, 7);

        // 2. å–å¾—éƒ¨é–€ Agent çš„å°è©±è¨˜éŒ„
        const conversations = await this.getRecentConversations(departmentId, 7);

        // 3. è¨ˆç®—é—œéµæŒ‡æ¨™è®ŠåŒ–
        const metrics = await this.calculateMetrics(departmentId);

        // 4. AI åˆ†æï¼šæå–é‡é»
        const analysis = await this.analyzeWithAI(recentFiles, conversations, metrics);

        return {
            generated_at: new Date().toISOString(),
            top_3_updates: analysis.top_updates,
            key_metrics: metrics,
            urgent_items: analysis.urgent_items,
            ai_summary: analysis.summary
        };
    }

    /**
     * AI åˆ†æéƒ¨é–€å‹•æ…‹
     */
    private async analyzeWithAI(
        files: File[],
        conversations: Conversation[],
        metrics: Metric[]
    ): Promise<AIAnalysis> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­ç®¡ç†é¡§å•ã€‚è«‹åˆ†æä»¥ä¸‹éƒ¨é–€çš„æœ¬é€±å‹•æ…‹ä¸¦ç”Ÿæˆç°¡å ±ï¼š

ã€æœ¬é€±æ–°å¢/æ›´æ–°æ–‡ä»¶ã€‘
${files.map(f => `- ${f.filename} (${f.category})`).join('\n')}

ã€æœ¬é€± Agent å°è©±é‡é»ã€‘
${conversations.map(c => `- ${c.summary}`).join('\n')}

ã€é—œéµæŒ‡æ¨™è®ŠåŒ–ã€‘
${metrics.map(m => `- ${m.label}: ${m.value} (${m.trend} ${m.change_percentage}%)`).join('\n')}

è«‹ä»¥ JSON æ ¼å¼å›è¦†ï¼š
{
  "top_updates": ["æœ€é‡è¦çš„æ›´æ–°1", "æ›´æ–°2", "æ›´æ–°3"],
  "urgent_items": ["éœ€ç«‹å³é—œæ³¨çš„äº‹é …"],
  "summary": "100å­—å…§çš„éƒ¨é–€ç¾æ³ç¸½çµï¼Œå°ˆæ¥­ä¸”ç²¾ç…‰",
  "insights": ["æ´å¯Ÿ1", "æ´å¯Ÿ2"]
}
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

#### å°è©±å¼æ·±å…¥æ¢æŸ¥ (Conversational Drill-Down)

ç•¶ä½¿ç”¨è€…é»æ“Šã€ŒğŸ’¬ å°è©±ã€æŒ‰éˆ•ï¼š

```typescript
// lib/war-room/department/conversation-modal.ts

export class DepartmentConversationModal {
    /**
     * å•Ÿå‹•éƒ¨é–€å°è©±ï¼ˆè‡ªå‹•è¼‰å…¥è©²éƒ¨é–€æ‰€æœ‰çŸ¥è­˜ï¼‰
     */
    async startConversation(departmentId: string): Promise<ConversationSession> {
        // 1. å–å¾—éƒ¨é–€æ‰€æœ‰æ–‡ä»¶
        const departmentFiles = await this.getDepartmentFiles(departmentId);

        // 2. å»ºç«‹è‡¨æ™‚ Agentï¼ˆé è¼‰å…¥éƒ¨é–€çŸ¥è­˜ï¼‰
        const tempAgent = await this.createDepartmentAgent(departmentId, departmentFiles);

        // 3. AI ç”Ÿæˆå»ºè­°å•é¡Œ
        const suggestedQuestions = await this.generateSuggestedQuestions(
            departmentId,
            departmentFiles
        );

        return {
            session_id: generateSessionId(),
            agent_id: tempAgent.id,
            department_id: departmentId,
            suggested_questions: suggestedQuestions,
            context_loaded: true
        };
    }

    /**
     * AI ç”Ÿæˆå»ºè­°å•é¡Œ
     */
    private async generateSuggestedQuestions(
        departmentId: string,
        files: File[]
    ): Promise<string[]> {
        const recentUpdates = files.slice(0, 5);

        const prompt = `
æ ¹æ“šä»¥ä¸‹éƒ¨é–€æœ€è¿‘çš„æ–‡ä»¶æ›´æ–°ï¼Œç”Ÿæˆ 5 å€‹é«˜éšä¸»ç®¡å¯èƒ½æƒ³å•çš„å•é¡Œï¼š

ã€æœ€è¿‘æ›´æ–°ã€‘
${recentUpdates.map(f => `- ${f.filename}`).join('\n')}

è¦æ±‚ï¼š
1. å•é¡Œè¦èšç„¦æ–¼æ±ºç­–æ”¯æ´ï¼ˆä¸æ˜¯ç´°ç¯€æŸ¥è©¢ï¼‰
2. æ¶µè“‹è¶¨å‹¢åˆ†æã€é¢¨éšªè­˜åˆ¥ã€æ©Ÿæœƒç™¼ç¾
3. æ¯å€‹å•é¡Œä¸è¶…é 20 å­—

ç¯„ä¾‹ï¼š
- æœ¬æœˆæ¥­ç¸¾ä¸‹æ»‘çš„ä¸»è¦åŸå› æ˜¯ä»€éº¼ï¼Ÿ
- å“ªäº›ç”¢å“ç·šè¡¨ç¾æœ€å¥½ï¼Ÿ
- ç«¶å“åˆ†æä¸­æœ€å¤§çš„å¨è„…æ˜¯ä»€éº¼ï¼Ÿ
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return this.parseQuestions(response);
    }
}
```

**å°è©±ä»‹é¢è¨­è¨ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ èˆ‡æ¥­å‹™éƒ¨å°è©±                              [âœ• é—œé–‰]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ ğŸ¤– å·²è¼‰å…¥æ¥­å‹™éƒ¨çš„ 23 ä»½æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥è©¢å•ä»»ä½•å•é¡Œ     â”‚
â”‚                                                          â”‚
â”‚ ğŸ’¡ å»ºè­°å•é¡Œï¼š                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â€¢ æœ¬æœˆæ¥­ç¸¾é”æˆç‡ç‚ºä½•ï¼Ÿä¸»è¦è²¢ç»ä¾†è‡ªå“ªäº›ç”¢å“ï¼Ÿ      â”‚   â”‚
â”‚ â”‚ â€¢ æœ¬é€±ç°½ç´„çš„å¤§å®¢æˆ¶ ABCï¼Œåˆç´„å…§å®¹é‡é»æ˜¯ä»€éº¼ï¼Ÿ     â”‚   â”‚
â”‚ â”‚ â€¢ ç«¶å“åˆ†æå ±å‘Šä¸­ï¼Œå°æ‰‹çš„æœ€å¤§å„ªå‹¢æ˜¯ä»€éº¼ï¼Ÿ         â”‚   â”‚
â”‚ â”‚ â€¢ å®¢æˆ¶åé¥‹ä¸­æœ€å¸¸æåˆ°çš„ç—›é»æ˜¯ä»€éº¼ï¼Ÿ               â”‚   â”‚
â”‚ â”‚ â€¢ é æ¸¬ Q2 èƒ½å¦é”æˆç›®æ¨™ï¼Ÿ                          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ æ‚¨çš„å•é¡Œï¼š                                       â”‚ â”‚
â”‚ â”‚ [                                                  ]â”‚ â”‚
â”‚ â”‚                                            [ğŸ“¤ é€å‡º]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ ğŸ” å¼•ç”¨ä¾†æºæœƒè‡ªå‹•æ¨™è¨»åœ¨å›ç­”ä¸­                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6.4 ç¬¬ä¸‰å±¤ï¼šAI æ™ºèƒ½æ´å¯Ÿ

#### è·¨éƒ¨é–€çŸ¥è­˜é€£çµ (Cross-Department Insights)

```typescript
// lib/war-room/insights/cross-department-linker.ts

export class CrossDepartmentInsightEngine {
    /**
     * ç™¼ç¾è·¨éƒ¨é–€çš„çŸ¥è­˜é€£çµèˆ‡æ©Ÿæœƒ
     */
    async discoverCrossDepartmentInsights(userId: string): Promise<Insight[]> {
        const insights: Insight[] = [];

        // 1. å–å¾—æ‰€æœ‰éƒ¨é–€æœ€è¿‘çš„æ–‡ä»¶
        const departments = await this.getUserDepartments(userId);
        const recentFilesByDept = new Map<string, File[]>();

        for (const dept of departments) {
            recentFilesByDept.set(
                dept.id,
                await this.getRecentFiles(dept.id, 7)
            );
        }

        // 2. å…©å…©æ¯”è¼ƒéƒ¨é–€ï¼Œå°‹æ‰¾èªç¾©é—œè¯
        for (let i = 0; i < departments.length; i++) {
            for (let j = i + 1; j < departments.length; j++) {
                const deptA = departments[i];
                const deptB = departments[j];

                const filesA = recentFilesByDept.get(deptA.id) || [];
                const filesB = recentFilesByDept.get(deptB.id) || [];

                // 3. AI åˆ†æé—œè¯æ€§
                const connections = await this.findConnections(
                    deptA, filesA,
                    deptB, filesB
                );

                insights.push(...connections);
            }
        }

        // 4. æŒ‰é‡è¦æ€§æ’åº
        insights.sort((a, b) => b.importance_score - a.importance_score);

        return insights.slice(0, 5); // é¡¯ç¤ºå‰ 5 å€‹æœ€é‡è¦
    }

    /**
     * AI åˆ†æå…©éƒ¨é–€é–“çš„çŸ¥è­˜é€£çµ
     */
    private async findConnections(
        deptA: Department, filesA: File[],
        deptB: Department, filesB: File[]
    ): Promise<Insight[]> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­æˆ°ç•¥é¡§å•ã€‚è«‹åˆ†æä»¥ä¸‹å…©å€‹éƒ¨é–€çš„æœ€æ–°å‹•æ…‹ï¼Œæ‰¾å‡ºæ½›åœ¨çš„å”ä½œæ©Ÿæœƒæˆ–é¢¨éšªï¼š

ã€${deptA.name}ã€‘
${filesA.map(f => `- ${f.filename}: ${f.ai_summary}`).join('\n')}

ã€${deptB.name}ã€‘
${filesB.map(f => `- ${f.filename}: ${f.ai_summary}`).join('\n')}

è«‹æ‰¾å‡ºï¼š
1. å…©éƒ¨é–€è³‡è¨Šçš„é—œè¯æ€§ï¼ˆå¦‚ç ”ç™¼æ–°æŠ€è¡“å¯æ‡‰ç”¨æ–¼æ¥­å‹™æ¨å»£ï¼‰
2. æ½›åœ¨çš„å”ä½œæ©Ÿæœƒ
3. è³‡è¨Šä¸ä¸€è‡´æˆ–è¡çª

ä»¥ JSON æ ¼å¼å›è¦†ï¼ˆå¦‚ç„¡ç™¼ç¾å‰‡å›å‚³ç©ºé™£åˆ—ï¼‰ï¼š
[
  {
    "type": "opportunity" | "risk" | "conflict",
    "title": "ç°¡çŸ­æ¨™é¡Œï¼ˆä¸è¶…é 30 å­—ï¼‰",
    "description": "è©³ç´°èªªæ˜",
    "departments": ["${deptA.id}", "${deptB.id}"],
    "related_files": ["file_id_1", "file_id_2"],
    "importance_score": 0-1,
    "recommended_action": "å»ºè­°è¡Œå‹•"
  }
]
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

#### æˆ°ç•¥å»ºè­°å¼•æ“ (Strategy Recommendation Engine)

```typescript
// lib/war-room/insights/strategy-recommender.ts

export class StrategyRecommendationEngine {
    /**
     * ç”Ÿæˆæœ¬é€±æˆ°ç•¥å»ºè­°
     */
    async generateWeeklyRecommendations(userId: string): Promise<Recommendation[]> {
        const recommendations: Recommendation[] = [];

        // 1. å¾å„æ¨¡çµ„æ”¶é›†æ´å¯Ÿ
        const riskInsights = await this.getRiskInsights(userId);
        const opportunityInsights = await this.getOpportunityInsights(userId);
        const crossDeptInsights = await this.getCrossDeptInsights(userId);
        const externalInsights = await this.getExternalInsights(userId);

        // 2. AI ç¶œåˆåˆ†æï¼Œç”Ÿæˆæˆ°ç•¥å»ºè­°
        const strategicRecommendations = await this.synthesizeRecommendations([
            ...riskInsights,
            ...opportunityInsights,
            ...crossDeptInsights,
            ...externalInsights
        ]);

        return strategicRecommendations;
    }

    private async synthesizeRecommendations(
        insights: Insight[]
    ): Promise<Recommendation[]> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­æˆ°ç•¥é¡§å•ã€‚åŸºæ–¼ä»¥ä¸‹æ´å¯Ÿï¼Œç”Ÿæˆ 3-5 å€‹æˆ°ç•¥å»ºè­°ï¼š

ã€æ´å¯Ÿå½™ç¸½ã€‘
${insights.map(i => `[${i.type}] ${i.title}: ${i.description}`).join('\n\n')}

è¦æ±‚ï¼š
1. å»ºè­°è¦å¯åŸ·è¡Œï¼ˆä¸æ˜¯ç©ºæ³›çš„ã€ŒåŠ å¼·XXXã€ï¼‰
2. æ¨™è¨»å„ªå…ˆç´šï¼ˆé«˜/ä¸­/ä½ï¼‰
3. èªªæ˜é æœŸæ•ˆç›Š
4. åˆ—å‡ºä¾æ“šçš„æª”æ¡ˆä¾†æº

ä»¥ JSON æ ¼å¼å›è¦†ï¼š
[
  {
    "priority": "high" | "medium" | "low",
    "category": "risk_mitigation" | "opportunity" | "efficiency" | "innovation",
    "title": "å»ºè­°æ¨™é¡Œ",
    "problem": "è§£æ±ºä»€éº¼å•é¡Œæˆ–æŠ“ä½ä»€éº¼æ©Ÿæœƒ",
    "recommendation": "å…·é«”å»ºè­°è¡Œå‹•",
    "expected_benefit": "é æœŸæ•ˆç›Š",
    "evidence_files": ["file_id_1", "file_id_2"],
    "next_steps": ["æ­¥é©Ÿ1", "æ­¥é©Ÿ2"]
  }
]
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– æœ¬é€± AI æˆ°ç•¥å»ºè­° (3 é …)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ [é«˜å„ªå…ˆç´š] ä¾›æ‡‰éˆé¢¨éšªç·©è§£                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ğŸ“Œ å•é¡Œï¼šä¾›æ‡‰å•† A åƒ¹æ ¼ä¸Šæ¼² 15%ï¼Œå½±éŸ¿ Q2 æˆæœ¬          â”‚
â”‚ ğŸ’¡ å»ºè­°ï¼š                                             â”‚
â”‚    1. è¯ç¹«ä¾›æ‡‰å•† B èˆ‡ C è©¢åƒ¹ï¼ˆé ä¼°å¯é™ä½ 8% æˆæœ¬ï¼‰    â”‚
â”‚    2. è©•ä¼°æå‰æ¡è³¼ 3 å€‹æœˆåº«å­˜ä»¥é–å®šåƒ¹æ ¼               â”‚
â”‚    3. ç ”ç™¼éƒ¨è©•ä¼°æ›¿ä»£ææ–™å¯è¡Œæ€§                        â”‚
â”‚ ğŸ“Š é æœŸæ•ˆç›Šï¼šç¯€çœ $50K æˆæœ¬ï¼Œé™ä½ä¾›æ‡‰é¢¨éšª             â”‚
â”‚ ğŸ“ ä¾æ“šï¼šæ¡è³¼éƒ¨_ä¾›æ‡‰å•†å ±åƒ¹å–®.pdfã€è²¡å‹™éƒ¨_æˆæœ¬åˆ†æ.xlsxâ”‚
â”‚                                                       â”‚
â”‚ [âœ… æ¨™è¨˜åŸ·è¡Œä¸­] [ğŸ“… è¨­å®šæé†’] [ğŸ’¬ è¨è«–] [â­ï¸ å»¶å¾Œ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ [ä¸­å„ªå…ˆç´š] ç”¢å“å‰µæ–°æ©Ÿæœƒ                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ğŸ“Œ æ©Ÿæœƒï¼šå®¢æˆ¶è©¢å•ã€ŒAI æ•´åˆã€é—œéµå­—å¢é•· 60% (æœ¬é€±)     â”‚
â”‚ ğŸ’¡ å»ºè­°ï¼š                                             â”‚
â”‚    1. ç ”ç™¼éƒ¨è©•ä¼°åœ¨ç¾æœ‰ç”¢å“åŠ å…¥ AI åŠŸèƒ½çš„æŠ€è¡“å¯è¡Œæ€§    â”‚
â”‚    2. æ¥­å‹™éƒ¨èª¿æŸ¥å®¢æˆ¶å…·é«”éœ€æ±‚èˆ‡ä»˜è²»æ„é¡˜               â”‚
â”‚    3. ç”¢å“éƒ¨è¦åŠƒ Roadmapï¼ŒQ3 æ¨å‡º MVP                â”‚
â”‚ ğŸ“Š é æœŸæ•ˆç›Šï¼šé–‹æ‹“æ–°å¸‚å ´ï¼Œé ä¼°å¢åŠ  15% ç‡Ÿæ”¶            â”‚
â”‚ ğŸ“ ä¾æ“šï¼šæ¥­å‹™éƒ¨_å®¢æˆ¶éœ€æ±‚åˆ†æ.pdfã€ç ”ç™¼éƒ¨_æŠ€è¡“è©•ä¼°.md â”‚
â”‚                                                       â”‚
â”‚ [âœ… æ¨™è¨˜åŸ·è¡Œä¸­] [ğŸ“… è¨­å®šæé†’] [ğŸ’¬ è¨è«–] [â­ï¸ å»¶å¾Œ]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6.5 æ¬Šé™åˆ†ç´šè¨­è¨ˆ

```typescript
// lib/war-room/permissions/access-control.ts

export enum WarRoomAccessLevel {
    DENIED = 'denied',           // ç„¡æ¬Šé™
    DEPARTMENT = 'department',   // éƒ¨é–€ä¸»ç®¡ï¼šåªèƒ½çœ‹æœ¬éƒ¨é–€
    EXECUTIVE = 'executive',     // C-Levelï¼šå¯çœ‹æ‰€æœ‰éƒ¨é–€
    OWNER = 'owner'              // ä¼æ¥­ä¸»ï¼šå®Œæ•´æ§åˆ¶
}

export class WarRoomAccessControl {
    async checkAccess(userId: string): Promise<WarRoomAccessLevel> {
        const user = await this.getUserProfile(userId);

        // ä¼æ¥­ä¸»
        if (user.role === 'owner') {
            return WarRoomAccessLevel.OWNER;
        }

        // C-Level é«˜éšä¸»ç®¡
        if (['ceo', 'cfo', 'cto', 'coo'].includes(user.role)) {
            return WarRoomAccessLevel.EXECUTIVE;
        }

        // éƒ¨é–€ä¸»ç®¡
        if (user.is_department_head) {
            return WarRoomAccessLevel.DEPARTMENT;
        }

        // ä¸€èˆ¬å“¡å·¥ç„¡æ¬Šé™
        return WarRoomAccessLevel.DENIED;
    }

    async filterVisibleDepartments(
        userId: string,
        allDepartments: Department[]
    ): Promise<Department[]> {
        const accessLevel = await this.checkAccess(userId);

        if (accessLevel === WarRoomAccessLevel.OWNER ||
            accessLevel === WarRoomAccessLevel.EXECUTIVE) {
            return allDepartments; // å¯è¦‹æ‰€æœ‰éƒ¨é–€
        }

        if (accessLevel === WarRoomAccessLevel.DEPARTMENT) {
            const user = await this.getUserProfile(userId);
            const userDept = allDepartments.find(d => d.id === user.department_id);

            if (!userDept) return [];

            // å¯è¦‹æœ¬éƒ¨é–€ + ç›¸é—œéƒ¨é–€ï¼ˆæ‘˜è¦æ¨¡å¼ï¼‰
            return allDepartments.filter(d =>
                d.id === userDept.id ||
                userDept.related_departments.includes(d.id)
            );
        }

        return []; // ç„¡æ¬Šé™
    }
}

/**
 * 6.1.5 æ•¸æ“šèª¿å’Œèˆ‡æƒ…å ±å±¤å¯¦ä½œ (Metric & Insight Store)
 */

// lib/war-room/intelligence/metric-store.ts

export interface MetricDefinition {
    id: string;               // e.g., 'finance_revenue'
    name: string;             // 'æœˆç‡Ÿæ”¶'
    unit: string;             // 'USD', 'NTD', 'Count'
    granularity: 'daily' | 'monthly' | 'quarterly';
    keywords: string[];       // ['Revenue', 'Sales', 'ç‡Ÿæ¥­é¡']
    conflict_policy: 'latest_wins' | 'human_review';
}

export interface MetricValue {
    id: string;
    metric_id: string;
    timestamp: string;        // æ•¸æ“šæ‰€å±¬æ™‚é–“
    value: number;
    dimensions: Record<string, string>; // { department: 'sales', region: 'asia' }
    source_file_id: string;
    confidence: number;
    is_active: boolean;
}

export interface InsightSnippet {
    id: string;
    source_file_id: string;
    department_id: string;
    content: string;         // AI ç”Ÿæˆçš„çŸ­è©•
    tags: string[];          // ['risk', 'opportunity', 'financial']
    significance: number;    // 0-1
    created_at: string;
}

```

### 6.1.6 AI ETL æ•¸æ“šèª¿å’Œå¼•æ“ (AI-Driven ETL Engine)

é€™æ˜¯ä¸è®“æˆ°æƒ…å®¤å´©æ½°çš„æ ¸å¿ƒé‚è¼¯ã€‚

```typescript
// lib/war-room/etl/ai-metric-etl.ts

export class AIMetricETLEngine {
    /**
     * æ ¸å¿ƒæµç¨‹ï¼šå¾ç•°è³ªæ–‡ä»¶èƒå–æ¨™æº–æŒ‡æ¨™
     * @param fileId ä¸Šå‚³çš„æ–‡ä»¶ ID
     */
    async processFileForMetrics(fileId: string): Promise<ETLResult> {
        // 1. æ„åœ–è­˜åˆ¥ï¼šé€™ä»½æ–‡ä»¶åŒ…å«é—œéµæŒ‡æ¨™å—ï¼Ÿ
        const fileContent = await this.getFileContent(fileId);
        const intent = await this.identifyMetricIntent(fileContent);
        
        if (!intent.hasMetrics) {
            return { status: 'skipped', reason: 'no_metrics_found' };
        }

        // 2. ç²å–æŒ‡æ¨™å®šç¾© (Schema)
        const definitions = await this.getMetricDefinitions(intent.detectedMetricTypes);

        // 3. AI æ˜ å°„èˆ‡èƒå– (The "Magic" Step)
        // è®“ LLM å°‡ "csv_col_A", "pdf_table_row_2" è½‰æ›ç‚ºæ¨™æº– metric_id
        const extractedMetrics = await this.extractAndMap(fileContent, definitions);

        // 4. æ¸…æ´—èˆ‡è¡çªæª¢æ¸¬
        const cleansedMetrics = await this.cleanseAndResolveConflicts(extractedMetrics);

        // 5. è¼‰å…¥è‡³ Metric Store
        await this.loadToStore(cleansedMetrics);

        return { status: 'success', count: cleansedMetrics.length };
    }

    /**
     * Step 4: æ¸…æ´—èˆ‡è¡çªæª¢æ¸¬é‚è¼¯
     */
    private async cleanseAndResolveConflicts(
        metrics: RawMetricValue[]
    ): Promise<MetricValue[]> {
        const results: MetricValue[] = [];

        for (const m of metrics) {
            // A. æª¢æŸ¥æ˜¯å¦å­˜åœ¨èˆŠæ•¸æ“š (ä¾‹å¦‚: 1æœˆç‡Ÿæ”¶)
            const existing = await this.metricStore.find({
                metric_id: m.metric_id,
                timestamp: m.timestamp,
                dimensions: m.dimensions
            });

            if (existing) {
                // B. è¡çªè§£æ±ºç­–ç•¥ï¼šLatest Wins
                await this.metricStore.softDelete(existing.id);
                console.log(`[ETL] Overwriting metric ${m.metric_id} from ${existing.source_file_id}`);
            }

            // C. ç•°å¸¸å€¼åµæ¸¬ (Anomaly Detection)
            const isAnomaly = await this.detectAnomaly(m);
            if (isAnomaly) {
                // æ¨™è¨˜ç‚ºå¾…å¯©æ ¸ï¼Œä¸ç›´æ¥ç”Ÿæ•ˆ
                m.is_active = false; 
                await this.createAlert('metric_anomaly', m);
            }

            results.push(m);
        }

        return results;
    }
}
```

---

### 6.6 è³‡æ–™åº«çµæ§‹

```sql
-- æˆ°æƒ…å®¤é…ç½®è¡¨
CREATE TABLE IF NOT EXISTS war_room_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE UNIQUE,

    -- å¤–éƒ¨æƒ…è³‡ç›£æ§ä¸»é¡Œ
    watch_topics JSONB DEFAULT '[]',

    -- å„€è¡¨æ¿ä½ˆå±€åå¥½
    layout_config JSONB DEFAULT '{
        "kpi_order": ["strategy", "operations", "financial", "risk", "intelligence"],
        "department_display_mode": "grid",
        "show_ai_insights": true
    }',

    -- é€šçŸ¥åå¥½
    notification_preferences JSONB DEFAULT '{
        "email_daily_summary": true,
        "push_critical_risks": true,
        "push_high_opportunities": false
    }',

    created_at TIMESTAMPTZ DEFAULT NOW(),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- æŒ‡æ¨™å®šç¾©è¡¨ (Metric Store Definitions)
CREATE TABLE IF NOT EXISTS metric_definitions (
    id VARCHAR(50) PRIMARY KEY, -- e.g. 'finance_revenue'
    name VARCHAR(100) NOT NULL,
    unit VARCHAR(20),
    granularity VARCHAR(20),
    keywords JSONB DEFAULT '[]',
    conflict_policy VARCHAR(20) DEFAULT 'latest_wins'
);

-- æŒ‡æ¨™æ•¸å€¼è¡¨ (Metric Store Values)
CREATE TABLE IF NOT EXISTS metric_values (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    metric_id VARCHAR(50) REFERENCES metric_definitions(id),
    value DECIMAL(20, 4) NOT NULL,
    timestamp TIMESTAMPTZ NOT NULL, -- æ•¸æ“šæ™‚é–“é»
    dimensions JSONB DEFAULT '{}',  -- ç¶­åº¦
    
    source_file_id UUID REFERENCES files(id),
    confidence DECIMAL(3, 2),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    INDEX idx_metrics_query (metric_id, timestamp, is_active)
);

-- æ´å¯Ÿç‰‡æ®µè¡¨ (Insight Store)
CREATE TABLE IF NOT EXISTS insight_snippets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    source_file_id UUID REFERENCES files(id),
    department_id UUID REFERENCES departments(id),
    
    content TEXT NOT NULL,
    tags JSONB DEFAULT '[]',
    significance DECIMAL(3, 2) DEFAULT 0.5, -- é‡è¦æ€§
    
    is_pushed BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å·²æ¨æ’­
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    INDEX idx_insights_dept (department_id, created_at DESC)
);

-- å¤–éƒ¨æ–°èæƒ…è³‡è¡¨
CREATE TABLE IF NOT EXISTS external_intelligence (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    topic_id VARCHAR(255) NOT NULL,

    -- æ–°èåŸºæœ¬è³‡è¨Š
    title TEXT NOT NULL,
    source VARCHAR(255) NOT NULL,
    url TEXT,
    content TEXT,
    published_at TIMESTAMPTZ NOT NULL,
    fetched_at TIMESTAMPTZ DEFAULT NOW(),

    -- AI åˆ†æçµæœ
    relevance_score DECIMAL(3,2) DEFAULT 0,
    risk_level VARCHAR(10),
    impact_areas JSONB DEFAULT '[]',
    sentiment VARCHAR(10),
    ai_summary TEXT,
    key_points JSONB DEFAULT '[]',
    affected_entities JSONB DEFAULT '{}',
    recommended_actions JSONB DEFAULT '[]',

    -- ä½¿ç”¨è€…äº’å‹•
    is_read BOOLEAN DEFAULT FALSE,
    is_bookmarked BOOLEAN DEFAULT FALSE,
    user_notes TEXT,
    status VARCHAR(20) DEFAULT 'pending',

    reviewed_by UUID REFERENCES user_profiles(id),
    reviewed_at TIMESTAMPTZ,

    created_at TIMESTAMPTZ DEFAULT NOW(),

    INDEX idx_intelligence_user_topic (user_id, topic_id),
    INDEX idx_intelligence_risk (risk_level) WHERE status = 'pending',
    INDEX idx_intelligence_published (published_at DESC)
);

-- éƒ¨é–€æ—¥å ±è¡¨
CREATE TABLE IF NOT EXISTS department_daily_briefs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    department_id UUID REFERENCES departments(id) ON DELETE CASCADE,
    brief_date DATE NOT NULL,

    -- AI ç”Ÿæˆå…§å®¹
    top_updates JSONB DEFAULT '[]',
    key_metrics JSONB DEFAULT '[]',
    urgent_items JSONB DEFAULT '[]',
    ai_summary TEXT,
    insights JSONB DEFAULT '[]',

    -- çµ±è¨ˆæ•¸æ“š
    stats JSONB DEFAULT '{
        "total_files": 0,
        "files_updated_today": 0,
        "active_agents": 0,
        "conversations_count": 0,
        "knowledge_health_score": 0
    }',

    generated_at TIMESTAMPTZ DEFAULT NOW(),

    UNIQUE(department_id, brief_date)
);

-- æˆ°ç•¥å»ºè­°è¡¨
CREATE TABLE IF NOT EXISTS strategic_recommendations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    week_start_date DATE NOT NULL,

    priority VARCHAR(10) NOT NULL,
    category VARCHAR(30) NOT NULL,
    title TEXT NOT NULL,
    problem TEXT,
    recommendation TEXT NOT NULL,
    expected_benefit TEXT,
    evidence_files UUID[] DEFAULT '{}',
    next_steps JSONB DEFAULT '[]',

    -- ä½¿ç”¨è€…äº’å‹•
    status VARCHAR(20) DEFAULT 'pending',
    assigned_to UUID REFERENCES user_profiles(id),
    due_date DATE,
    completed_at TIMESTAMPTZ,
    user_notes TEXT,

    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),

    INDEX idx_recommendations_user_week (user_id, week_start_date),
    INDEX idx_recommendations_status (status)
);

-- è·¨éƒ¨é–€æ´å¯Ÿè¡¨
CREATE TABLE IF NOT EXISTS cross_department_insights (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,

    type VARCHAR(20) NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    departments UUID[] DEFAULT '{}',
    related_files UUID[] DEFAULT '{}',
    importance_score DECIMAL(3,2) DEFAULT 0,
    recommended_action TEXT,

    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ,

    INDEX idx_insights_user (user_id),
    INDEX idx_insights_importance (importance_score DESC)
);
```

---

### 6.7 API ç«¯é»è¦åŠƒ

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|-----|-----|-----|
| `/api/war-room/overview` | GET | å–å¾—æˆ°æƒ…å®¤ç¸½è¦½ï¼ˆ5 å¤§ KPIï¼‰ |
| `/api/war-room/kpi/strategy` | GET | æˆ°ç•¥åŸ·è¡Œåº¦è©³ç´°æ•¸æ“š |
| `/api/war-room/kpi/operations` | GET | ç‡Ÿé‹å¥åº·åº¦è©³ç´°æ•¸æ“š |
| `/api/war-room/kpi/financial` | GET | è²¡å‹™ç‹€æ…‹è©³ç´°æ•¸æ“š |
| `/api/war-room/kpi/risks` | GET | é¢¨éšªé è­¦è©³ç´°æ•¸æ“š |
| `/api/war-room/intelligence` | GET | å¤–éƒ¨æƒ…è³‡åˆ—è¡¨ |
| `/api/war-room/intelligence/topics` | GET/POST | ç®¡ç†ç›£æ§ä¸»é¡Œ |
| `/api/war-room/intelligence/:id/analyze` | POST | é‡æ–°åˆ†æå–®ä¸€æ–°è |
| `/api/war-room/departments` | GET | å–å¾—éƒ¨é–€æˆ°æƒ…å¡ç‰‡åˆ—è¡¨ |
| `/api/war-room/departments/:id/brief` | GET | å–å¾—éƒ¨é–€æ—¥å ± |
| `/api/war-room/departments/:id/chat` | POST | å•Ÿå‹•éƒ¨é–€å°è©± |
| `/api/war-room/insights/cross-department` | GET | è·¨éƒ¨é–€æ´å¯Ÿ |
| `/api/war-room/recommendations` | GET | æœ¬é€±æˆ°ç•¥å»ºè­° |
| `/api/war-room/recommendations/:id/update` | PATCH | æ›´æ–°å»ºè­°ç‹€æ…‹ |
| `/api/war-room/export-pdf` | POST | åŒ¯å‡ºæˆ°æƒ…å®¤ PDF å ±å‘Š |

---

### 6.8 æ’ç¨‹ä»»å‹™

| ä»»å‹™åç¨± | åŸ·è¡Œé »ç‡ | ç”¨é€” | å¯¦ä½œ |
|---------|---------|-----|-----|
| `fetch_external_news` | æ¯å°æ™‚ | æŠ“å–ä¸¦åˆ†æå¤–éƒ¨æ–°è | Cron Job |
| `generate_department_briefs` | æ¯æ—¥ 06:00 | ç”Ÿæˆæ‰€æœ‰éƒ¨é–€æ—¥å ± | Cron Job |
| `calculate_kpi_metrics` | æ¯ 15 åˆ†é˜ | æ›´æ–° 5 å¤§ KPI æŒ‡æ¨™ | Cron Job |
| `discover_cross_dept_insights` | æ¯æ—¥ 07:00 | ç™¼ç¾è·¨éƒ¨é–€æ´å¯Ÿ | Cron Job |
| `generate_weekly_recommendations` | æ¯é€±ä¸€ 08:00 | ç”Ÿæˆæœ¬é€±æˆ°ç•¥å»ºè­° | Cron Job |
| `send_daily_summary_email` | æ¯æ—¥ 08:30 | ç™¼é€æˆ°æƒ…å®¤æ—¥å ±éƒµä»¶ | Cron Job |

---

### 6.9 è¦–è¦ºè¨­è¨ˆè¦ç¯„

#### è‰²å½©ç³»çµ±

```typescript
// styles/war-room-theme.ts

export const WAR_ROOM_THEME = {
    // èƒŒæ™¯
    background: {
        primary: '#0A0E27',      // æ·±è—é»‘ï¼ˆä¸»èƒŒæ™¯ï¼‰
        secondary: '#12182E',    // æ¬¡è¦èƒŒæ™¯ï¼ˆå¡ç‰‡ï¼‰
        tertiary: '#1A2238'      // ç¬¬ä¸‰å±¤èƒŒæ™¯ï¼ˆæµ®å±¤ï¼‰
    },

    // ä¸»è‰²èª¿
    accent: {
        primary: '#00D9FF',      // é›»å…‰è—ï¼ˆé‡è¦æ•¸æ“šï¼‰
        secondary: '#A78BFA'     // ç´«å…‰ï¼ˆAI ç›¸é—œï¼‰
    },

    // èªç¾©è‰²å½©
    semantic: {
        success: '#00FF88',      // ç¿ ç¶ ï¼ˆæ­£å‘æŒ‡æ¨™ï¼‰
        warning: '#FFB800',      // ç¥ç€é»ƒï¼ˆä¸­é¢¨éšªï¼‰
        danger: '#FF3366',       // éœ“è™¹ç´…ï¼ˆé«˜é¢¨éšªï¼‰
        info: '#00D9FF'          // é›»å…‰è—ï¼ˆè³‡è¨Šï¼‰
    },

    // æ–‡å­—
    text: {
        primary: '#FFFFFF',
        secondary: '#B4BCD0',
        tertiary: '#6B7280'
    },

    // é‚Šæ¡†èˆ‡åˆ†éš”
    border: {
        default: 'rgba(255, 255, 255, 0.1)',
        hover: 'rgba(0, 217, 255, 0.3)'
    }
};
```

#### å‹•ç•«æ•ˆæœ

```typescript
// components/war-room/animations.ts

// 1. æ•¸å­—å‹•ç•«ï¼ˆCountUpï¼‰
export const animateNumber = (
    element: HTMLElement,
    from: number,
    to: number,
    duration: number = 1000
) => {
    // ä½¿ç”¨ CountUp.js æˆ– Framer Motion
};

// 2. è„ˆè¡å…‰æšˆï¼ˆæ–°æ¶ˆæ¯æç¤ºï¼‰
export const pulseGlow = keyframes`
    0%, 100% { box-shadow: 0 0 10px rgba(255, 51, 102, 0.5); }
    50% { box-shadow: 0 0 20px rgba(255, 51, 102, 0.8); }
`;

// 3. å¡ç‰‡é€²å ´å‹•ç•«
export const cardEnter = keyframes`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;
```

#### åœ–è¡¨åº«é¸æ“‡

| åœ–è¡¨é¡å‹ | æ¨è–¦åº« | ç”¨é€” |
|---------|-------|-----|
| æŠ˜ç·šåœ–ã€æŸ±ç‹€åœ– | **Recharts** | KPI è¶¨å‹¢ã€é æ¸¬å€é–“ |
| ç’°å½¢é€²åº¦åœ– | **Recharts** | æˆ°ç•¥åŸ·è¡Œåº¦ |
| é›·é”åœ– | **Recharts** | ç‡Ÿé‹å¥åº·åº¦ |
| åŠ›å°å‘åœ– | **D3.js** | çŸ¥è­˜æµå‹•ç†±åŠ›åœ– |
| ç†±åŠ›åœ– | **D3.js** | é¢¨éšªçŸ©é™£ |

---

### 6.10 å¯¦æ–½è·¯ç·šåœ–

#### Phase 6.1: åŸºç¤å»ºè¨­ï¼ˆ2 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | è³‡æ–™åº«çµæ§‹å»ºç«‹ | å»ºç«‹æ‰€æœ‰æˆ°æƒ…å®¤ç›¸é—œè¡¨ | 2 å¤© |
| P0 | æ¬Šé™ç³»çµ± | å¯¦ä½œä¸‰å±¤æ¬Šé™æ§åˆ¶ | 2 å¤© |
| P0 | é é¢è·¯ç”±èˆ‡ä½ˆå±€ | å»ºç«‹æˆ°æƒ…å®¤ä¸»é æ¶æ§‹ | 2 å¤© |
| P1 | è¦–è¦ºä¸»é¡Œç³»çµ± | å¯¦ä½œæˆ°æƒ…å®¤å°ˆå±¬é…è‰² | 1 å¤© |

#### Phase 6.2: ç¬¬ä¸€å±¤ KPI æ¨¡çµ„ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | æˆ°ç•¥åŸ·è¡Œåº¦è¨ˆç®—å™¨ | AI è§£æç›®æ¨™æ–‡ä»¶ | 3 å¤© |
| P0 | ç‡Ÿé‹å¥åº·åº¦è¨ˆç®—å™¨ | éƒ¨é–€æ´»èºåº¦åˆ†æ | 3 å¤© |
| P0 | è²¡å‹™ç‹€æ…‹åˆ†æå™¨ | AI è§£æè²¡å‹™æ–‡ä»¶ | 3 å¤© |
| P0 | é¢¨éšªé è­¦ç³»çµ± | æ•´åˆå¤šæºé¢¨éšªåµæ¸¬ | 4 å¤© |
| P1 | KPI åœ–è¡¨è¦–è¦ºåŒ– | Recharts åœ–è¡¨å¯¦ä½œ | 3 å¤© |

#### Phase 6.3: å¤–éƒ¨æƒ…è³‡ç³»çµ±ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | NewsAPI æ•´åˆ | æ–°èæŠ“å– API | 2 å¤© |
| P0 | AI æ–°èåˆ†æå¼•æ“ | Gemini åˆ†ææ–°è | 3 å¤© |
| P0 | ç›£æ§ä¸»é¡Œç®¡ç† UI | CRUD ä»‹é¢ | 3 å¤© |
| P1 | æ’ç¨‹æŠ“å–ä»»å‹™ | Cron Job è¨­å®š | 1 å¤© |
| P1 | å³æ™‚æ¨é€é€šçŸ¥ | é«˜é¢¨éšªæ–°èæ¨é€ | 2 å¤© |

#### Phase 6.4: éƒ¨é–€æˆ°æƒ…æ¨¡çµ„ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | éƒ¨é–€æ—¥å ±ç”Ÿæˆå™¨ | AI è‡ªå‹•ç”Ÿæˆæ‘˜è¦ | 4 å¤© |
| P0 | éƒ¨é–€å¡ç‰‡ UI | å‹•æ…‹å¡ç‰‡è¨­è¨ˆ | 3 å¤© |
| P0 | å°è©±å¼æ¢æŸ¥ | å•Ÿå‹•éƒ¨é–€å°è©± | 3 å¤© |
| P1 | å»ºè­°å•é¡Œç”Ÿæˆ | AI ç”Ÿæˆå•é¡Œ | 2 å¤© |
| P1 | å®Œæ•´å ±å‘ŠåŒ¯å‡º | PDF ç”Ÿæˆ | 2 å¤© |

#### Phase 6.5: AI æ´å¯Ÿå¼•æ“ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | è·¨éƒ¨é–€çŸ¥è­˜é€£çµ | AI ç™¼ç¾å”ä½œæ©Ÿæœƒ | 4 å¤© |
| P0 | æˆ°ç•¥å»ºè­°å¼•æ“ | AI ç”Ÿæˆå»ºè­° | 4 å¤© |
| P1 | å»ºè­°äº’å‹• UI | æ¨™è¨˜ã€å§”æ´¾ã€è¿½è¹¤ | 3 å¤© |
| P1 | é€±å ±éƒµä»¶ç³»çµ± | è‡ªå‹•ç™¼é€æ‘˜è¦ | 2 å¤© |

---

### 6.11 é€²éšåŠŸèƒ½æ§‹æƒ³ï¼ˆæœªä¾†æ“´å……ï¼‰

#### 1. ä¸€éµç”Ÿæˆè‘£äº‹æœƒç°¡å ±

```typescript
// lib/war-room/export/presentation-generator.ts

export class PresentationGenerator {
    async generateBoardMeeting(userId: string): Promise<string> {
        // 1. æ”¶é›†æœ¬é€±æ‰€æœ‰æ•¸æ“š
        const kpis = await this.getAllKPIs(userId);
        const insights = await this.getAllInsights(userId);
        const recommendations = await this.getRecommendations(userId);

        // 2. ä½¿ç”¨ pptxgen æˆ–é¡ä¼¼åº«ç”Ÿæˆ PPT
        const ppt = new PptxGenJS();

        // å°é¢
        ppt.addSlide().addText('ä¼æ¥­æˆ°æƒ…é€±å ±', { ... });

        // 5 å¤§ KPI
        ppt.addSlide().addChart(kpis.strategy);
        // ... å…¶ä»–æŠ•å½±ç‰‡

        // 3. åŒ¯å‡ºæª”æ¡ˆ
        return await ppt.writeFile('æˆ°æƒ…é€±å ±.pptx');
    }
}
```

#### 2. èªéŸ³æ’­å ±æ¨¡å¼

```typescript
// lib/war-room/voice/narration.ts

export class VoiceNarration {
    async startNarration(userId: string): Promise<void> {
        const brief = await this.generateVoiceScript(userId);

        // ä½¿ç”¨ Web Speech API æˆ– Google TTS
        const speech = new SpeechSynthesisUtterance(brief);
        speech.lang = 'zh-TW';
        window.speechSynthesis.speak(speech);
    }
}
```

#### 3. æ™‚å…‰æ©ŸåŠŸèƒ½

```typescript
// lib/war-room/history/time-machine.ts

export class WarRoomTimeMachine {
    async getHistoricalSnapshot(
        userId: string,
        targetDate: Date
    ): Promise<WarRoomSnapshot> {
        // é‡å»ºæŒ‡å®šæ—¥æœŸçš„æˆ°æƒ…å®¤ç‹€æ…‹
        // éœ€è¦ä¿å­˜æ­·å²å¿«ç…§åˆ°è³‡æ–™åº«
    }
}
```

#### 4. ç«¶çˆ­å°æ‰‹é›·é”

æ•´åˆå…¬é–‹è³‡è¨Šï¼š
- ç«¶çˆ­å°æ‰‹è²¡å ±ï¼ˆå…¬é–‹è³‡æ–™ï¼‰
- æ–°èå ±å°
- ç”¢å“ç™¼å¸ƒ
- äººæ‰å‹•å‘ï¼ˆLinkedInï¼‰

#### 5. æƒ…å¢ƒæ¨¡æ“¬

```typescript
// lib/war-room/simulation/scenario-simulator.ts

export class ScenarioSimulator {
    async simulate(scenario: string): Promise<SimulationResult> {
        // AI æ¨¡æ“¬ã€Œå¦‚æœ X ç™¼ç”Ÿï¼Œæœƒå½±éŸ¿ä»€éº¼ã€
        // ä¾‹å¦‚ï¼šã€Œä¾›æ‡‰å•† A æ–·è²¨æœƒå½±éŸ¿å“ªäº›ç”¢å“ç·šï¼Ÿã€
    }
}
```

---

## ğŸ“ˆ é æœŸæ•ˆç›Š

### æŠ€è¡“å„ªå‹¢

| èƒ½åŠ› | v2.0 | v3.0 | æå‡å¹…åº¦ |
|-----|------|------|---------|
| çŸ¥è­˜æ™‚æ•ˆæ€§åˆ¤æ–· | ç²—ç•¥ï¼ˆä¾å¤©æ•¸ï¼‰ | ç²¾æº–ï¼ˆä¾é¡å‹è¡°æ¸›ï¼‰ | **æº–ç¢ºåº¦ +40%** |
| å“è³ªè©•ä¼°ä¾æ“š | éœæ…‹åˆ†æ | å‹•æ…‹åé¥‹å­¸ç¿’ | **æŒçºŒå„ªåŒ–** |
| çŸ¥è­˜å®Œæ•´æ€§ | å–®ä¸€æ–‡ä»¶è¦–è§’ | èšåˆçŸ¥è­˜å–®å…ƒ | **è¦†è“‹åº¦ +60%** |
| èªç¾©æœå°‹é€Ÿåº¦ | O(nÂ²) | O(n log n) | **100 å€æå‡** |
| çŸ¥è­˜ç•°å¸¸ç™¼ç¾ | è¢«å‹•ç­‰å¾… | ä¸»å‹•æ¨é€é€šçŸ¥ | **å³æ™‚éŸ¿æ‡‰** |

### v3.0 ç‰¹æœ‰æ•ˆç›Š

| åŠŸèƒ½ | æ¥­å‹™å ´æ™¯ | é æœŸæ•ˆç›Š |
|-----|---------|---------
| çŸ¥è­˜è¡°æ¸›æ¨¡å‹ | å ±åƒ¹ Agent ä½¿ç”¨ç”¢å“åƒ¹æ ¼è¡¨ | è‡ªå‹•æ¨™è¨˜éæœŸåƒ¹æ ¼ï¼Œé¿å…å ±éŒ¯åƒ¹ |
| åé¥‹å­¸ç¿’è¿´è·¯ | å®¢æœ Agent å›ç­”å®¢æˆ¶å•é¡Œ | è¶Šç”¨è¶Šæº–ï¼Œæ¸›å°‘äººå·¥ä»‹å…¥ |
| çŸ¥è­˜ç¢ç‰‡èšåˆ | é›¢è·æµç¨‹æ¶‰åŠ HR/IT/è²¡å‹™ | ä¸€æ¬¡è©¢å•ç²å¾—å®Œæ•´æµç¨‹ |
| é«˜æ•ˆèƒ½æœå°‹ | è¬ä»½æ–‡ä»¶ä¸­æ‰¾ç›¸é—œçŸ¥è­˜ | å¾åˆ†é˜ç´šé™è‡³ç§’ç´š |
| ä¸»å‹•æ¨é€ | æ”¿ç­–æ›´æ–°å½±éŸ¿å¤šå€‹ Agent | å³æ™‚é€šçŸ¥ï¼ŒåŒæ­¥æ›´æ–° |

---

## ğŸ“‹ é™„éŒ„ï¼šæŠ€è¡“è¦æ ¼ç¸½è¡¨

### è³‡æ–™åº«æ–°å¢çµæ§‹

| è¡¨å | ç”¨é€” | æ–°å¢/ä¿®æ”¹ |
|-----|-----|----------|
| `files` | æ ¸å¿ƒæ–‡ä»¶è¡¨ | æ–°å¢ 10 å€‹æ¬„ä½ |
| `agents` | Agent è¡¨ | æ–°å¢ 3 å€‹æ¬„ä½ |
| `knowledge_feedback_events` | åé¥‹äº‹ä»¶ | æ–°å¢è¡¨ |
| `knowledge_units` | çŸ¥è­˜å–®å…ƒ | æ–°å¢è¡¨ |
| `knowledge_unit_files` | å–®å…ƒ-æ–‡ä»¶é—œè¯ | æ–°å¢è¡¨ |
| `knowledge_notifications` | é€šçŸ¥ | æ–°å¢è¡¨ |
| `agent_knowledge_sources` | Agent-çŸ¥è­˜é—œè¯ | æ–°å¢è¡¨ |
| `metric_definitions` | æŒ‡æ¨™å®šç¾© | **æ–°å¢è¡¨ (Phase 6)** |
| `metric_values` | æŒ‡æ¨™æ•¸å€¼ (Metric Store) | **æ–°å¢è¡¨ (Phase 6)** |
| `insight_snippets` | æ´å¯Ÿç‰‡æ®µ (Insight Store) | **æ–°å¢è¡¨ (Phase 6)** |

### API ç«¯é»è¦åŠƒ

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|-----|-----|-----|
| `/api/knowledge/decay/calculate` | POST | è¨ˆç®—å–®ä¸€æ–‡ä»¶è¡°æ¸›åˆ†æ•¸ |
| `/api/knowledge/decay/batch-update` | POST | æ‰¹æ¬¡æ›´æ–°æ‰€æœ‰è¡°æ¸›åˆ†æ•¸ |
| `/api/knowledge/feedback` | POST | è¨˜éŒ„åé¥‹äº‹ä»¶ |
| `/api/knowledge/feedback/stats/:fileId` | GET | å–å¾—æ–‡ä»¶åé¥‹çµ±è¨ˆ |
| `/api/knowledge/units` | GET/POST | çŸ¥è­˜å–®å…ƒ CRUD |
| `/api/knowledge/units/discover` | POST | ç™¼ç¾å¯èšåˆçš„çŸ¥è­˜ |
| `/api/knowledge/search/semantic` | POST | é«˜æ•ˆèƒ½èªç¾©æœå°‹ |
| `/api/notifications` | GET | å–å¾—ä½¿ç”¨è€…é€šçŸ¥ |
| `/api/notifications/:id/resolve` | POST | è§£æ±ºé€šçŸ¥ |
| `/api/war-room/metrics/etl/run` | POST | æ‰‹å‹•è§¸ç™¼ ETL |
| `/api/war-room/metrics/query` | POST | æŸ¥è©¢æŒ‡æ¨™æ•¸æ“š (Metric Store) |
| `/api/war-room/insights/stream` | GET | å–å¾—å³æ™‚æƒ…å ±ä¸²æµ |

### æ’ç¨‹ä»»å‹™

| ä»»å‹™ | é »ç‡ | ç”¨é€” |
|-----|-----|-----|
| `update_decay_scores` | æ¯æ—¥ 02:00 | æ›´æ–°æ‰€æœ‰æ–‡ä»¶è¡°æ¸›åˆ†æ•¸ |
| `check_approaching_expiry` | æ¯æ—¥ 08:00 | æª¢æŸ¥å³å°‡éæœŸçŸ¥è­˜ä¸¦ç™¼é€é€šçŸ¥ |
| `run_daily_learning` | æ¯æ—¥ 03:00 | åŸ·è¡Œåé¥‹å­¸ç¿’åˆ†æ |
| `detect_conflicts` | æ¯é€±ä¸€ | æƒæçŸ¥è­˜è¡çª |

---

**å ±å‘ŠçµæŸ**

**æ–‡ä»¶ç‰ˆæœ¬**: v3.1
**æ›´æ–°æ—¥æœŸ**: 2026-01-06
**ä½œè€…**: EAKAP ç³»çµ±æ¶æ§‹åœ˜éšŠ

**v3.1 æ›´æ–°æ‘˜è¦**ï¼š
- æ–°å¢ Phase 6: ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Executive Command Center) å®Œæ•´æŠ€è¡“è¦åŠƒ
- å®šç¾©ä¸‰å±¤æ¶æ§‹ï¼šå…¨å±€æ…‹å‹¢æ„ŸçŸ¥ã€éƒ¨é–€æˆ°æƒ…æ¨¡çµ„ã€AI æ™ºèƒ½æ´å¯Ÿ
- è¦åŠƒ 5 å¤§ KPI æ¨¡çµ„ï¼šæˆ°ç•¥åŸ·è¡Œåº¦ã€ç‡Ÿé‹å¥åº·åº¦ã€è²¡å‹™ç‹€æ…‹ã€é¢¨éšªé è­¦ã€å¤–éƒ¨æƒ…è³‡
- è¨­è¨ˆå¤–éƒ¨æ–°èæƒ…è³‡ç³»çµ±ï¼ˆAI è‡ªå‹•åˆ†æï¼‰
- å¯¦ä½œéƒ¨é–€ AI æ—¥å ±ç”Ÿæˆå™¨èˆ‡å°è©±å¼æ¢æŸ¥
- å»ºç«‹è·¨éƒ¨é–€çŸ¥è­˜é€£çµèˆ‡æˆ°ç•¥å»ºè­°å¼•æ“
- å®Œæ•´è³‡æ–™åº«çµæ§‹ã€API ç«¯é»ã€æ’ç¨‹ä»»å‹™è¦åŠƒ
- è¦–è¦ºè¨­è¨ˆè¦ç¯„èˆ‡å¯¦æ–½è·¯ç·šåœ–

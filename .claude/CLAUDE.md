# EAKAP é€²éšçŸ¥è­˜æ¶æ§‹ç³»çµ±è¨­è¨ˆ
**ç‰ˆæœ¬ï¼š** v3.3
**å»ºç«‹æ—¥æœŸï¼š** 2026-01-01
**æœ€å¾Œæ›´æ–°ï¼š** 2026-01-09
**è¨­è¨ˆç›®æ¨™ï¼š** å»ºç«‹ä¸€å¥—æ¥µåº¦å°ˆæ¥­ã€å…·æŠ€è¡“èˆ‡å…§å®¹é–€æª»çš„çŸ¥è­˜æ¶æ§‹ç³»çµ±ï¼Œè®“ AI Agent èƒ½ç²¾æº–è§£è®€èˆ‡é‹ç”¨ä¼æ¥­çŸ¥è­˜

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

### æ ¸å¿ƒåƒ¹å€¼ä¸»å¼µ

æœ¬ç³»çµ±ä¸åƒ…åƒ…æ˜¯æ–‡ä»¶åˆ†é¡ç³»çµ±ï¼Œè€Œæ˜¯ä¸€å¥—**ã€Œèªç¾©çŸ¥è­˜æ¶æ§‹å¼•æ“ã€**ï¼Œå…·å‚™ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š

#### åŸºç¤èƒ½åŠ›ï¼ˆv2.0ï¼‰
1. **å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•**ï¼šè¶…è¶Šå‚³çµ±åˆ†é¡ï¼Œå»ºç«‹èªç¾©ã€æ™‚åºã€é—œè¯ã€æ¬Šé‡å››ç¶­ç´¢å¼•
2. **æ™ºèƒ½çŸ¥è­˜è·¯ç”±**ï¼šAgent å»ºç«‹æ™‚è‡ªå‹•é¸æ“‡æœ€ç›¸é—œçš„çŸ¥è­˜ä¾†æº
3. **çŸ¥è­˜å“è³ªè©•ä¼°**ï¼šAI è‡ªå‹•è©•ä¼°çŸ¥è­˜çš„å®Œæ•´æ€§ã€æº–ç¢ºæ€§ã€æ™‚æ•ˆæ€§
4. **èªç¾©çŸ¥è­˜åœ–è­œ**ï¼šå»ºç«‹çŸ¥è­˜ä¹‹é–“çš„èªç¾©é—œè¯ï¼Œæ”¯æ´æ¨ç†èˆ‡ç™¼ç¾
5. **çŸ¥è­˜æ¼”åŒ–è¿½è¹¤**ï¼šè¿½è¹¤çŸ¥è­˜çš„ç‰ˆæœ¬æ¼”é€²èˆ‡ä¾è³´é—œä¿‚

#### é€²éšèƒ½åŠ›ï¼ˆv3.0 æ–°å¢ï¼‰
6. **çŸ¥è­˜è¡°æ¸›æ¨¡å‹**ï¼šä¾çŸ¥è­˜é¡å‹è‡ªå‹•è¨ˆç®—ã€ŒçŸ¥è­˜ä¿é®®æœŸã€ï¼Œé¿å…ä½¿ç”¨éæ™‚çŸ¥è­˜
7. **åé¥‹å­¸ç¿’è¿´è·¯**ï¼šå¾ Agent ä½¿ç”¨çµæœå­¸ç¿’ï¼ŒæŒçºŒå„ªåŒ–çŸ¥è­˜å“è³ªè©•åˆ†
8. **çŸ¥è­˜ç¢ç‰‡èšåˆ**ï¼šè‡ªå‹•ç™¼ç¾ä¸¦æ•´åˆåˆ†æ•£çš„çŸ¥è­˜ç¢ç‰‡ï¼Œå»ºæ§‹å®Œæ•´çŸ¥è­˜å–®å…ƒ
9. **é«˜æ•ˆèƒ½èªç¾©æœå°‹**ï¼šä½¿ç”¨ ANN æ¼”ç®—æ³•å¯¦ç¾è¬ç´šæ–‡ä»¶çš„å³æ™‚èªç¾©æœå°‹
10. **ä¸»å‹•æ¨é€æ©Ÿåˆ¶**ï¼šçŸ¥è­˜è®Šæ›´æ™‚ä¸»å‹•é€šçŸ¥ç›¸é—œ Agentï¼Œé¿å…ä½¿ç”¨éæ™‚çŸ¥è­˜

### æŠ€è¡“é–€æª»

- **è¤‡é›œåº¦é–€æª»**ï¼šå¤šå±¤æ¬¡ AI æ¨ç†ã€èªç¾©åˆ†æã€é—œè¯è¨ˆç®—
- **å…§å®¹é–€æª»**ï¼šåŸºæ–¼ DIKW ç†è«–ã€çŸ¥è­˜ç®¡ç†æœ€ä½³å¯¦è¸ã€ä¼æ¥­æ²»ç†æ¨™æº–
- **å¯¦ä½œé–€æª»**ï¼šéœ€è¦æ·±åº¦ç†è§£ AI Agent é‹ä½œæ©Ÿåˆ¶ã€çŸ¥è­˜åœ–è­œæŠ€è¡“ã€èªç¾©æœå°‹

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### 1. å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•ç³»çµ±ï¼ˆMulti-dimensional Knowledge Indexï¼‰

#### 1.1 å››ç¶­ç´¢å¼•æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•ç³»çµ± (MDKI)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ èªç¾©ç¶­åº¦     â”‚  â”‚ æ™‚åºç¶­åº¦     â”‚  â”‚ é—œè¯ç¶­åº¦     â”‚ â”‚
â”‚  â”‚ Semantic     â”‚  â”‚ Temporal     â”‚  â”‚ Relational   â”‚ â”‚
â”‚  â”‚ - Embedding  â”‚  â”‚ - Created    â”‚  â”‚ - Framework  â”‚ â”‚
â”‚  â”‚ - Keywords   â”‚  â”‚ - Updated    â”‚  â”‚ - Dependency â”‚ â”‚
â”‚  â”‚ - Topics     â”‚  â”‚ - ValidUntil â”‚  â”‚ - Hierarchy  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ¬Šé‡ç¶­åº¦     â”‚  â”‚ å“è³ªç¶­åº¦     â”‚  â”‚ å¯ç”¨æ€§ç¶­åº¦   â”‚ â”‚
â”‚  â”‚ Weight       â”‚  â”‚ Quality      â”‚  â”‚ Availability â”‚ â”‚
â”‚  â”‚ - Relevance  â”‚  â”‚ - Completenessâ”‚ â”‚ - Access     â”‚ â”‚
â”‚  â”‚ - Authority  â”‚  â”‚ - Accuracy   â”‚  â”‚ - Status     â”‚ â”‚
â”‚  â”‚ - Usage      â”‚  â”‚ - Freshness   â”‚  â”‚ - Permission â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.2 ç´¢å¼•å¯¦ä½œè¨­è¨ˆ

```typescript
// lib/knowledge/indexing/multi-dimensional-index.ts

/**
 * å¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•
 */
export interface MultiDimensionalKnowledgeIndex {
    // èªç¾©ç¶­åº¦
    semantic: {
        embedding: number[];           // å‘é‡åµŒå…¥ï¼ˆ1536 ç¶­ï¼‰
        keywords: string[];              // é—œéµè©ï¼ˆTF-IDF åŠ æ¬Šï¼‰
        topics: string[];                // ä¸»é¡Œæ¨™ç±¤
        entities: Entity[];              // å¯¦é«”è­˜åˆ¥ï¼ˆäººç‰©ã€çµ„ç¹”ã€ç”¢å“ç­‰ï¼‰
        concepts: Concept[];              // æ¦‚å¿µæå–ï¼ˆæŠ½è±¡æ¦‚å¿µï¼‰
    };
    
    // æ™‚åºç¶­åº¦
    temporal: {
        created_at: string;              // å»ºç«‹æ™‚é–“
        updated_at: string;              // æ›´æ–°æ™‚é–“
        valid_from: string;              // ç”Ÿæ•ˆæ™‚é–“
        valid_until: string | null;      // å¤±æ•ˆæ™‚é–“
        version: string;                 // ç‰ˆæœ¬è™Ÿ
        lifecycle_stage: LifecycleStage; // ç”Ÿå‘½é€±æœŸéšæ®µ
    };
    
    // é—œè¯ç¶­åº¦
    relational: {
        framework_id: string | null;     // æ‰€å±¬çŸ¥è­˜æ¡†æ¶
        instance_id: string | null;      // çŸ¥è­˜å¯¦ä¾‹ ID
        parent_file_id: string | null;   // çˆ¶æª”æ¡ˆï¼ˆè¡ç”Ÿé—œä¿‚ï¼‰
        child_file_ids: string[];        // å­æª”æ¡ˆï¼ˆè¡ç”Ÿé—œä¿‚ï¼‰
        related_file_ids: string[];      // ç›¸é—œæª”æ¡ˆï¼ˆèªç¾©é—œè¯ï¼‰
        dependency_chain: string[];      // ä¾è³´éˆï¼ˆçŸ¥è­˜ä¾è³´ï¼‰
    };
    
    // æ¬Šé‡ç¶­åº¦
    weight: {
        relevance_score: number;          // ç›¸é—œåº¦è©•åˆ†ï¼ˆ0-1ï¼‰
        authority_score: number;         // æ¬Šå¨æ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        usage_frequency: number;         // ä½¿ç”¨é »ç‡
        citation_count: number;         // å¼•ç”¨æ¬¡æ•¸
        agent_usage_count: number;       // Agent ä½¿ç”¨æ¬¡æ•¸
    };
    
    // å“è³ªç¶­åº¦
    quality: {
        completeness_score: number;      // å®Œæ•´æ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        accuracy_score: number;          // æº–ç¢ºæ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        freshness_score: number;         // æ™‚æ•ˆæ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        consistency_score: number;       // ä¸€è‡´æ€§è©•åˆ†ï¼ˆ0-1ï¼‰
        validation_status: ValidationStatus; // é©—è­‰ç‹€æ…‹
    };
    
    // å¯ç”¨æ€§ç¶­åº¦
    availability: {
        access_level: AccessLevel;       // å­˜å–å±¤ç´š
        department_restrictions: string[]; // éƒ¨é–€é™åˆ¶
        tag_restrictions: TagRestriction[]; // æ¨™ç±¤é™åˆ¶
        status: FileStatus;              // æª”æ¡ˆç‹€æ…‹
        dikw_level: DIKWLevel;           // DIKW å±¤ç´š
    };
}
```

### 2. æ™ºèƒ½çŸ¥è­˜è·¯ç”±ç³»çµ±ï¼ˆIntelligent Knowledge Routingï¼‰

#### 2.1 Agent çŸ¥è­˜è·¯ç”±æ¼”ç®—æ³•

ç•¶ Agent å»ºç«‹æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•é¸æ“‡æœ€ç›¸é—œçš„çŸ¥è­˜ä¾†æºï¼š

```typescript
// lib/knowledge/routing/agent-knowledge-router.ts

/**
 * Agent çŸ¥è­˜è·¯ç”±æ¼”ç®—æ³•
 * 
 * ç›®æ¨™ï¼šæ ¹æ“š Agent çš„ä»»å‹™æè¿°ï¼Œè‡ªå‹•é¸æ“‡æœ€ç›¸é—œçš„çŸ¥è­˜ä¾†æº
 */
export class AgentKnowledgeRouter {
    /**
     * ç‚º Agent é¸æ“‡çŸ¥è­˜ä¾†æº
     */
    async routeKnowledgeForAgent(
        agentDescription: string,
        agentSkills: AgentSkill[],
        departmentId: string | null
    ): Promise<KnowledgeRoute[]> {
        
        // Step 1: èªç¾©åŒ¹é…ï¼ˆä½¿ç”¨ Embedding ç›¸ä¼¼åº¦ï¼‰
        const semanticMatches = await this.findSemanticMatches(
            agentDescription,
            agentSkills,
            departmentId
        );
        
        // Step 2: æ¡†æ¶åŒ¹é…ï¼ˆæ ¹æ“š Agent Skills åŒ¹é…çŸ¥è­˜æ¡†æ¶ï¼‰
        const frameworkMatches = await this.findFrameworkMatches(
            agentSkills,
            departmentId
        );
        
        // Step 3: DIKW å±¤ç´šéæ¿¾ï¼ˆå„ªå…ˆé¸æ“‡ Knowledge å’Œ Wisdom å±¤ç´šï¼‰
        const dikwFiltered = this.filterByDIKWLevel(
            [...semanticMatches, ...frameworkMatches],
            ['knowledge', 'wisdom'] // å„ªå…ˆå±¤ç´š
        );
        
        // Step 4: å“è³ªéæ¿¾ï¼ˆéæ¿¾ä½å“è³ªçŸ¥è­˜ï¼‰
        const qualityFiltered = this.filterByQuality(
            dikwFiltered,
            { minCompleteness: 0.7, minAccuracy: 0.8 }
        );
        
        // Step 5: æ™‚æ•ˆæ€§éæ¿¾ï¼ˆéæ¿¾éæœŸçŸ¥è­˜ï¼‰
        const temporalFiltered = this.filterByTemporal(
            qualityFiltered,
            { maxAge: 365 } // æœ€å¤š 1 å¹´
        );
        
        // Step 6: æ¬Šé‡æ’åºï¼ˆç¶œåˆç›¸é—œåº¦ã€æ¬Šå¨æ€§ã€ä½¿ç”¨é »ç‡ï¼‰
        const ranked = this.rankByWeight(temporalFiltered, {
            relevanceWeight: 0.4,
            authorityWeight: 0.3,
            usageWeight: 0.3
        });
        
        // Step 7: å¤šæ¨£æ€§å¹³è¡¡ï¼ˆç¢ºä¿çŸ¥è­˜ä¾†æºå¤šæ¨£åŒ–ï¼‰
        const diversified = this.ensureDiversity(ranked, {
            maxPerFramework: 3,
            maxPerCategory: 5,
            minTotalSources: 5,
            maxTotalSources: 20
        });
        
        return diversified;
    }
}
```

### 3. çŸ¥è­˜å“è³ªè©•ä¼°ç³»çµ±ï¼ˆKnowledge Quality Assessmentï¼‰

#### 3.1 å¤šç¶­åº¦å“è³ªè©•ä¼°

```typescript
// lib/knowledge/quality/quality-assessor.ts

/**
 * çŸ¥è­˜å“è³ªè©•ä¼°ç³»çµ±
 * 
 * è‡ªå‹•è©•ä¼°çŸ¥è­˜çš„å®Œæ•´æ€§ã€æº–ç¢ºæ€§ã€æ™‚æ•ˆæ€§ã€ä¸€è‡´æ€§
 */
export class KnowledgeQualityAssessor {
    /**
     * è©•ä¼°çŸ¥è­˜å“è³ª
     */
    async assessQuality(
        fileId: string,
        content: string,
        metadata: any
    ): Promise<QualityAssessment> {
        
        // 1. å®Œæ•´æ€§è©•ä¼°
        const completeness = await this.assessCompleteness(content, metadata);
        
        // 2. æº–ç¢ºæ€§è©•ä¼°
        const accuracy = await this.assessAccuracy(content, metadata);
        
        // 3. æ™‚æ•ˆæ€§è©•ä¼°
        const freshness = await this.assessFreshness(metadata);
        
        // 4. ä¸€è‡´æ€§è©•ä¼°
        const consistency = await this.assessConsistency(content, metadata);
        
        // 5. çµæ§‹åŒ–ç¨‹åº¦è©•ä¼°
        const structure = await this.assessStructure(content);
        
        // 6. ç¶œåˆè©•åˆ†
        const overallScore = this.calculateOverallScore({
            completeness,
            accuracy,
            freshness,
            consistency,
            structure
        });
        
        return {
            completeness,
            accuracy,
            freshness,
            consistency,
            structure,
            overall_score: overallScore,
            recommendations: this.generateRecommendations({
                completeness,
                accuracy,
                freshness,
                consistency,
                structure
            })
        };
    }
}
```

### 4. èªç¾©çŸ¥è­˜åœ–è­œï¼ˆSemantic Knowledge Graphï¼‰

#### 4.1 çŸ¥è­˜é—œè¯ç™¼ç¾

```typescript
// lib/knowledge/graph/semantic-graph-builder.ts

/**
 * èªç¾©çŸ¥è­˜åœ–è­œå»ºæ§‹å™¨
 * 
 * è‡ªå‹•ç™¼ç¾çŸ¥è­˜ä¹‹é–“çš„èªç¾©é—œè¯
 */
export class SemanticKnowledgeGraphBuilder {
    /**
     * å»ºæ§‹çŸ¥è­˜åœ–è­œ
     */
    async buildGraph(fileIds: string[]): Promise<KnowledgeGraph> {
        const nodes: GraphNode[] = [];
        const edges: GraphEdge[] = [];
        
        // 1. å»ºç«‹ç¯€é»ï¼ˆæª”æ¡ˆã€çŸ¥è­˜å¯¦ä¾‹ã€æ¡†æ¶ï¼‰
        for (const fileId of fileIds) {
            const file = await this.getFile(fileId);
            nodes.push({
                id: fileId,
                type: 'file',
                label: file.filename,
                data: {
                    dikw_level: file.dikw_level,
                    category: file.category_id,
                    department: file.department_id
                }
            });
        }
        
        // 2. ç™¼ç¾èªç¾©é—œè¯
        const semanticEdges = await this.discoverSemanticRelations(nodes);
        edges.push(...semanticEdges);
        
        // 3. ç™¼ç¾ä¾è³´é—œä¿‚
        const dependencyEdges = await this.discoverDependencies(nodes);
        edges.push(...dependencyEdges);
        
        return {
            nodes,
            edges,
            metadata: {
                node_count: nodes.length,
                edge_count: edges.length,
                density: edges.length / (nodes.length * (nodes.length - 1))
            }
        };
    }
}
```

### 5. çŸ¥è­˜æ¼”åŒ–è¿½è¹¤ç³»çµ±ï¼ˆKnowledge Evolution Trackingï¼‰

#### 5.1 ç‰ˆæœ¬æ¼”é€²è¿½è¹¤

```typescript
// lib/knowledge/evolution/evolution-tracker.ts

/**
 * çŸ¥è­˜æ¼”åŒ–è¿½è¹¤ç³»çµ±
 * 
 * è¿½è¹¤çŸ¥è­˜çš„ç‰ˆæœ¬æ¼”é€²ã€ä¾è³´é—œä¿‚ã€å½±éŸ¿ç¯„åœ
 */
export class KnowledgeEvolutionTracker {
    /**
     * è¿½è¹¤çŸ¥è­˜æ¼”åŒ–
     */
    async trackEvolution(fileId: string): Promise<EvolutionChain> {
        // 1. å–å¾—ç‰ˆæœ¬æ­·å²
        const versions = await this.getVersionHistory(fileId);
        
        // 2. åˆ†æè®Šæ›´å…§å®¹
        const changes = await this.analyzeChanges(versions);
        
        // 3. è¿½è¹¤ä¾è³´å½±éŸ¿
        const impact = await this.trackDependencyImpact(fileId);
        
        // 4. å»ºæ§‹æ¼”åŒ–éˆ
        return {
            file_id: fileId,
            versions,
            changes,
            impact,
            evolution_path: this.buildEvolutionPath(versions, changes)
        };
    }
}
```

---

## ğŸ†• v3.0 é€²éšå­ç³»çµ±è¨­è¨ˆ

### 6. çŸ¥è­˜è¡°æ¸›æ¨¡å‹ï¼ˆKnowledge Decay Modelï¼‰

#### 6.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šä¸åŒé¡å‹çš„çŸ¥è­˜æœ‰ä¸åŒçš„ã€Œä¿é®®æœŸã€ï¼Œç°¡å–®çš„æ™‚é–“é–¾å€¼ç„¡æ³•ç²¾æº–åˆ¤æ–·çŸ¥è­˜æ˜¯å¦éæ™‚ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹ä¾æ“šçŸ¥è­˜é¡å‹çš„ã€Œè¡°æ¸›æ›²ç·šæ¨¡å‹ã€ï¼Œè‡ªå‹•è¨ˆç®—çŸ¥è­˜çš„æœ‰æ•ˆæ€§åˆ†æ•¸ã€‚

#### 6.2 è¡°æ¸›æ›²ç·šé¡å‹å®šç¾©

```typescript
// lib/knowledge/decay/knowledge-decay-model.ts

export enum KnowledgeDecayType {
    STABLE = 'stable',         // ç©©å®šå‹ï¼ˆå¦‚æ³•è¦ã€æ”¿ç­–ï¼‰
    TECHNICAL = 'technical',   // æŠ€è¡“å‹ï¼ˆå¦‚ API æ–‡ä»¶ï¼‰
    MARKET = 'market',         // å¸‚å ´å‹ï¼ˆå¦‚ç«¶å“åˆ†æï¼‰
    EVENT = 'event',           // äº‹ä»¶å‹ï¼ˆå¦‚æœƒè­°è¨˜éŒ„ï¼‰
    PROCEDURAL = 'procedural', // æµç¨‹å‹ï¼ˆå¦‚ SOPï¼‰
    REFERENCE = 'reference'    // åƒè€ƒå‹ï¼ˆå¦‚ç™¾ç§‘çŸ¥è­˜ï¼‰
}

/**
 * è¡°æ¸›æ›²ç·šé…ç½®è¡¨
 * 
 * åŠè¡°æœŸè¨­è¨ˆç†å¿µï¼š
 * - ç©©å®šå‹ï¼šæ³•è¦é€šå¸¸ 3-5 å¹´æ›´æ–°ï¼Œè¨­å®š 1095 å¤©ï¼ˆ3 å¹´ï¼‰
 * - æŠ€è¡“å‹ï¼šæŠ€è¡“è¿­ä»£å¿«ï¼Œè¨­å®š 365 å¤©ï¼ˆ1 å¹´ï¼‰
 * - å¸‚å ´å‹ï¼šå¸‚å ´è®ŠåŒ–è¿…é€Ÿï¼Œè¨­å®š 90 å¤©ï¼ˆ3 å€‹æœˆï¼‰
 * - äº‹ä»¶å‹ï¼šæœƒè­°è¨˜éŒ„æ™‚æ•ˆæ€§æœ€çŸ­ï¼Œè¨­å®š 30 å¤©ï¼ˆ1 å€‹æœˆï¼‰
 */
export const DECAY_CURVES: Map<KnowledgeDecayType, DecayCurve> = new Map([
    [KnowledgeDecayType.STABLE, {
        type: KnowledgeDecayType.STABLE,
        halfLife: 1095,  // 3 å¹´
        minValidScore: 0.3,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.TECHNICAL, {
        type: KnowledgeDecayType.TECHNICAL,
        halfLife: 365,   // 1 å¹´
        minValidScore: 0.4,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.MARKET, {
        type: KnowledgeDecayType.MARKET,
        halfLife: 90,    // 3 å€‹æœˆ
        minValidScore: 0.5,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.EVENT, {
        type: KnowledgeDecayType.EVENT,
        halfLife: 30,    // 1 å€‹æœˆ
        minValidScore: 0.3,
        decayFunction: 'exponential'
    }],
    [KnowledgeDecayType.PROCEDURAL, {
        type: KnowledgeDecayType.PROCEDURAL,
        halfLife: 548,   // 1.5 å¹´
        minValidScore: 0.5,
        decayFunction: 'step'  // SOP éæœŸå°±æ˜¯éæœŸï¼Œæ²’æœ‰æ¼¸é€²
    }],
    [KnowledgeDecayType.REFERENCE, {
        type: KnowledgeDecayType.REFERENCE,
        halfLife: 730,   // 2 å¹´
        minValidScore: 0.4,
        decayFunction: 'linear'
    }]
]);
```

#### 6.3 è³‡æ–™åº«çµæ§‹æ“´å……

```sql
-- æ–°å¢æ¬„ä½åˆ° files è¡¨
ALTER TABLE files ADD COLUMN IF NOT EXISTS decay_type VARCHAR(20) DEFAULT 'reference';
ALTER TABLE files ADD COLUMN IF NOT EXISTS decay_score DECIMAL(3,2) DEFAULT 1.0;
ALTER TABLE files ADD COLUMN IF NOT EXISTS decay_status VARCHAR(20) DEFAULT 'fresh';
ALTER TABLE files ADD COLUMN IF NOT EXISTS valid_until TIMESTAMPTZ DEFAULT NULL;

-- å»ºç«‹ç´¢å¼•ä»¥åŠ é€Ÿè¡°æ¸›ç‹€æ…‹æŸ¥è©¢
CREATE INDEX IF NOT EXISTS idx_files_decay_status 
    ON files(decay_status) WHERE gemini_state = 'SYNCED';
```

---

### 7. åé¥‹å­¸ç¿’è¿´è·¯ï¼ˆFeedback Learning Loopï¼‰

#### 7.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šç³»çµ±åªè¨˜éŒ„çŸ¥è­˜è¢«ä½¿ç”¨æ¬¡æ•¸ï¼Œä½†ä¸çŸ¥é“ä½¿ç”¨æ•ˆæœå¥½ä¸å¥½ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹å®Œæ•´çš„åé¥‹æ”¶é›†èˆ‡å­¸ç¿’æ©Ÿåˆ¶ï¼Œè®“çŸ¥è­˜å“è³ªè©•åˆ†èƒ½å¤ æŒçºŒå„ªåŒ–ã€‚

#### 7.2 åé¥‹é¡å‹å®šç¾©

```typescript
// lib/knowledge/feedback/feedback-types.ts

export enum FeedbackSource {
    USER_EXPLICIT = 'user_explicit',     // ä½¿ç”¨è€…æ˜ç¢ºåé¥‹ï¼ˆæŒ‰è®š/å€’è®šï¼‰
    USER_IMPLICIT = 'user_implicit',     // ä½¿ç”¨è€…éš±æ€§åé¥‹ï¼ˆç¹¼çºŒå°è©±/é‡æ–°æå•ï¼‰
    AGENT_SELF = 'agent_self',           // Agent è‡ªæˆ‘è©•ä¼°
    SYSTEM_AUDIT = 'system_audit'        // ç³»çµ±å¯©è¨ˆ
}

export enum FeedbackType {
    HELPFUL = 'helpful',               // æœ‰å¹«åŠ©
    NOT_HELPFUL = 'not_helpful',       // æ²’å¹«åŠ©
    OUTDATED = 'outdated',            // è³‡è¨Šéæ™‚
    INACCURATE = 'inaccurate',        // è³‡è¨Šä¸æ­£ç¢º
    INCOMPLETE = 'incomplete',         // è³‡è¨Šä¸å®Œæ•´
    IRRELEVANT = 'irrelevant',        // èˆ‡å•é¡Œç„¡é—œ
    PERFECT = 'perfect'               // å®Œç¾å›ç­”
}
```

#### 7.3 è³‡æ–™åº«çµæ§‹

```sql
-- åé¥‹äº‹ä»¶è¡¨
CREATE TABLE IF NOT EXISTS knowledge_feedback_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    file_id UUID REFERENCES files(id) ON DELETE CASCADE,
    agent_id UUID REFERENCES agents(id) ON DELETE SET NULL,
    session_id VARCHAR(255),
    
    source VARCHAR(30) NOT NULL,
    sentiment VARCHAR(10) NOT NULL,
    score DECIMAL(3,2) NOT NULL,
    feedback_type VARCHAR(30) NOT NULL,
    details JSONB DEFAULT '{}',
    context JSONB DEFAULT '{}',
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- æ–°å¢æ¬„ä½åˆ° files è¡¨
ALTER TABLE files ADD COLUMN IF NOT EXISTS feedback_score DECIMAL(3,2) DEFAULT 0.5;
ALTER TABLE files ADD COLUMN IF NOT EXISTS feedback_count INTEGER DEFAULT 0;
ALTER TABLE files ADD COLUMN IF NOT EXISTS positive_ratio DECIMAL(3,2) DEFAULT 0.5;
ALTER TABLE files ADD COLUMN IF NOT EXISTS needs_review BOOLEAN DEFAULT FALSE;
```

---

### 8. çŸ¥è­˜ç¢ç‰‡èšåˆï¼ˆKnowledge Fragment Aggregationï¼‰

#### 8.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šä¼æ¥­çŸ¥è­˜å¾€å¾€åˆ†æ•£åœ¨å¤šä»½æ–‡ä»¶ä¸­ï¼ŒAgent åªèƒ½ç²å–ç‰‡æ®µè¦–è§’ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šè‡ªå‹•ç™¼ç¾è¨è«–åŒä¸€æ¦‚å¿µçš„æ–‡ä»¶ï¼Œèšåˆæˆå®Œæ•´çš„ã€ŒçŸ¥è­˜å–®å…ƒã€ã€‚

#### 8.2 çŸ¥è­˜å–®å…ƒå®šç¾©

```typescript
// lib/knowledge/aggregation/knowledge-unit.ts

export interface KnowledgeUnit {
    id: string;
    concept_id: string;           // æ ¸å¿ƒæ¦‚å¿µ ID
    concept_name: string;         // æ¦‚å¿µåç¨±ï¼ˆå¦‚ã€Œå“¡å·¥é›¢è·æµç¨‹ã€ï¼‰
    concept_description: string;  // æ¦‚å¿µæè¿°
    source_files: SourceFile[];   // çµ„æˆæ­¤çŸ¥è­˜å–®å…ƒçš„æ–‡ä»¶
    synthesized_knowledge: string;  // AI åˆæˆçš„çµ±ä¸€çŸ¥è­˜
    conflicts: ConflictRecord[];    // ç™¼ç¾çš„è¡çª
    conflict_resolution: string;    // è¡çªè§£æ±ºèªªæ˜
    completeness_score: number;     // çŸ¥è­˜å®Œæ•´åº¦
    confidence_score: number;       // ç¶œåˆä¿¡å¿ƒåº¦
    coverage_map: CoverageMap;      // çŸ¥è­˜è¦†è“‹åœ°åœ–
    created_at: string;
    updated_at: string;
    auto_generated: boolean;
}
```

#### 8.3 è³‡æ–™åº«çµæ§‹

```sql
-- çŸ¥è­˜å–®å…ƒè¡¨
CREATE TABLE IF NOT EXISTS knowledge_units (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    concept_id VARCHAR(255) NOT NULL UNIQUE,
    concept_name VARCHAR(500) NOT NULL,
    concept_description TEXT,
    source_files JSONB NOT NULL DEFAULT '[]',
    synthesized_knowledge TEXT,
    conflicts JSONB DEFAULT '[]',
    conflict_resolution TEXT,
    completeness_score DECIMAL(3,2) DEFAULT 0,
    confidence_score DECIMAL(3,2) DEFAULT 0,
    coverage_map JSONB DEFAULT '{}',
    auto_generated BOOLEAN DEFAULT TRUE,
    needs_human_review BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- çŸ¥è­˜å–®å…ƒèˆ‡æ–‡ä»¶çš„é—œè¯è¡¨
CREATE TABLE IF NOT EXISTS knowledge_unit_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    unit_id UUID REFERENCES knowledge_units(id) ON DELETE CASCADE,
    file_id UUID REFERENCES files(id) ON DELETE CASCADE,
    contribution TEXT,
    coverage_areas JSONB DEFAULT '[]',
    weight DECIMAL(3,2) DEFAULT 1.0,
    UNIQUE(unit_id, file_id)
);
```

---

### 9. é«˜æ•ˆèƒ½èªç¾©æœå°‹ï¼ˆHigh-Performance Semantic Searchï¼‰

#### 9.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šå…©å…©æ¯”è¼ƒ Embedding çš„ O(nÂ²) æ¼”ç®—æ³•åœ¨è¬ç´šæ–‡ä»¶æ™‚æ¥µæ…¢ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ Approximate Nearest Neighbor (ANN) æ¼”ç®—æ³•å¯¦ç¾è¿‘ä¼¼å³æ™‚æœå°‹ã€‚

#### 9.2 PostgreSQL + pgvector å„ªåŒ–é…ç½®

```sql
-- ç¢ºä¿ pgvector æ“´å±•å·²å•Ÿç”¨
CREATE EXTENSION IF NOT EXISTS vector;

-- ç‚º content_embedding å»ºç«‹ HNSW ç´¢å¼•ï¼ˆæ¨è–¦ç”¨æ–¼é«˜ç¶­å‘é‡ï¼‰
CREATE INDEX IF NOT EXISTS idx_files_embedding_hnsw 
    ON files 
    USING hnsw (content_embedding vector_cosine_ops)
    WITH (m = 16, ef_construction = 64);

-- èªç¾©æœå°‹å‡½æ•¸ï¼ˆä½¿ç”¨ ANN ç´¢å¼•ï¼‰
CREATE OR REPLACE FUNCTION semantic_search_ann(
    query_embedding vector(1536),
    similarity_threshold FLOAT DEFAULT 0.7,
    match_count INTEGER DEFAULT 10,
    filter_department UUID DEFAULT NULL,
    filter_category UUID DEFAULT NULL,
    filter_dikw_level TEXT DEFAULT NULL
)
RETURNS TABLE(
    id UUID,
    filename TEXT,
    similarity FLOAT,
    snippet TEXT,
    dikw_level TEXT,
    decay_score FLOAT
) AS $$
BEGIN
    RETURN QUERY
    SELECT 
        f.id,
        f.filename,
        1 - (f.content_embedding <=> query_embedding) as similarity,
        LEFT(f.markdown_content, 200) as snippet,
        f.dikw_level,
        f.decay_score
    FROM files f
    WHERE f.gemini_state = 'SYNCED'
    AND f.content_embedding IS NOT NULL
    AND (filter_department IS NULL OR f.department_id = filter_department)
    AND (filter_category IS NULL OR f.category_id = filter_category)
    AND (filter_dikw_level IS NULL OR f.dikw_level = filter_dikw_level)
    AND 1 - (f.content_embedding <=> query_embedding) >= similarity_threshold
    ORDER BY f.content_embedding <=> query_embedding
    LIMIT match_count;
END;
$$ LANGUAGE plpgsql;
```

#### 9.3 æ•ˆèƒ½å°æ¯”

| æ¼”ç®—æ³• | æ™‚é–“è¤‡é›œåº¦ | 10,000 æª”æ¡ˆ | 100,000 æª”æ¡ˆ | ç²¾ç¢ºåº¦ |
|-------|-----------|-------------|--------------|--------|
| æš´åŠ›æ³• (Brute Force) | O(nÂ²) | ~5 åˆ†é˜ | ~8 å°æ™‚ | 100% |
| IVFFlat | O(nÂ·âˆšn) | ~3 ç§’ | ~30 ç§’ | ~95% |
| **HNSW** | O(nÂ·log n) | **<1 ç§’** | **~5 ç§’** | **~98%** |

---

### 10. ä¸»å‹•æ¨é€æ©Ÿåˆ¶ï¼ˆProactive Knowledge Pushï¼‰

#### 10.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šçŸ¥è­˜æ›´æ–°æ™‚ï¼Œä½¿ç”¨è©²çŸ¥è­˜çš„ Agent ä¸æœƒè‡ªå‹•çŸ¥é“ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹äº‹ä»¶é©…å‹•çš„ä¸»å‹•é€šçŸ¥ç³»çµ±ã€‚

#### 10.2 é€šçŸ¥äº‹ä»¶é¡å‹

```typescript
// lib/knowledge/push/notification-types.ts

export enum KnowledgeNotificationType {
    // ç·Šæ€¥é€šçŸ¥ï¼ˆéœ€ç«‹å³è™•ç†ï¼‰
    KNOWLEDGE_EXPIRED = 'knowledge_expired',
    CRITICAL_UPDATE = 'critical_update',
    CONFLICT_DETECTED = 'conflict_detected',
    
    // é‡è¦é€šçŸ¥ï¼ˆå»ºè­°ç•¶æ—¥è™•ç†ï¼‰
    KNOWLEDGE_UPDATED = 'knowledge_updated',
    QUALITY_DEGRADATION = 'quality_degradation',
    APPROACHING_EXPIRY = 'approaching_expiry',
    
    // è³‡è¨Šé€šçŸ¥ï¼ˆå¯ç¨å¾Œè™•ç†ï¼‰
    NEW_RELATED_KNOWLEDGE = 'new_related_knowledge',
    AGGREGATION_AVAILABLE = 'aggregation_available',
    FEEDBACK_SUMMARY = 'feedback_summary'
}
```

#### 10.3 è³‡æ–™åº«çµæ§‹

```sql
-- é€šçŸ¥è¡¨
CREATE TABLE IF NOT EXISTS knowledge_notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    type VARCHAR(50) NOT NULL,
    priority VARCHAR(10) NOT NULL,
    affected_files UUID[] DEFAULT '{}',
    affected_agents UUID[] DEFAULT '{}',
    affected_users UUID[] DEFAULT '{}',
    title TEXT NOT NULL,
    message TEXT NOT NULL,
    details JSONB DEFAULT '{}',
    suggested_actions JSONB DEFAULT '[]',
    status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    sent_at TIMESTAMPTZ,
    read_at TIMESTAMPTZ,
    resolved_at TIMESTAMPTZ,
    resolved_by UUID REFERENCES user_profiles(id)
);

-- Agent çŸ¥è­˜ä¾†æºé—œè¯è¡¨
CREATE TABLE IF NOT EXISTS agent_knowledge_sources (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    agent_id UUID REFERENCES agents(id) ON DELETE CASCADE,
    file_id UUID REFERENCES files(id) ON DELETE CASCADE,
    added_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(agent_id, file_id)
);

-- æ–°å¢æ¬„ä½åˆ° agents è¡¨
ALTER TABLE agents ADD COLUMN IF NOT EXISTS knowledge_status VARCHAR(30) DEFAULT 'up_to_date';
ALTER TABLE agents ADD COLUMN IF NOT EXISTS last_knowledge_alert TIMESTAMPTZ;
ALTER TABLE agents ADD COLUMN IF NOT EXISTS status_reason TEXT;

-- çŸ¥è­˜æ›´æ–°è§¸ç™¼å™¨
CREATE OR REPLACE FUNCTION notify_knowledge_update()
RETURNS TRIGGER AS $$
BEGIN
    PERFORM pg_notify(
        'knowledge_update',
        json_build_object(
            'file_id', NEW.id,
            'action', TG_OP,
            'updated_at', NEW.updated_at
        )::text
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_knowledge_update
    AFTER INSERT OR UPDATE ON files
    FOR EACH ROW
    WHEN (NEW.gemini_state = 'SYNCED')
    EXECUTE FUNCTION notify_knowledge_update();
```

---

### 11. AI å›ç­”å“è³ªé˜²è­·æ©Ÿåˆ¶ï¼ˆAI Response Quality Safeguardsï¼‰

#### 11.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šAI Agent çš„å›ç­”å¯èƒ½åŒ…å«éŒ¯èª¤è³‡è¨Šã€éæ™‚è³‡æ–™æˆ–ç¼ºä¹ä¾†æºä¾æ“šï¼Œéœ€è¦å»ºç«‹å¤šå±¤é˜²è­·æ©Ÿåˆ¶ç¢ºä¿å›ç­”å“è³ªã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹ 5 å±¤é˜²è­·æ©Ÿåˆ¶ï¼Œå¾æŠ€è¡“å¼·åˆ¶åˆ°äººå·¥å¯©è¨ˆï¼Œç¢ºä¿ AI å›ç­”çš„å¯ä¿¡åº¦èˆ‡å¯è¿½æº¯æ€§ã€‚

#### 11.2 äº”å±¤é˜²è­·æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AI å›ç­”å“è³ªé˜²è­·æ©Ÿåˆ¶ (5-Layer Safeguards)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Layer 1: å¼·åˆ¶å¼•ç”¨ä¾†æº (Mandatory Citations)             â”‚
â”‚  â””â”€ æ¯å€‹å›ç­”éƒ½å¿…é ˆæ¨™è¨»ä¾†æºæª”æ¡ˆï¼Œå¯è¿½æº¯                     â”‚
â”‚                                                           â”‚
â”‚  Layer 2: ä¿¡å¿ƒåº¦è©•åˆ† (Confidence Scoring)                â”‚
â”‚  â””â”€ AI è¼¸å‡ºä¿¡å¿ƒåº¦ï¼Œä½ä¿¡å¿ƒåº¦ä¸»å‹•è­¦å‘Š                       â”‚
â”‚                                                           â”‚
â”‚  Layer 3: äººå·¥è¦†æ ¸æç¤º (Manual Review Prompts)           â”‚
â”‚  â””â”€ æ¶‰åŠé‡‘é¡ã€äº¤æœŸç­‰é—œéµè³‡è¨Šæ™‚æé†’è¦†æ ¸                   â”‚
â”‚                                                           â”‚
â”‚  Layer 4: ä½¿ç”¨è€…åé¥‹å­¸ç¿’ (User Feedback Learning)        â”‚
â”‚  â””â”€ æ”¶é›†è² è©•ä¸¦èª¿æ•´çŸ¥è­˜åº«æ¬Šé‡ï¼ŒæŒçºŒå„ªåŒ–                   â”‚
â”‚                                                           â”‚
â”‚  Layer 5: å®šæœŸäººå·¥å¯©è¨ˆ (Scheduled Audit)                 â”‚
â”‚  â””â”€ æ¯æœˆè‡ªå‹•ç¯©é¸é«˜é¢¨éšªå›ç­”ä¾›ç®¡ç†å“¡å¯©æŸ¥                   â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 11.3 Layer 1: å¼·åˆ¶å¼•ç”¨ä¾†æºï¼ˆMandatory Citationsï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šä½¿ç”¨ Gemini API çš„ `groundingMetadata` åŠŸèƒ½ï¼Œå¼·åˆ¶æå–å¼•ç”¨ä¾†æºã€‚

```typescript
// app/api/chat/route.ts

import { GoogleGenerativeAI } from '@google/generative-ai';

export async function POST(request: NextRequest) {
    // ... ç¾æœ‰ç¨‹å¼ç¢¼ ...
    
    // 1. å–å¾—çŸ¥è­˜åº«æª”æ¡ˆ URIï¼ˆç”¨æ–¼ Groundingï¼‰
    const { data: matchedFiles } = await supabase
        .from('files')
        .select('gemini_file_uri, filename')
        .in('id', Array.from(matchedFileIds))
        .eq('gemini_state', 'SYNCED');
    
    // 2. å»ºæ§‹æª”æ¡ˆè³‡æ–™ï¼ˆç”¨æ–¼ Groundingï¼‰
    const fileData = (matchedFiles || []).map(f => ({
        fileUri: f.gemini_file_uri,
        mimeType: 'application/pdf' // æˆ–å¾ files è¡¨å–å¾—å¯¦éš› mime_type
    }));
    
    // 3. ä½¿ç”¨ Gemini API ä¸¦å•Ÿç”¨ Grounding
    const model = genAI.getGenerativeModel({
        model: agent.model_version || 'gemini-3-flash-preview',
        systemInstruction: fullSystemPrompt,
    });
    
    const chat = model.startChat({ history: historyMessages });
    
    // 4. å»ºæ§‹è«‹æ±‚å…§å®¹ï¼ˆåŒ…å«æª”æ¡ˆ URIï¼‰
    const parts = [
        ...fileData.map(f => ({
            fileData: {
                fileUri: f.fileUri,
                mimeType: f.mimeType
            }
        })),
        { text: message }
    ];
    
    // 5. ç™¼é€è«‹æ±‚ä¸¦æå– Grounding Metadata
    const result = await chat.sendMessageStream(parts);
    
    let fullAiResponse = '';
    let citations: Citation[] = [];
    
    for await (const chunk of result.stream) {
        const text = chunk.text();
        if (text) {
            fullAiResponse += text;
            // ä¸²æµç™¼é€çµ¦å‰ç«¯
            controller.enqueue(encoder.encode(`data: ${JSON.stringify({ text })}\n\n`));
        }
    }
    
    // 6. å–å¾—å®Œæ•´å›æ‡‰ä»¥æå– Grounding Metadata
    const fullResponse = await chat.sendMessage(parts);
    const response = await fullResponse.response;
    
    // 7. æå–å¼•ç”¨ä¾†æº
    if (response.groundingMetadata) {
        const { groundingChunks, groundingSupports } = response.groundingMetadata;
        
        citations = groundingChunks.map((chunk: any, index: number) => {
            // å¾ URI å°æ‡‰å›æª”æ¡ˆè³‡è¨Š
            const file = matchedFiles?.find(f => f.gemini_file_uri === chunk.uri);
            
            return {
                startIndex: groundingSupports[index]?.segment?.startIndex || 0,
                endIndex: groundingSupports[index]?.segment?.endIndex || 0,
                uri: chunk.uri,
                title: file?.filename || chunk.web?.title || 'æœªçŸ¥ä¾†æº',
                content: chunk.chunk?.text || ''
            };
        });
    }
    
    // 8. ç™¼é€å¼•ç”¨ä¾†æºçµ¦å‰ç«¯
    controller.enqueue(encoder.encode(`data: ${JSON.stringify({ citations })}\n\n`));
    
    // ... å„²å­˜åˆ°è³‡æ–™åº«æ™‚ä¹ŸåŒ…å« citations ...
}
```

**è³‡æ–™åº«çµæ§‹æ“´å……**ï¼š

```sql
-- æ“´å…… chat_messages è¡¨ä»¥å„²å­˜å¼•ç”¨ä¾†æº
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS citations JSONB DEFAULT '[]';

-- å»ºç«‹ç´¢å¼•ä»¥åŠ é€ŸæŸ¥è©¢
CREATE INDEX IF NOT EXISTS idx_chat_messages_citations 
    ON chat_messages USING GIN (citations);
```

**å‰ç«¯é¡¯ç¤º**ï¼š

```typescript
// components/chat/ChatBubble.tsx

// å·²æœ‰ CitationList å…ƒä»¶ï¼Œåªéœ€ç¢ºä¿ citations æ­£ç¢ºå‚³å…¥
{citations && citations.length > 0 && (
    <div className="mt-8 pt-6 border-t border-white/5">
        <CitationList citations={citations} dict={dict} />
    </div>
)}
```

#### 11.4 Layer 2: ä¿¡å¿ƒåº¦è©•åˆ†ï¼ˆConfidence Scoringï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šè¦æ±‚ AI åœ¨å›æ‡‰ä¸­è¼¸å‡ºä¿¡å¿ƒåº¦åˆ†æ•¸ï¼Œä¸¦æ ¹æ“šçŸ¥è­˜åº«åŒ¹é…åº¦è¨ˆç®—ç¶œåˆä¿¡å¿ƒåº¦ã€‚

```typescript
// app/api/chat/route.ts

// 1. ä¿®æ”¹ System Prompt è¦æ±‚è¼¸å‡ºä¿¡å¿ƒåº¦
const fullSystemPrompt = `${agent.system_prompt}

${knowledgeContext ? `
ã€å·²è¼‰å…¥çš„çŸ¥è­˜åº«å…§å®¹ã€‘
${knowledgeContext}

ã€å›ç­”æº–å‰‡ã€‘
1. å„ªå…ˆå¼•ç”¨ä¸Šè¿°çŸ¥è­˜åº«ä¸­çš„å…·é«”äº‹å¯¦ã€‚
2. æ¨™è¨»ä¾†æºæ–‡ä»¶åç¨±ã€‚
3. ä»¥ç¹é«”ä¸­æ–‡å›ç­”ï¼Œèªæ°£å°ˆæ¥­ã€ç²¾æº–ã€‚
4. è‹¥è³‡è¨Šä¸è¶³ï¼Œè«‹å¦ç™½å‘ŠçŸ¥ã€‚
5. **å¿…é ˆåœ¨å›ç­”çµå°¾ä»¥ JSON æ ¼å¼è¼¸å‡ºä¿¡å¿ƒåº¦**ï¼š
   {"confidence": 0.0-1.0, "reasoning": "ä¿¡å¿ƒåº¦èªªæ˜"}
` : ''}`;

// 2. è§£æå›æ‡‰ä¸­çš„ä¿¡å¿ƒåº¦
function extractConfidence(response: string): { confidence: number; reasoning: string } {
    // å˜—è©¦å¾ JSON æ ¼å¼æå–
    const jsonMatch = response.match(/\{"confidence":\s*([\d.]+),\s*"reasoning":\s*"([^"]+)"\}/);
    if (jsonMatch) {
        return {
            confidence: parseFloat(jsonMatch[1]),
            reasoning: jsonMatch[2]
        };
    }
    
    // å‚™ç”¨ï¼šæ ¹æ“šçŸ¥è­˜åº«åŒ¹é…åº¦è¨ˆç®—
    return {
        confidence: calculateConfidenceFromMatches(matchedFiles),
        reasoning: 'æ ¹æ“šçŸ¥è­˜åº«åŒ¹é…åº¦è¨ˆç®—'
    };
}

// 3. è¨ˆç®—çŸ¥è­˜åº«åŒ¹é…åº¦ä¿¡å¿ƒåº¦
function calculateConfidenceFromMatches(files: any[]): number {
    if (!files || files.length === 0) return 0.3; // ç„¡ä¾†æºï¼Œä½ä¿¡å¿ƒåº¦
    
    // æ ¹æ“šåŒ¹é…æª”æ¡ˆæ•¸é‡èˆ‡å“è³ªè©•åˆ†è¨ˆç®—
    const avgQuality = files.reduce((sum, f) => sum + (f.feedback_score || 0.5), 0) / files.length;
    const fileCountScore = Math.min(files.length / 5, 1.0); // æœ€å¤š 5 å€‹ä¾†æºç‚ºæ»¿åˆ†
    
    return (avgQuality * 0.7 + fileCountScore * 0.3);
}

// 4. å„²å­˜ä¿¡å¿ƒåº¦åˆ°è³‡æ–™åº«
const { confidence, reasoning } = extractConfidence(fullAiResponse);
await supabase.from('chat_messages').insert({
    // ... å…¶ä»–æ¬„ä½ ...
    confidence_score: confidence,
    confidence_reasoning: reasoning
});

// 5. ä½ä¿¡å¿ƒåº¦è­¦å‘Šï¼ˆ< 0.6ï¼‰
if (confidence < 0.6) {
    controller.enqueue(encoder.encode(`data: ${JSON.stringify({ 
        warning: 'low_confidence',
        message: 'æ­¤å›ç­”çš„ä¿¡å¿ƒåº¦è¼ƒä½ï¼Œå»ºè­°äººå·¥è¦†æ ¸',
        confidence,
        reasoning
    })}\n\n`));
}
```

**è³‡æ–™åº«çµæ§‹æ“´å……**ï¼š

```sql
-- æ“´å…… chat_messages è¡¨
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS confidence_score DECIMAL(3,2);
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS confidence_reasoning TEXT;

-- å»ºç«‹ç´¢å¼•ä»¥åŠ é€ŸæŸ¥è©¢ä½ä¿¡å¿ƒåº¦å›ç­”
CREATE INDEX IF NOT EXISTS idx_chat_messages_low_confidence 
    ON chat_messages(confidence_score) 
    WHERE confidence_score < 0.6;
```

**å‰ç«¯é¡¯ç¤ºä½ä¿¡å¿ƒåº¦è­¦å‘Š**ï¼š

```typescript
// components/chat/ChatBubble.tsx

{message.confidence_score !== undefined && message.confidence_score < 0.6 && (
    <div className="mt-4 p-4 bg-warning-500/10 border border-warning-500/30 rounded-xl">
        <div className="flex items-center gap-2">
            <AlertTriangle size={16} className="text-warning-500" />
            <span className="text-sm text-warning-500 font-semibold">
                ä½ä¿¡å¿ƒåº¦è­¦å‘Š
            </span>
        </div>
        <p className="text-xs text-text-tertiary mt-2">
            æ­¤å›ç­”çš„ä¿¡å¿ƒåº¦ç‚º {Math.round(message.confidence_score * 100)}%ï¼Œ
            å»ºè­°äººå·¥è¦†æ ¸ã€‚{message.confidence_reasoning && `åŸå› ï¼š${message.confidence_reasoning}`}
        </p>
    </div>
)}
```

#### 11.5 Layer 3: äººå·¥è¦†æ ¸æç¤ºï¼ˆManual Review Promptsï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šæª¢æ¸¬é—œéµå­—ï¼ˆé‡‘é¡ã€äº¤æœŸç­‰ï¼‰ï¼Œè‡ªå‹•é¡¯ç¤ºè¦†æ ¸æç¤ºã€‚

```typescript
// lib/chat/review-detector.ts

export interface ReviewTrigger {
    keywords: string[];
    category: 'financial' | 'delivery' | 'legal' | 'safety';
    severity: 'high' | 'medium' | 'low';
    message: string;
}

export const REVIEW_TRIGGERS: ReviewTrigger[] = [
    {
        keywords: ['é‡‘é¡', 'åƒ¹æ ¼', 'æˆæœ¬', 'å ±åƒ¹', '$', 'å…ƒ', 'è¬', 'ç™¾è¬', 'åƒè¬', 'é ç®—', 'è²»ç”¨'],
        category: 'financial',
        severity: 'high',
        message: 'æ­¤å›ç­”æ¶‰åŠé‡‘é¡è³‡è¨Šï¼Œå»ºè­°äººå·¥è¦†æ ¸ç¢ºèª'
    },
    {
        keywords: ['äº¤æœŸ', 'äº¤è²¨', 'äº¤ä»˜', 'æœŸé™', 'deadline', 'lead time', 'äº¤è²¨æ—¥æœŸ', 'å®Œæˆæ—¥æœŸ'],
        category: 'delivery',
        severity: 'high',
        message: 'æ­¤å›ç­”æ¶‰åŠäº¤æœŸè³‡è¨Šï¼Œå»ºè­°äººå·¥è¦†æ ¸ç¢ºèª'
    },
    {
        keywords: ['åˆç´„', 'å”è­°', 'æ¢æ¬¾', 'é•ç´„', 'è³ å„Ÿ', 'æ³•å¾‹'],
        category: 'legal',
        severity: 'high',
        message: 'æ­¤å›ç­”æ¶‰åŠæ³•å¾‹æ¢æ¬¾ï¼Œå»ºè­°äººå·¥è¦†æ ¸ç¢ºèª'
    },
    {
        keywords: ['å®‰å…¨', 'é¢¨éšª', 'å±éšª', 'äº‹æ•…', 'å‚·å®³'],
        category: 'safety',
        severity: 'high',
        message: 'æ­¤å›ç­”æ¶‰åŠå®‰å…¨ç›¸é—œè³‡è¨Šï¼Œå»ºè­°äººå·¥è¦†æ ¸ç¢ºèª'
    }
];

export function detectReviewTriggers(content: string): ReviewTrigger[] {
    const detected: ReviewTrigger[] = [];
    const lowerContent = content.toLowerCase();
    
    for (const trigger of REVIEW_TRIGGERS) {
        const found = trigger.keywords.some(keyword => 
            lowerContent.includes(keyword.toLowerCase())
        );
        
        if (found) {
            detected.push(trigger);
        }
    }
    
    return detected;
}
```

**API æ•´åˆ**ï¼š

```typescript
// app/api/chat/route.ts

import { detectReviewTriggers } from '@/lib/chat/review-detector';

// åœ¨å›æ‡‰å®Œæˆå¾Œæª¢æ¸¬
const reviewTriggers = detectReviewTriggers(fullAiResponse);

if (reviewTriggers.length > 0) {
    // ç™¼é€è¦†æ ¸æç¤ºçµ¦å‰ç«¯
    controller.enqueue(encoder.encode(`data: ${JSON.stringify({ 
        review_required: true,
        triggers: reviewTriggers,
        message: reviewTriggers[0].message // é¡¯ç¤ºç¬¬ä¸€å€‹è§¸ç™¼çš„è¨Šæ¯
    })}\n\n`));
    
    // æ¨™è¨˜è¨Šæ¯éœ€è¦è¦†æ ¸
    await supabase.from('chat_messages').update({
        needs_review: true,
        review_triggers: reviewTriggers.map(t => t.category)
    }).eq('id', aiMessage.id);
}
```

**å‰ç«¯é¡¯ç¤ºè¦†æ ¸æç¤º**ï¼š

```typescript
// components/chat/ChatBubble.tsx

{message.review_required && (
    <div className="mt-4 p-4 bg-primary-500/10 border border-primary-500/30 rounded-xl">
        <div className="flex items-center gap-2">
            <AlertCircle size={16} className="text-primary-400" />
            <span className="text-sm text-primary-400 font-semibold">
                å»ºè­°äººå·¥è¦†æ ¸
            </span>
        </div>
        <p className="text-xs text-text-tertiary mt-2">
            {message.review_message}
        </p>
        <button 
            onClick={() => markAsReviewed(message.id)}
            className="mt-2 text-xs text-primary-400 hover:text-primary-300"
        >
            æ¨™è¨˜ç‚ºå·²è¦†æ ¸
        </button>
    </div>
)}
```

**è³‡æ–™åº«çµæ§‹æ“´å……**ï¼š

```sql
-- æ“´å…… chat_messages è¡¨
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS needs_review BOOLEAN DEFAULT FALSE;
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS review_triggers TEXT[];
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS reviewed_at TIMESTAMPTZ;
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS reviewed_by UUID REFERENCES user_profiles(id);

-- å»ºç«‹ç´¢å¼•ä»¥åŠ é€ŸæŸ¥è©¢éœ€è¦è¦†æ ¸çš„è¨Šæ¯
CREATE INDEX IF NOT EXISTS idx_chat_messages_needs_review 
    ON chat_messages(needs_review) 
    WHERE needs_review = TRUE;
```

#### 11.6 Layer 4: ä½¿ç”¨è€…åé¥‹å­¸ç¿’ï¼ˆUser Feedback Learningï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šæ ¹æ“šä½¿ç”¨è€…è² è©•èª¿æ•´çŸ¥è­˜åº«æ¬Šé‡ï¼Œæ¨™è¨˜ä½å“è³ªæª”æ¡ˆã€‚

```typescript
// lib/knowledge/feedback-learning.ts

export class FeedbackLearningEngine {
    /**
     * è™•ç†ä½¿ç”¨è€…åé¥‹ä¸¦èª¿æ•´çŸ¥è­˜åº«æ¬Šé‡
     */
    async processFeedback(feedbackEvent: {
        message_id: string;
        rating: 1 | -1;
        reason_code?: string;
        comment?: string;
    }): Promise<void> {
        const supabase = await createClient();
        
        // 1. å–å¾—è¨Šæ¯ç›¸é—œçš„çŸ¥è­˜ä¾†æº
        const { data: message } = await supabase
            .from('chat_messages')
            .select('id, citations, agent_id')
            .eq('id', feedbackEvent.message_id)
            .single();
        
        if (!message || !message.citations) return;
        
        // 2. å¾ citations æå–æª”æ¡ˆ ID
        const fileIds = this.extractFileIdsFromCitations(message.citations);
        
        // 3. æ ¹æ“šè² è©•èª¿æ•´æª”æ¡ˆæ¬Šé‡
        if (feedbackEvent.rating === -1) {
            await this.adjustFileWeights(fileIds, -0.1); // é™ä½æ¬Šé‡
            
            // æ¨™è¨˜æª”æ¡ˆéœ€è¦å¯©æŸ¥
            await supabase
                .from('files')
                .update({ needs_review: true })
                .in('id', fileIds);
            
            // è¨˜éŒ„åé¥‹äº‹ä»¶
            await supabase.from('knowledge_feedback_events').insert({
                file_id: fileIds[0], // ä¸»è¦ä¾†æºæª”æ¡ˆ
                agent_id: message.agent_id,
                source: 'user_explicit',
                sentiment: 'negative',
                score: -1,
                feedback_type: feedbackEvent.reason_code || 'not_helpful',
                details: {
                    comment: feedbackEvent.comment,
                    message_id: feedbackEvent.message_id
                }
            });
        } else {
            // æ­£è©•ï¼šæå‡æ¬Šé‡
            await this.adjustFileWeights(fileIds, 0.05);
        }
        
        // 4. æ›´æ–°æª”æ¡ˆçµ±è¨ˆ
        for (const fileId of fileIds) {
            await updateFileFeedbackStats(fileId);
        }
    }
    
    /**
     * èª¿æ•´æª”æ¡ˆæ¬Šé‡ï¼ˆå½±éŸ¿çŸ¥è­˜æª¢ç´¢å„ªå…ˆé †åºï¼‰
     */
    private async adjustFileWeights(fileIds: string[], delta: number): Promise<void> {
        const supabase = await createClient();
        
        // æ›´æ–°æª”æ¡ˆçš„ relevance_weightï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
        // æˆ–é€é feedback_score å½±éŸ¿æª¢ç´¢
        for (const fileId of fileIds) {
            const { data: file } = await supabase
                .from('files')
                .select('feedback_score')
                .eq('id', fileId)
                .single();
            
            if (file) {
                const newScore = Math.max(0, Math.min(1, (file.feedback_score || 0.5) + delta));
                await supabase
                    .from('files')
                    .update({ feedback_score: newScore })
                    .eq('id', fileId);
            }
        }
    }
    
    /**
     * å¾ citations æå–æª”æ¡ˆ ID
     */
    private extractFileIdsFromCitations(citations: any[]): string[] {
        // å¾ citation URI æˆ– title å°æ‡‰å›æª”æ¡ˆ ID
        // å¯¦ä½œç´°ç¯€ï¼šéœ€è¦å»ºç«‹ URI åˆ° file_id çš„æ˜ å°„è¡¨
        return [];
    }
}
```

**çŸ¥è­˜æª¢ç´¢æ™‚æ‡‰ç”¨æ¬Šé‡**ï¼š

```typescript
// lib/knowledge/search.ts

export async function searchKnowledgeWithWeights(
    query: string,
    agentId: string
): Promise<SearchResult[]> {
    const supabase = await createClient();
    
    // 1. å‘é‡æœå°‹
    const embedding = await generateEmbedding(query);
    const { data: matches } = await supabase.rpc('search_knowledge_global', {
        query_embedding: embedding,
        match_threshold: 0.1,
        match_count: 20
    });
    
    // 2. å–å¾—æª”æ¡ˆåé¥‹åˆ†æ•¸
    const fileIds = matches.map((m: any) => m.file_id);
    const { data: files } = await supabase
        .from('files')
        .select('id, feedback_score, needs_review')
        .in('id', fileIds);
    
    const fileScores = new Map(
        files?.map(f => [f.id, f.feedback_score || 0.5]) || []
    );
    
    // 3. åŠ æ¬Šæ’åºï¼šç›¸ä¼¼åº¦ * åé¥‹åˆ†æ•¸
    const weightedResults = matches.map((match: any) => ({
        ...match,
        weighted_score: match.similarity * (fileScores.get(match.file_id) || 0.5)
    })).sort((a, b) => b.weighted_score - a.weighted_score);
    
    return weightedResults.slice(0, 10); // è¿”å›å‰ 10 å€‹
}
```

#### 11.7 Layer 5: å®šæœŸäººå·¥å¯©è¨ˆï¼ˆScheduled Auditï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šå»ºç«‹ Cron Job æ¯æœˆè‡ªå‹•ç¯©é¸é«˜é¢¨éšªå›ç­”ã€‚

```typescript
// app/api/cron/audit-high-risk-responses/route.ts

import { NextRequest, NextResponse } from 'next/server';
import { createAdminClient } from '@/lib/supabase/admin';

/**
 * å®šæœŸå¯©è¨ˆï¼šæ¯æœˆ 1 è™Ÿè‡ªå‹•ç¯©é¸é«˜é¢¨éšªå›ç­”
 * Vercel Cron è¨­å®šï¼š0 0 1 * * (æ¯æœˆ 1 è™Ÿ 00:00 UTC)
 */
export async function GET(request: Request) {
    // 1. é©—è­‰ Cron å¯†é‘°
    const authHeader = request.headers.get('authorization');
    const cronSecret = process.env.CRON_SECRET;
    const isVercelCron = request.headers.get('x-vercel-cron') === '1';
    
    if (!isVercelCron && (!cronSecret || authHeader !== `Bearer ${cronSecret}`)) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }
    
    const supabase = createAdminClient();
    
    try {
        // 2. æŸ¥è©¢éå»ä¸€å€‹æœˆçš„é«˜é¢¨éšªå›ç­”
        const oneMonthAgo = new Date();
        oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
        
        const { data: highRiskMessages } = await supabase
            .from('chat_messages')
            .select(`
                id,
                content,
                confidence_score,
                needs_review,
                review_triggers,
                created_at,
                agent_id,
                agents(name),
                chat_sessions(user_id, user_profiles(display_name, email))
            `)
            .gte('created_at', oneMonthAgo.toISOString())
            .or(`
                confidence_score.lt.0.6,
                needs_review.eq.true,
                review_triggers.neq.[]
            `)
            .order('created_at', { ascending: false })
            .limit(100);
        
        // 3. çµ±è¨ˆè² è©•ç‡
        const messageIds = highRiskMessages?.map(m => m.id) || [];
        
        const { data: feedbacks } = await supabase
            .from('chat_feedback')
            .select('message_id, rating')
            .in('message_id', messageIds);
        
        // è¨ˆç®—æ¯å€‹è¨Šæ¯çš„è² è©•ç‡
        const negativeRateMap = new Map<string, number>();
        for (const msg of highRiskMessages || []) {
            const msgFeedbacks = feedbacks?.filter(f => f.message_id === msg.id) || [];
            const negativeCount = msgFeedbacks.filter(f => f.rating === -1).length;
            const totalCount = msgFeedbacks.length;
            
            if (totalCount > 0) {
                negativeRateMap.set(msg.id, negativeCount / totalCount);
            }
        }
        
        // 4. ç¯©é¸çœŸæ­£é«˜é¢¨éšªçš„å›ç­”ï¼ˆè² è©•ç‡ > 20% æˆ–ä½ä¿¡å¿ƒåº¦ï¼‰
        const auditList = (highRiskMessages || []).filter(msg => {
            const negativeRate = negativeRateMap.get(msg.id) || 0;
            return negativeRate > 0.2 || (msg.confidence_score || 1) < 0.6;
        });
        
        // 5. ç”Ÿæˆå¯©è¨ˆå ±å‘Š
        const auditReport = {
            period: {
                start: oneMonthAgo.toISOString(),
                end: new Date().toISOString()
            },
            total_messages_scanned: highRiskMessages?.length || 0,
            high_risk_count: auditList.length,
            breakdown: {
                low_confidence: auditList.filter(m => (m.confidence_score || 1) < 0.6).length,
                needs_review: auditList.filter(m => m.needs_review).length,
                high_negative_rate: auditList.filter(m => (negativeRateMap.get(m.id) || 0) > 0.2).length
            },
            high_risk_messages: auditList.map(msg => ({
                id: msg.id,
                content_preview: msg.content.substring(0, 200),
                confidence_score: msg.confidence_score,
                negative_rate: negativeRateMap.get(msg.id) || 0,
                review_triggers: msg.review_triggers || [],
                agent_name: (msg.agents as any)?.name,
                user_name: (msg.chat_sessions as any)?.user_profiles?.display_name,
                created_at: msg.created_at
            }))
        };
        
        // 6. å„²å­˜å¯©è¨ˆå ±å‘Š
        const { data: report } = await supabase
            .from('audit_reports')
            .insert({
                report_type: 'high_risk_responses',
                period_start: oneMonthAgo.toISOString(),
                period_end: new Date().toISOString(),
                report_data: auditReport,
                generated_at: new Date().toISOString()
            })
            .select()
            .single();
        
        // 7. ç™¼é€ Email çµ¦ç®¡ç†å“¡ï¼ˆå¦‚æœè¨­å®šï¼‰
        if (process.env.AUDIT_REPORT_EMAIL) {
            await sendAuditReportEmail(auditReport);
        }
        
        return NextResponse.json({
            success: true,
            report_id: report?.id,
            summary: {
                total_scanned: auditReport.total_messages_scanned,
                high_risk_count: auditReport.high_risk_count
            }
        });
        
    } catch (error) {
        console.error('[Audit] Failed:', error);
        return NextResponse.json(
            { error: 'Audit failed', details: String(error) },
            { status: 500 }
        );
    }
}
```

**è³‡æ–™åº«çµæ§‹**ï¼š

```sql
-- å¯©è¨ˆå ±å‘Šè¡¨
CREATE TABLE IF NOT EXISTS audit_reports (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    report_type VARCHAR(50) NOT NULL, -- 'high_risk_responses', 'user_activity', etc.
    period_start TIMESTAMPTZ NOT NULL,
    period_end TIMESTAMPTZ NOT NULL,
    report_data JSONB NOT NULL,
    generated_at TIMESTAMPTZ DEFAULT NOW(),
    sent_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- å»ºç«‹ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_audit_reports_type_period 
    ON audit_reports(report_type, period_start DESC);
```

**ç®¡ç†å“¡æŸ¥çœ‹å¯©è¨ˆå ±å‘Š**ï¼š

```typescript
// app/api/audit/reports/route.ts

export async function GET(request: NextRequest) {
    const profile = await getCurrentUserProfile();
    requireRole(profile, ['SUPER_ADMIN', 'DEPT_ADMIN']);
    
    const { searchParams } = new URL(request.url);
    const reportType = searchParams.get('type') || 'high_risk_responses';
    const limit = parseInt(searchParams.get('limit') || '10');
    
    const supabase = await createClient();
    
    const { data: reports } = await supabase
        .from('audit_reports')
        .select('*')
        .eq('report_type', reportType)
        .order('generated_at', { ascending: false })
        .limit(limit);
    
    return NextResponse.json({ success: true, reports });
}
```

#### 11.8 è³‡æ–™åº«çµæ§‹ç¸½è¦½

```sql
-- chat_messages è¡¨æ“´å……æ¬„ä½
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS citations JSONB DEFAULT '[]';
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS confidence_score DECIMAL(3,2);
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS confidence_reasoning TEXT;
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS needs_review BOOLEAN DEFAULT FALSE;
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS review_triggers TEXT[];
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS reviewed_at TIMESTAMPTZ;
ALTER TABLE chat_messages ADD COLUMN IF NOT EXISTS reviewed_by UUID REFERENCES user_profiles(id);

-- å¯©è¨ˆå ±å‘Šè¡¨
CREATE TABLE IF NOT EXISTS audit_reports (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    report_type VARCHAR(50) NOT NULL,
    period_start TIMESTAMPTZ NOT NULL,
    period_end TIMESTAMPTZ NOT NULL,
    report_data JSONB NOT NULL,
    generated_at TIMESTAMPTZ DEFAULT NOW(),
    sent_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_chat_messages_citations 
    ON chat_messages USING GIN (citations);
CREATE INDEX IF NOT EXISTS idx_chat_messages_low_confidence 
    ON chat_messages(confidence_score) WHERE confidence_score < 0.6;
CREATE INDEX IF NOT EXISTS idx_chat_messages_needs_review 
    ON chat_messages(needs_review) WHERE needs_review = TRUE;
CREATE INDEX IF NOT EXISTS idx_audit_reports_type_period 
    ON audit_reports(report_type, period_start DESC);
```

#### 11.9 API ç«¯é»è¦åŠƒ

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|-----|-----|-----|
| `/api/chat` | POST | å°è©± APIï¼ˆå·²æ“´å……æ”¯æ´å¼•ç”¨ä¾†æºã€ä¿¡å¿ƒåº¦ï¼‰ |
| `/api/chat/feedback` | POST | è¨˜éŒ„ä½¿ç”¨è€…åé¥‹ï¼ˆå·²å­˜åœ¨ï¼Œéœ€æ•´åˆå­¸ç¿’æ©Ÿåˆ¶ï¼‰ |
| `/api/chat/messages/:id/review` | POST | æ¨™è¨˜è¨Šæ¯ç‚ºå·²è¦†æ ¸ |
| `/api/audit/reports` | GET | å–å¾—å¯©è¨ˆå ±å‘Šåˆ—è¡¨ |
| `/api/audit/reports/:id` | GET | å–å¾—å–®ä¸€å¯©è¨ˆå ±å‘Šè©³æƒ… |
| `/api/cron/audit-high-risk-responses` | GET | å®šæœŸå¯©è¨ˆæ’ç¨‹ï¼ˆCron Jobï¼‰ |

#### 11.10 å¯¦æ–½å„ªå…ˆé †åº

| å„ªå…ˆç´š | åŠŸèƒ½ | é ä¼°æ™‚é–“ | ç‹€æ…‹ |
|--------|------|----------|------|
| P0 | Layer 1: å¼·åˆ¶å¼•ç”¨ä¾†æº | 2-3 å°æ™‚ | å¾…å¯¦ä½œ |
| P0 | Layer 2: ä¿¡å¿ƒåº¦è©•åˆ† | 1-2 å°æ™‚ | å¾…å¯¦ä½œ |
| P0 | Layer 3: äººå·¥è¦†æ ¸æç¤º | 1 å°æ™‚ | å¾…å¯¦ä½œ |
| P1 | Layer 4: ä½¿ç”¨è€…åé¥‹å­¸ç¿’ | 3-4 å°æ™‚ | å¾…å¯¦ä½œ |
| P1 | Layer 5: å®šæœŸäººå·¥å¯©è¨ˆ | 2-3 å°æ™‚ | å¾…å¯¦ä½œ |

**ç¸½é ä¼°æ™‚é–“**ï¼š9-13 å°æ™‚ï¼ˆ1-2 å€‹å·¥ä½œå¤©ï¼‰

---

### 12. AI æ±ºç­–å¯è§£é‡‹æ€§ç³»çµ±ï¼ˆExplainable AI Decision Systemï¼‰

#### 12.1 è¨­è¨ˆç†å¿µ

**æ ¸å¿ƒå•é¡Œ**ï¼šä¼æ¥­ä¸»èˆ‡é«˜éšä¸»ç®¡é¢å° AI Agent çš„æ±ºç­–å»ºè­°æ™‚ï¼Œå¾€å¾€ç¼ºä¹ã€Œå®‰å…¨æ„Ÿã€ï¼Œå› ç‚ºï¼š
1. **é»‘ç›’å­ç–‘æ…®**ï¼šä¸çŸ¥é“ AI å¦‚ä½•å¾—å‡ºé€™å€‹çµè«–
2. **ç„¡æ³•é©—è­‰**ï¼šç„¡æ³•è¿½æº¯æ±ºç­–é‚è¼¯ï¼Œé›£ä»¥åˆ¤æ–·å»ºè­°æ˜¯å¦å¯ä¿¡
3. **ç¼ºä¹ä¿¡å¿ƒ**ï¼šå³ä½¿å»ºè­°å¾ˆå¥½ï¼Œä½†æ²’æœ‰ç†è§£éç¨‹å°±ä¸æ•¢æ¡è¡Œ

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹å®Œæ•´çš„ã€Œæ±ºç­–å¯è§£é‡‹æ€§ç³»çµ±ã€ï¼Œé€éè¦–è¦ºåŒ–å‘ˆç¾ AI çš„æ€è€ƒéç¨‹ï¼Œè®“æ±ºç­–å»ºè­°è®Šå¾—ã€Œé€æ˜ã€å¯è¿½æº¯ã€å¯é©—è­‰ã€ã€‚

#### 12.2 ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      AI æ±ºç­–å¯è§£é‡‹æ€§ç³»çµ± (Explainable AI System)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Layer 1: æ±ºç­–æ¨ç†éˆè¿½è¹¤ (Reasoning Chain Tracking)      â”‚
â”‚  â””â”€ è¨˜éŒ„ AI çš„æ¯ä¸€æ­¥æ€è€ƒéç¨‹                              â”‚
â”‚                                                           â”‚
â”‚  Layer 2: çŸ¥è­˜ä¾†æºè·¯å¾‘åœ– (Knowledge Source Path)         â”‚
â”‚  â””â”€ è¦–è¦ºåŒ–å±•ç¤ºçŸ¥è­˜ä¾†æºèˆ‡å¼•ç”¨é—œä¿‚                          â”‚
â”‚                                                           â”‚
â”‚  Layer 3: ä¿¡å¿ƒåº¦åˆ†è§£ (Confidence Breakdown)             â”‚
â”‚  â””â”€ å±•ç¤ºæ¯å€‹æ±ºç­–é»çš„ä¿¡å¿ƒåº¦èˆ‡ä¾æ“š                          â”‚
â”‚                                                           â”‚
â”‚  Layer 4: å‡è¨­é©—è­‰ (Assumption Validation)              â”‚
â”‚  â””â”€ åˆ—å‡º AI çš„å‡è¨­èˆ‡é©—è­‰æ–¹æ³•                              â”‚
â”‚                                                           â”‚
â”‚  Layer 5: æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒ (Alternative Comparison)         â”‚
â”‚  â””â”€ å±•ç¤ºå…¶ä»–å¯èƒ½çš„æ±ºç­–æ–¹æ¡ˆèˆ‡å„ªåŠ£æ¯”è¼ƒ                       â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 12.3 Layer 1: æ±ºç­–æ¨ç†éˆè¿½è¹¤ï¼ˆReasoning Chain Trackingï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šè¦æ±‚ AI è¼¸å‡ºçµæ§‹åŒ–çš„æ¨ç†éç¨‹ï¼Œä¸¦å„²å­˜ç‚ºå¯è¦–è¦ºåŒ–çš„æ¨ç†éˆã€‚

```typescript
// lib/chat/reasoning-tracker.ts

export interface ReasoningStep {
    step_id: string;
    step_type: 'observation' | 'analysis' | 'inference' | 'conclusion';
    content: string;
    confidence: number;
    knowledge_sources: string[]; // æª”æ¡ˆ ID æˆ–çŸ¥è­˜æ¡†æ¶ ID
    assumptions?: string[];
    next_steps?: string[]; // æŒ‡å‘ä¸‹ä¸€å€‹æ­¥é©Ÿçš„ ID
}

export interface ReasoningChain {
    chain_id: string;
    message_id: string;
    query: string;
    steps: ReasoningStep[];
    final_conclusion: string;
    overall_confidence: number;
    created_at: string;
}

/**
 * è¦æ±‚ AI è¼¸å‡ºçµæ§‹åŒ–æ¨ç†éç¨‹
 */
export async function generateReasoningChain(
    query: string,
    knowledgeContext: string,
    agentPrompt: string
): Promise<ReasoningChain> {
    const reasoningPrompt = `${agentPrompt}

ã€ä½¿ç”¨è€…å•é¡Œã€‘
${query}

ã€å¯ç”¨çŸ¥è­˜åº«ã€‘
${knowledgeContext}

ã€ä»»å‹™è¦æ±‚ã€‘
è«‹ä»¥çµæ§‹åŒ–çš„æ–¹å¼å±•ç¤ºä½ çš„æ€è€ƒéç¨‹ã€‚ä½ å¿…é ˆï¼š
1. é€æ­¥åˆ†æå•é¡Œ
2. å¼•ç”¨å…·é«”çš„çŸ¥è­˜ä¾†æº
3. æ¨™è¨»æ¯å€‹æ­¥é©Ÿçš„ä¿¡å¿ƒåº¦
4. åˆ—å‡ºä½ çš„å‡è¨­
5. æœ€çµ‚çµ¦å‡ºçµè«–

è«‹ä»¥ JSON æ ¼å¼å›è¦†ï¼š
{
  "reasoning_chain": [
    {
      "step_id": "step_1",
      "step_type": "observation",
      "content": "è§€å¯Ÿåˆ°çš„å…·é«”äº‹å¯¦...",
      "confidence": 0.9,
      "knowledge_sources": ["file_id_1", "framework_id_1"],
      "assumptions": []
    },
    {
      "step_id": "step_2",
      "step_type": "analysis",
      "content": "åˆ†æéç¨‹...",
      "confidence": 0.85,
      "knowledge_sources": ["file_id_2"],
      "assumptions": ["å‡è¨­å¸‚å ´è¶¨å‹¢æŒçºŒ"],
      "next_steps": ["step_3"]
    },
    {
      "step_id": "step_3",
      "step_type": "inference",
      "content": "æ¨è«–çµæœ...",
      "confidence": 0.8,
      "knowledge_sources": ["file_id_1", "file_id_2"],
      "assumptions": ["å‡è¨­ä¾›æ‡‰éˆç©©å®š"],
      "next_steps": ["step_4"]
    },
    {
      "step_id": "step_4",
      "step_type": "conclusion",
      "content": "æœ€çµ‚çµè«–èˆ‡å»ºè­°...",
      "confidence": 0.75,
      "knowledge_sources": ["file_id_1", "file_id_2", "file_id_3"],
      "assumptions": []
    }
  ],
  "final_conclusion": "å®Œæ•´çš„çµè«–èˆ‡å»ºè­°",
  "overall_confidence": 0.78,
  "key_assumptions": [
    "å‡è¨­å¸‚å ´è¶¨å‹¢æŒçºŒ",
    "å‡è¨­ä¾›æ‡‰éˆç©©å®š"
  ]
}`;

    const genAI = createGeminiClient();
    const model = genAI.getGenerativeModel({ 
        model: 'gemini-3-pro-preview' // ä½¿ç”¨ Pro æ¨¡å‹ä»¥ç²å¾—æ›´å¥½çš„æ¨ç†èƒ½åŠ›
    });
    
    const result = await model.generateContent(reasoningPrompt);
    const response = await result.response;
    const text = response.text();
    
    // è§£æ JSON
    const jsonMatch = text.match(/\{[\s\S]*\}/);
    if (!jsonMatch) {
        throw new Error('ç„¡æ³•è§£ææ¨ç†éˆ JSON');
    }
    
    const reasoningData = JSON.parse(jsonMatch[0]);
    
    return {
        chain_id: crypto.randomUUID(),
        message_id: '', // ç¨å¾Œå¡«å…¥
        query,
        steps: reasoningData.reasoning_chain,
        final_conclusion: reasoningData.final_conclusion,
        overall_confidence: reasoningData.overall_confidence,
        created_at: new Date().toISOString()
    };
}
```

**API æ•´åˆ**ï¼š

```typescript
// app/api/chat/route.ts

import { generateReasoningChain } from '@/lib/chat/reasoning-tracker';

export async function POST(request: NextRequest) {
    // ... ç¾æœ‰ç¨‹å¼ç¢¼ ...
    
    // åœ¨ç”Ÿæˆå›æ‡‰æ™‚ï¼ŒåŒæ™‚ç”Ÿæˆæ¨ç†éˆ
    const reasoningChain = await generateReasoningChain(
        message,
        knowledgeContext,
        fullSystemPrompt
    );
    
    // å„²å­˜æ¨ç†éˆåˆ°è³‡æ–™åº«
    const { data: savedChain } = await supabase
        .from('reasoning_chains')
        .insert({
            chain_id: reasoningChain.chain_id,
            message_id: aiMessage.id,
            query: message,
            steps: reasoningChain.steps,
            final_conclusion: reasoningChain.final_conclusion,
            overall_confidence: reasoningChain.overall_confidence
        })
        .select()
        .single();
    
    // ç™¼é€æ¨ç†éˆçµ¦å‰ç«¯
    controller.enqueue(encoder.encode(`data: ${JSON.stringify({ 
        reasoning_chain: reasoningChain 
    })}\n\n`));
}
```

#### 12.4 Layer 2: çŸ¥è­˜ä¾†æºè·¯å¾‘åœ–ï¼ˆKnowledge Source Path Visualizationï¼‰

**è¦–è¦ºåŒ–å…ƒä»¶**ï¼šä½¿ç”¨ React Flow ç¹ªè£½çŸ¥è­˜ä¾†æºçš„å¼•ç”¨é—œä¿‚åœ–ã€‚

```typescript
// components/chat/ReasoningChainVisualizer.tsx

'use client';

import ReactFlow, { Node, Edge } from 'reactflow';
import { ReasoningChain } from '@/lib/chat/reasoning-tracker';
import { FileText, Brain, Target, CheckCircle } from 'lucide-react';

interface ReasoningChainVisualizerProps {
    chain: ReasoningChain;
    onStepClick?: (stepId: string) => void;
}

export default function ReasoningChainVisualizer({ 
    chain, 
    onStepClick 
}: ReasoningChainVisualizerProps) {
    // 1. å»ºæ§‹ç¯€é»ï¼ˆæ¯å€‹æ¨ç†æ­¥é©Ÿ + çŸ¥è­˜ä¾†æºï¼‰
    const nodes: Node[] = [];
    const edges: Edge[] = [];
    
    // 2. æ·»åŠ æ¨ç†æ­¥é©Ÿç¯€é»
    chain.steps.forEach((step, index) => {
        const stepNode: Node = {
            id: step.step_id,
            type: 'reasoningStep',
            position: { x: index * 300, y: 0 },
            data: {
                label: step.content.substring(0, 100) + '...',
                stepType: step.step_type,
                confidence: step.confidence,
                stepNumber: index + 1
            },
            style: {
                background: getStepColor(step.step_type),
                color: '#fff',
                border: '2px solid',
                borderColor: getConfidenceColor(step.confidence),
                borderRadius: '12px',
                padding: '16px',
                width: 280,
                minHeight: 120
            }
        };
        nodes.push(stepNode);
        
        // 3. æ·»åŠ çŸ¥è­˜ä¾†æºç¯€é»
        step.knowledge_sources.forEach((sourceId, sourceIndex) => {
            const sourceNodeId = `source_${step.step_id}_${sourceIndex}`;
            const sourceNode: Node = {
                id: sourceNodeId,
                type: 'knowledgeSource',
                position: { 
                    x: index * 300 + (sourceIndex - step.knowledge_sources.length / 2) * 100, 
                    y: 200 
                },
                data: {
                    label: `ä¾†æº ${sourceIndex + 1}`,
                    sourceId
                },
                style: {
                    background: '#1e293b',
                    color: '#94a3b8',
                    border: '1px solid #334155',
                    borderRadius: '8px',
                    padding: '8px',
                    width: 80,
                    height: 60
                }
            };
            nodes.push(sourceNode);
            
            // 4. é€£æ¥æ¨ç†æ­¥é©Ÿèˆ‡çŸ¥è­˜ä¾†æº
            edges.push({
                id: `edge_${step.step_id}_${sourceNodeId}`,
                source: step.step_id,
                target: sourceNodeId,
                type: 'smoothstep',
                animated: true,
                style: { stroke: '#64748b', strokeWidth: 2 }
            });
        });
        
        // 5. é€£æ¥æ¨ç†æ­¥é©Ÿï¼ˆå½¢æˆéˆï¼‰
        if (step.next_steps && step.next_steps.length > 0) {
            step.next_steps.forEach(nextStepId => {
                edges.push({
                    id: `edge_${step.step_id}_${nextStepId}`,
                    source: step.step_id,
                    target: nextStepId,
                    type: 'smoothstep',
                    animated: true,
                    style: { stroke: '#3b82f6', strokeWidth: 3 }
                });
            });
        } else if (index < chain.steps.length - 1) {
            // é è¨­é€£æ¥ä¸‹ä¸€å€‹æ­¥é©Ÿ
            edges.push({
                id: `edge_${step.step_id}_${chain.steps[index + 1].step_id}`,
                source: step.step_id,
                target: chain.steps[index + 1].step_id,
                type: 'smoothstep',
                animated: true,
                style: { stroke: '#3b82f6', strokeWidth: 3 }
            });
        }
    });
    
    // 6. æ·»åŠ æœ€çµ‚çµè«–ç¯€é»
    const conclusionNode: Node = {
        id: 'conclusion',
        type: 'conclusion',
        position: { x: chain.steps.length * 300, y: 0 },
        data: {
            label: chain.final_conclusion,
            confidence: chain.overall_confidence
        },
        style: {
            background: 'linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%)',
            color: '#fff',
            border: '3px solid #a78bfa',
            borderRadius: '16px',
            padding: '20px',
            width: 320,
            minHeight: 150,
            fontSize: '14px',
            fontWeight: '600'
        }
    };
    nodes.push(conclusionNode);
    
    // é€£æ¥æœ€å¾Œä¸€æ­¥åˆ°çµè«–
    if (chain.steps.length > 0) {
        const lastStep = chain.steps[chain.steps.length - 1];
        edges.push({
            id: `edge_${lastStep.step_id}_conclusion`,
            source: lastStep.step_id,
            target: 'conclusion',
            type: 'smoothstep',
            animated: true,
            style: { stroke: '#8b5cf6', strokeWidth: 4 }
        });
    }
    
    return (
        <div className="w-full h-[600px] bg-background-secondary/50 rounded-2xl border border-white/10 p-4">
            <div className="mb-4 flex items-center justify-between">
                <h3 className="text-lg font-bold text-text-primary">
                    AI æ±ºç­–æ¨ç†éç¨‹
                </h3>
                <div className="flex items-center gap-2 text-sm text-text-tertiary">
                    <span>æ•´é«”ä¿¡å¿ƒåº¦ï¼š</span>
                    <span className="font-bold text-primary-400">
                        {Math.round(chain.overall_confidence * 100)}%
                    </span>
                </div>
            </div>
            
            <ReactFlow
                nodes={nodes}
                edges={edges}
                fitView
                fitViewOptions={{ padding: 0.2 }}
                nodeTypes={{
                    reasoningStep: ReasoningStepNode,
                    knowledgeSource: KnowledgeSourceNode,
                    conclusion: ConclusionNode
                }}
            />
        </div>
    );
}

function getStepColor(stepType: string): string {
    const colors = {
        observation: '#06b6d4', // Cyan
        analysis: '#3b82f6',     // Blue
        inference: '#10b981',    // Green
        conclusion: '#8b5cf6'    // Purple
    };
    return colors[stepType as keyof typeof colors] || '#64748b';
}

function getConfidenceColor(confidence: number): string {
    if (confidence >= 0.8) return '#10b981'; // Green
    if (confidence >= 0.6) return '#f59e0b'; // Yellow
    return '#ef4444'; // Red
}
```

#### 12.5 Layer 3: ä¿¡å¿ƒåº¦åˆ†è§£ï¼ˆConfidence Breakdownï¼‰

**è¦–è¦ºåŒ–å…ƒä»¶**ï¼šå±•ç¤ºæ¯å€‹æ±ºç­–é»çš„ä¿¡å¿ƒåº¦èˆ‡ä¾æ“šã€‚

```typescript
// components/chat/ConfidenceBreakdown.tsx

interface ConfidenceBreakdownProps {
    chain: ReasoningChain;
}

export default function ConfidenceBreakdown({ chain }: ConfidenceBreakdownProps) {
    return (
        <div className="space-y-4">
            <h4 className="text-sm font-bold text-text-primary uppercase tracking-wider">
                ä¿¡å¿ƒåº¦åˆ†è§£
            </h4>
            
            {/* æ•´é«”ä¿¡å¿ƒåº¦ */}
            <div className="p-4 bg-white/5 rounded-xl border border-white/10">
                <div className="flex items-center justify-between mb-2">
                    <span className="text-sm text-text-secondary">æ•´é«”ä¿¡å¿ƒåº¦</span>
                    <span className="text-lg font-bold text-primary-400">
                        {Math.round(chain.overall_confidence * 100)}%
                    </span>
                </div>
                <div className="w-full bg-white/5 rounded-full h-2">
                    <div 
                        className="bg-primary-500 h-2 rounded-full transition-all duration-500"
                        style={{ width: `${chain.overall_confidence * 100}%` }}
                    />
                </div>
            </div>
            
            {/* å„æ­¥é©Ÿä¿¡å¿ƒåº¦ */}
            {chain.steps.map((step, index) => (
                <div key={step.step_id} className="p-4 bg-white/5 rounded-xl border border-white/10">
                    <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center gap-2">
                            <span className="text-xs font-bold text-text-tertiary">
                                æ­¥é©Ÿ {index + 1}
                            </span>
                            <span className="text-xs px-2 py-1 bg-primary-500/20 text-primary-400 rounded">
                                {getStepTypeLabel(step.step_type)}
                            </span>
                        </div>
                        <span className="text-sm font-bold text-text-primary">
                            {Math.round(step.confidence * 100)}%
                        </span>
                    </div>
                    
                    <div className="w-full bg-white/5 rounded-full h-1.5 mb-2">
                        <div 
                            className={`h-1.5 rounded-full transition-all duration-500 ${
                                step.confidence >= 0.8 ? 'bg-green-500' :
                                step.confidence >= 0.6 ? 'bg-yellow-500' : 'bg-red-500'
                            }`}
                            style={{ width: `${step.confidence * 100}%` }}
                        />
                    </div>
                    
                    <p className="text-xs text-text-tertiary line-clamp-2">
                        {step.content}
                    </p>
                    
                    {/* çŸ¥è­˜ä¾†æºæ•¸é‡ */}
                    {step.knowledge_sources.length > 0 && (
                        <div className="mt-2 flex items-center gap-1 text-xs text-text-tertiary">
                            <FileText size={12} />
                            <span>{step.knowledge_sources.length} å€‹çŸ¥è­˜ä¾†æº</span>
                        </div>
                    )}
                </div>
            ))}
        </div>
    );
}

function getStepTypeLabel(stepType: string): string {
    const labels = {
        observation: 'è§€å¯Ÿ',
        analysis: 'åˆ†æ',
        inference: 'æ¨è«–',
        conclusion: 'çµè«–'
    };
    return labels[stepType as keyof typeof labels] || stepType;
}
```

#### 12.6 Layer 4: å‡è¨­é©—è­‰ï¼ˆAssumption Validationï¼‰

**è¦–è¦ºåŒ–å…ƒä»¶**ï¼šåˆ—å‡º AI çš„å‡è¨­èˆ‡é©—è­‰æ–¹æ³•ã€‚

```typescript
// components/chat/AssumptionValidator.tsx

interface AssumptionValidatorProps {
    assumptions: string[];
    knowledgeSources: string[];
}

export default function AssumptionValidator({ 
    assumptions, 
    knowledgeSources 
}: AssumptionValidatorProps) {
    return (
        <div className="space-y-4">
            <h4 className="text-sm font-bold text-text-primary uppercase tracking-wider">
                é—œéµå‡è¨­èˆ‡é©—è­‰
            </h4>
            
            {assumptions.map((assumption, index) => (
                <div key={index} className="p-4 bg-white/5 rounded-xl border border-white/10">
                    <div className="flex items-start gap-3">
                        <div className="flex-shrink-0 w-6 h-6 rounded-full bg-yellow-500/20 flex items-center justify-center">
                            <span className="text-xs font-bold text-yellow-400">
                                {index + 1}
                            </span>
                        </div>
                        <div className="flex-1">
                            <p className="text-sm text-text-primary mb-2">
                                {assumption}
                            </p>
                            
                            {/* é©—è­‰ç‹€æ…‹ */}
                            <div className="flex items-center gap-2 text-xs">
                                <span className="px-2 py-1 bg-blue-500/20 text-blue-400 rounded">
                                    å¯é©—è­‰
                                </span>
                                <span className="text-text-tertiary">
                                    åŸºæ–¼ {knowledgeSources.length} å€‹çŸ¥è­˜ä¾†æº
                                </span>
                            </div>
                            
                            {/* é©—è­‰å»ºè­° */}
                            <div className="mt-2 p-2 bg-white/5 rounded text-xs text-text-tertiary">
                                ğŸ’¡ å»ºè­°ï¼šå¯é€éå¯¦éš›æ•¸æ“šæˆ–å¸‚å ´èª¿ç ”é©—è­‰æ­¤å‡è¨­
                            </div>
                        </div>
                    </div>
                </div>
            ))}
        </div>
    );
}
```

#### 12.7 Layer 5: æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒï¼ˆAlternative Comparisonï¼‰

**æŠ€è¡“å¯¦ä½œ**ï¼šè¦æ±‚ AI è¼¸å‡ºå¤šå€‹æ±ºç­–æ–¹æ¡ˆä¸¦æ¯”è¼ƒå„ªåŠ£ã€‚

```typescript
// lib/chat/alternative-generator.ts

export interface AlternativeOption {
    option_id: string;
    title: string;
    description: string;
    pros: string[];
    cons: string[];
    confidence: number;
    risk_level: 'low' | 'medium' | 'high';
    expected_outcome: string;
    required_resources: string[];
}

export interface AlternativeComparison {
    query: string;
    recommended_option: string; // option_id
    alternatives: AlternativeOption[];
    comparison_criteria: string[];
}

/**
 * ç”Ÿæˆæ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒ
 */
export async function generateAlternatives(
    query: string,
    knowledgeContext: string,
    recommendedSolution: string
): Promise<AlternativeComparison> {
    const prompt = `
ä½ æ˜¯ä¸€ä½æˆ°ç•¥é¡§å•ã€‚é‡å°ä»¥ä¸‹å•é¡Œï¼Œè«‹æä¾› 3-4 å€‹ä¸åŒçš„æ±ºç­–æ–¹æ¡ˆï¼Œä¸¦é€²è¡Œå„ªåŠ£æ¯”è¼ƒã€‚

ã€å•é¡Œã€‘
${query}

ã€AI æ¨è–¦æ–¹æ¡ˆã€‘
${recommendedSolution}

ã€å¯ç”¨çŸ¥è­˜åº«ã€‘
${knowledgeContext}

ã€ä»»å‹™è¦æ±‚ã€‘
1. ç”Ÿæˆ 3-4 å€‹å¯è¡Œçš„æ›¿ä»£æ–¹æ¡ˆ
2. æ¯å€‹æ–¹æ¡ˆéœ€åŒ…å«ï¼šå„ªé»ã€ç¼ºé»ã€é¢¨éšªç­‰ç´šã€é æœŸçµæœã€æ‰€éœ€è³‡æº
3. æ¯”è¼ƒå„æ–¹æ¡ˆçš„å„ªåŠ£
4. èªªæ˜ç‚ºä»€éº¼æ¨è–¦æŸå€‹æ–¹æ¡ˆ

è«‹ä»¥ JSON æ ¼å¼å›è¦†ï¼š
{
  "recommended_option": "option_1",
  "alternatives": [
    {
      "option_id": "option_1",
      "title": "æ–¹æ¡ˆä¸€ï¼š...",
      "description": "è©³ç´°æè¿°...",
      "pros": ["å„ªé»1", "å„ªé»2"],
      "cons": ["ç¼ºé»1", "ç¼ºé»2"],
      "confidence": 0.85,
      "risk_level": "medium",
      "expected_outcome": "é æœŸçµæœ...",
      "required_resources": ["è³‡æº1", "è³‡æº2"]
    }
  ],
  "comparison_criteria": ["æˆæœ¬", "æ™‚æ•ˆ", "é¢¨éšª", "æ•ˆç›Š"]
}`;

    // ... å‘¼å« Gemini API ä¸¦è§£æ ...
}
```

**è¦–è¦ºåŒ–å…ƒä»¶**ï¼š

```typescript
// components/chat/AlternativeComparison.tsx

export default function AlternativeComparison({ 
    comparison 
}: { comparison: AlternativeComparison }) {
    return (
        <div className="space-y-4">
            <h4 className="text-sm font-bold text-text-primary uppercase tracking-wider">
                æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒ
            </h4>
            
            {/* æ¯”è¼ƒè¡¨æ ¼ */}
            <div className="overflow-x-auto">
                <table className="w-full border-collapse">
                    <thead>
                        <tr className="border-b border-white/10">
                            <th className="text-left p-3 text-xs font-bold text-text-tertiary">
                                æ–¹æ¡ˆ
                            </th>
                            {comparison.comparison_criteria.map(criterion => (
                                <th key={criterion} className="text-center p-3 text-xs font-bold text-text-tertiary">
                                    {criterion}
                                </th>
                            ))}
                            <th className="text-center p-3 text-xs font-bold text-text-tertiary">
                                æ¨è–¦åº¦
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {comparison.alternatives.map((option, index) => (
                            <tr 
                                key={option.option_id}
                                className={`border-b border-white/5 ${
                                    option.option_id === comparison.recommended_option 
                                        ? 'bg-primary-500/10' 
                                        : ''
                                }`}
                            >
                                <td className="p-3">
                                    <div className="flex items-center gap-2">
                                        {option.option_id === comparison.recommended_option && (
                                            <CheckCircle size={16} className="text-primary-400" />
                                        )}
                                        <span className="text-sm text-text-primary font-semibold">
                                            {option.title}
                                        </span>
                                    </div>
                                </td>
                                {/* å„é …è©•åˆ† */}
                                <td className="p-3 text-center">
                                    <span className="text-xs text-text-secondary">
                                        {option.risk_level === 'low' ? 'ä½' : 
                                         option.risk_level === 'medium' ? 'ä¸­' : 'é«˜'}
                                    </span>
                                </td>
                                <td className="p-3 text-center">
                                    <span className="text-xs text-text-secondary">
                                        {Math.round(option.confidence * 100)}%
                                    </span>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        </div>
    );
}
```

#### 12.8 æ•´åˆ UIï¼šæ±ºç­–å¯è§£é‡‹æ€§é¢æ¿

**å®Œæ•´æ•´åˆå…ƒä»¶**ï¼š

```typescript
// components/chat/DecisionExplainabilityPanel.tsx

'use client';

import { useState } from 'react';
import { ChevronDown, ChevronUp, Eye, Brain, Target } from 'lucide-react';
import ReasoningChainVisualizer from './ReasoningChainVisualizer';
import ConfidenceBreakdown from './ConfidenceBreakdown';
import AssumptionValidator from './AssumptionValidator';
import AlternativeComparison from './AlternativeComparison';
import { ReasoningChain } from '@/lib/chat/reasoning-tracker';

interface DecisionExplainabilityPanelProps {
    messageId: string;
    chain: ReasoningChain;
    alternatives?: any;
}

export default function DecisionExplainabilityPanel({
    messageId,
    chain,
    alternatives
}: DecisionExplainabilityPanelProps) {
    const [isExpanded, setIsExpanded] = useState(false);
    const [activeTab, setActiveTab] = useState<'reasoning' | 'confidence' | 'assumptions' | 'alternatives'>('reasoning');
    
    return (
        <div className="mt-6 border-t border-white/10 pt-6">
            <button
                onClick={() => setIsExpanded(!isExpanded)}
                className="w-full flex items-center justify-between p-4 bg-white/5 rounded-xl hover:bg-white/10 transition-all"
            >
                <div className="flex items-center gap-3">
                    <Brain size={20} className="text-primary-400" />
                    <span className="text-sm font-bold text-text-primary">
                        æŸ¥çœ‹ AI æ±ºç­–éç¨‹
                    </span>
                </div>
                {isExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
            </button>
            
            {isExpanded && (
                <div className="mt-4 space-y-4">
                    {/* æ¨™ç±¤é  */}
                    <div className="flex gap-2 border-b border-white/10">
                        {[
                            { id: 'reasoning', label: 'æ¨ç†éˆ', icon: Brain },
                            { id: 'confidence', label: 'ä¿¡å¿ƒåº¦', icon: Target },
                            { id: 'assumptions', label: 'å‡è¨­', icon: Eye },
                            { id: 'alternatives', label: 'æ›¿ä»£æ–¹æ¡ˆ', icon: Target }
                        ].map(tab => (
                            <button
                                key={tab.id}
                                onClick={() => setActiveTab(tab.id as any)}
                                className={`px-4 py-2 text-sm font-semibold border-b-2 transition-all ${
                                    activeTab === tab.id
                                        ? 'border-primary-400 text-primary-400'
                                        : 'border-transparent text-text-tertiary hover:text-text-secondary'
                                }`}
                            >
                                <tab.icon size={16} className="inline mr-2" />
                                {tab.label}
                            </button>
                        ))}
                    </div>
                    
                    {/* å…§å®¹å€åŸŸ */}
                    <div className="min-h-[400px]">
                        {activeTab === 'reasoning' && (
                            <ReasoningChainVisualizer chain={chain} />
                        )}
                        {activeTab === 'confidence' && (
                            <ConfidenceBreakdown chain={chain} />
                        )}
                        {activeTab === 'assumptions' && (
                            <AssumptionValidator 
                                assumptions={chain.steps.flatMap(s => s.assumptions || [])}
                                knowledgeSources={chain.steps.flatMap(s => s.knowledge_sources)}
                            />
                        )}
                        {activeTab === 'alternatives' && alternatives && (
                            <AlternativeComparison comparison={alternatives} />
                        )}
                    </div>
                </div>
            )}
        </div>
    );
}
```

#### 12.9 è³‡æ–™åº«çµæ§‹

```sql
-- æ¨ç†éˆè¡¨
CREATE TABLE IF NOT EXISTS reasoning_chains (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    chain_id VARCHAR(255) UNIQUE NOT NULL,
    message_id UUID REFERENCES chat_messages(id) ON DELETE CASCADE,
    query TEXT NOT NULL,
    steps JSONB NOT NULL, -- ReasoningStep[]
    final_conclusion TEXT NOT NULL,
    overall_confidence DECIMAL(3,2) NOT NULL,
    key_assumptions TEXT[],
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒè¡¨
CREATE TABLE IF NOT EXISTS alternative_comparisons (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    message_id UUID REFERENCES chat_messages(id) ON DELETE CASCADE,
    query TEXT NOT NULL,
    recommended_option_id VARCHAR(255) NOT NULL,
    alternatives JSONB NOT NULL, -- AlternativeOption[]
    comparison_criteria TEXT[] NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_reasoning_chains_message_id 
    ON reasoning_chains(message_id);
CREATE INDEX IF NOT EXISTS idx_alternative_comparisons_message_id 
    ON alternative_comparisons(message_id);
```

#### 12.10 API ç«¯é»è¦åŠƒ

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|-----|-----|-----|
| `/api/chat` | POST | å°è©± APIï¼ˆå·²æ“´å……æ”¯æ´æ¨ç†éˆï¼‰ |
| `/api/chat/messages/:id/reasoning` | GET | å–å¾—è¨Šæ¯çš„æ¨ç†éˆ |
| `/api/chat/messages/:id/alternatives` | GET | å–å¾—è¨Šæ¯çš„æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒ |
| `/api/chat/explain` | POST | æ‰‹å‹•è§¸ç™¼æ±ºç­–è§£é‡‹ï¼ˆé‡å°å·²å­˜åœ¨çš„è¨Šæ¯ï¼‰ |

#### 12.11 å¯¦æ–½å„ªå…ˆé †åº

| å„ªå…ˆç´š | åŠŸèƒ½ | é ä¼°æ™‚é–“ | ç‹€æ…‹ |
|--------|------|----------|------|
| P0 | Layer 1: æ±ºç­–æ¨ç†éˆè¿½è¹¤ | 4-6 å°æ™‚ | å¾…å¯¦ä½œ |
| P0 | Layer 2: çŸ¥è­˜ä¾†æºè·¯å¾‘åœ– | 3-4 å°æ™‚ | å¾…å¯¦ä½œ |
| P1 | Layer 3: ä¿¡å¿ƒåº¦åˆ†è§£ | 2 å°æ™‚ | å¾…å¯¦ä½œ |
| P1 | Layer 4: å‡è¨­é©—è­‰ | 2 å°æ™‚ | å¾…å¯¦ä½œ |
| P2 | Layer 5: æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒ | 3-4 å°æ™‚ | å¾…å¯¦ä½œ |

**ç¸½é ä¼°æ™‚é–“**ï¼š14-18 å°æ™‚ï¼ˆ2-3 å€‹å·¥ä½œå¤©ï¼‰

#### 12.12 ä½¿ç”¨å ´æ™¯ç¯„ä¾‹

**å ´æ™¯ï¼šä¼æ¥­ä¸»è©¢å•ã€Œæ˜¯å¦æ‡‰è©²æ“´å±•æ–°å¸‚å ´ï¼Ÿã€**

1. **AI å›ç­”**ï¼šã€Œå»ºè­°å…ˆé€²è¡Œå°è¦æ¨¡æ¸¬è©¦ï¼ŒåŸå› å¦‚ä¸‹...ã€

2. **é»æ“Šã€ŒæŸ¥çœ‹ AI æ±ºç­–éç¨‹ã€**ï¼Œå±•é–‹é¢æ¿ï¼š

   - **æ¨ç†éˆæ¨™ç±¤**ï¼šé¡¯ç¤º 5 å€‹æ¨ç†æ­¥é©Ÿ
     - æ­¥é©Ÿ 1ï¼ˆè§€å¯Ÿï¼‰ï¼šç•¶å‰å¸‚å ´é£½å’Œåº¦ 85%
     - æ­¥é©Ÿ 2ï¼ˆåˆ†æï¼‰ï¼šç«¶çˆ­å°æ‰‹å‹•æ…‹
     - æ­¥é©Ÿ 3ï¼ˆæ¨è«–ï¼‰ï¼šæ–°å¸‚å ´æ©Ÿæœƒè©•ä¼°
     - æ­¥é©Ÿ 4ï¼ˆçµè«–ï¼‰ï¼šå»ºè­°å°è¦æ¨¡æ¸¬è©¦
   
   - **ä¿¡å¿ƒåº¦æ¨™ç±¤**ï¼šæ•´é«”ä¿¡å¿ƒåº¦ 78%
     - æ­¥é©Ÿ 1ï¼š90%ï¼ˆæ•¸æ“šå……åˆ†ï¼‰
     - æ­¥é©Ÿ 2ï¼š85%ï¼ˆæœ‰ç«¶çˆ­æƒ…å ±ï¼‰
     - æ­¥é©Ÿ 3ï¼š70%ï¼ˆéƒ¨åˆ†å‡è¨­ï¼‰
     - æ­¥é©Ÿ 4ï¼š75%ï¼ˆç¶œåˆè©•ä¼°ï¼‰
   
   - **å‡è¨­æ¨™ç±¤**ï¼š
     - å‡è¨­ 1ï¼šå¸‚å ´è¶¨å‹¢æŒçºŒï¼ˆå¯é©—è­‰ï¼‰
     - å‡è¨­ 2ï¼šç«¶çˆ­å°æ‰‹ä¸æœƒç«‹å³åæ‡‰ï¼ˆéœ€ç›£æ§ï¼‰
   
   - **æ›¿ä»£æ–¹æ¡ˆæ¨™ç±¤**ï¼š
     - æ–¹æ¡ˆ Aï¼šå°è¦æ¨¡æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰âœ“
     - æ–¹æ¡ˆ Bï¼šç›´æ¥å¤§è¦æ¨¡é€²å…¥ï¼ˆé«˜é¢¨éšªï¼‰
     - æ–¹æ¡ˆ Cï¼šæš«ç·©æ“´å±•ï¼ˆä¿å®ˆï¼‰

3. **ä¼æ¥­ä¸»å¯ä»¥**ï¼š
   - æŸ¥çœ‹æ¯å€‹æ¨ç†æ­¥é©Ÿçš„ä¾æ“š
   - é©—è­‰ AI çš„å‡è¨­æ˜¯å¦åˆç†
   - æ¯”è¼ƒä¸åŒæ–¹æ¡ˆçš„å„ªåŠ£
   - æ±ºå®šæ˜¯å¦æ¡è¡Œå»ºè­°

---

## ğŸš€ å¯¦æ–½è·¯ç·šåœ–

### Phase 1-3: åŸºç¤å»ºè¨­ï¼ˆå·²å®Œæˆ âœ…ï¼‰

- âœ… å¯¦ä½œå¤šç¶­åº¦çŸ¥è­˜ç´¢å¼•ç³»çµ±
- âœ… å¯¦ä½œ Agent çŸ¥è­˜è·¯ç”±ç³»çµ±
- âœ… å¯¦ä½œèªç¾©çŸ¥è­˜åœ–è­œ

### Phase 4: v3.0 é€²éšå­ç³»çµ±ï¼ˆè¦åŠƒä¸­ ğŸ“‹ï¼‰

#### Phase 4.1: çŸ¥è­˜æ™‚æ•ˆæ€§ç®¡ç†ï¼ˆé è¨ˆ 2-3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | çŸ¥è­˜è¡°æ¸›æ¨¡å‹ | ä¾çŸ¥è­˜é¡å‹è¨ˆç®—ä¿é®®æœŸ | 3 å¤© |
| P0 | è¡°æ¸›é¡å‹è‡ªå‹•æ¨æ–· | AI åˆ†ææ–‡ä»¶é¡å‹ | 2 å¤© |
| P1 | è¡°æ¸›ç‹€æ…‹è¦–è¦ºåŒ– | åœ¨æ–‡ä»¶åˆ—è¡¨é¡¯ç¤ºè¡°æ¸›ç‹€æ…‹ | 2 å¤© |
| P1 | éæœŸé è­¦å„€è¡¨æ¿ | é›†ä¸­é¡¯ç¤ºå³å°‡éæœŸçŸ¥è­˜ | 3 å¤© |

#### Phase 4.2: åé¥‹å­¸ç¿’ç³»çµ±ï¼ˆé è¨ˆ 3-4 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | é¡¯æ€§åé¥‹æ”¶é›† | ä½¿ç”¨è€…æŒ‰è®š/å€’è®š UI | 2 å¤© |
| P0 | åé¥‹è¨˜éŒ„èˆ‡çµ±è¨ˆ | è³‡æ–™åº«èˆ‡ API | 3 å¤© |
| P1 | éš±æ€§åé¥‹åˆ†æ | è¡Œç‚ºæ¨¡å¼æ¨æ–·æ»¿æ„åº¦ | 5 å¤© |
| P1 | å­¸ç¿’å¼•æ“ | å¾åé¥‹èª¿æ•´å“è³ªè©•åˆ† | 5 å¤© |

#### Phase 4.3: çŸ¥è­˜èšåˆç³»çµ±ï¼ˆé è¨ˆ 3-4 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | æ¦‚å¿µæå– | å¾æ–‡ä»¶æå–æ ¸å¿ƒæ¦‚å¿µ | 3 å¤© |
| P0 | èšåˆå€™é¸ç™¼ç¾ | æ‰¾å‡ºå¯æ•´åˆçš„æ–‡ä»¶ç¾¤ | 3 å¤© |
| P1 | çŸ¥è­˜åˆæˆå¼•æ“ | AI æ•´åˆå¤šä»½æ–‡ä»¶ | 5 å¤© |
| P1 | è¡çªåµæ¸¬ | æ‰¾å‡ºçŸ¥è­˜çŸ›ç›¾ | 3 å¤© |

#### Phase 4.4: æ•ˆèƒ½å„ªåŒ–ï¼ˆé è¨ˆ 1-2 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | HNSW ç´¢å¼•å»ºç«‹ | pgvector å‘é‡ç´¢å¼• | 1 å¤© |
| P0 | èªç¾©æœå°‹ RPC | å„ªåŒ–æœå°‹å‡½æ•¸ | 2 å¤© |
| P1 | æ‰¹é‡ç›¸ä¼¼åº¦è¨ˆç®— | ç”¨æ–¼åœ–è­œå»ºæ§‹ | 2 å¤© |

#### Phase 4.5: ä¸»å‹•æ¨é€ç³»çµ±ï¼ˆé è¨ˆ 2-3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | é€šçŸ¥è³‡æ–™æ¨¡å‹ | è³‡æ–™åº«çµæ§‹ | 1 å¤© |
| P0 | çŸ¥è­˜æ›´æ–°è§¸ç™¼å™¨ | è®Šæ›´è‡ªå‹•é€šçŸ¥ | 2 å¤© |
| P1 | é€šçŸ¥ä¸­å¿ƒ UI | ä½¿ç”¨è€…é€šçŸ¥ä»‹é¢ | 4 å¤© |

---


#### Phase 5: UX/UI Evolution (Galaxy 2.0)ï¼ˆè¦åŠƒä¸­ ğŸ“‹ï¼‰

#### 5.0 å…¨åŸŸä½ˆå±€è§£æ”¾ï¼šå…¨å¯¬ç•«å¸ƒ (Full-Width Canvas)

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰çš„ä»‹é¢å—é™æ–¼ä¸­é–“çª„ç‰ˆå®¹å™¨ (Centered Container)ï¼Œå°è‡´ã€Œæˆ°æƒ…ä¸­å¿ƒã€èˆ‡ã€Œæ˜Ÿç³»å¼•åŠ›æ¨¡å‹ã€ç¼ºä¹è¶³å¤ çš„å±•ç¤ºç©ºé–“ï¼Œè¦–è¦ºä¸Šä¸å¤ éœ‡æ’¼ï¼Œæ“ä½œä¹Ÿé¡¯å¾—ä¾·ä¿ƒã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ‰“ç ´å‚³çµ±ç¶²é çš„å…©å´ç•™ç™½ï¼Œæ¡ç”¨å…¨è¢å¹•å¯¬åº¦è¨­è¨ˆã€‚
- **å…¨åŸŸæ»¿ç‰ˆ**ï¼šå°‡é ‚éƒ¨å°èˆªåˆ— (Navbar) èˆ‡ä¸»è¦å…§å®¹å€æ“´å±•è‡³è¦–çª—é‚Šç·£ (100% Viewport Width)ã€‚
- **æ²‰æµ¸å¼é«”é©—**ï¼šè®“æ·±è‰²æ˜Ÿç³»èƒŒæ™¯å»¶ä¼¸è‡³æ•´å€‹ç•«é¢ï¼Œå‰µé€ ç„¡é‚Šéš›çš„å®‡å®™æ„Ÿã€‚
- **å½ˆæ€§ç©ºé–“**ï¼šç‚ºå·¦å´æ§åˆ¶é¢æ¿æä¾›æ›´å¯¬è£•çš„æ“ä½œå€ï¼Œå³å´åœ–è­œå‰‡æ“æœ‰å½±é™¢ç´šçš„è¦–è¦ºå¼µåŠ›ã€‚


#### 5.1 æ ¸å¿ƒä»‹é¢é‡æ§‹ï¼šæˆ°æƒ…ä¸­å¿ƒ (Control Center)

**æ ¸å¿ƒå•é¡Œ**ï¼šç´”åœ–å½¢ä»‹é¢åœ¨å¤§é‡æ–‡ä»¶æª¢ç´¢æ™‚æ•ˆç‡ä½è½ï¼Œæ“ä½œé«”é©—ï¼ˆç¸®æ”¾/å¹³ç§»ï¼‰ä¸ä½³ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šæ¡ç”¨ã€Œé›™å…¨ä»‹é¢ã€ï¼Œçµåˆå‚³çµ±åˆ—è¡¨çš„é«˜æ•ˆèˆ‡åœ–è­œçš„æ´å¯Ÿã€‚

- **å·¦å´ï¼šæ§åˆ¶é¢æ¿ (30% å¯¬åº¦)**
  - é«˜æ•ˆåˆ—è¡¨è¦–åœ–ï¼šæ”¯æ´å¿«é€Ÿç¯©é¸ã€æœå°‹ã€æ’åºã€‚
  - å°ç„¦äº’å‹• (Focus Interaction)ï¼šé»æ“Šåˆ—è¡¨é …ç›®ï¼Œå³å´åœ–è­œè‡ªå‹•é£›è¡Œå°ç„¦ã€‚
- **å³å´ï¼šæ˜Ÿç³»è¦–åœ– (70% å¯¬åº¦)**
  - è¦–è¦ºåŒ–é—œè¯ï¼šå±•ç¤ºè¢«é¸ä¸­é …ç›®çš„å‘¨é‚ŠçŸ¥è­˜ã€‚
  - æ‡¸æµ®è³‡è¨Šå¡ (Floating Details)ï¼šæ»‘é¼ æ‡¸åœé¡¯ç¤ºæ‘˜è¦èˆ‡é—œéµæ•¸æ“šã€‚

#### 5.2 è¦–è¦ºæ¼”ç®—æ³•å‡ç´šï¼šå¼•åŠ›æ˜Ÿç³»æ¨¡å‹ (Force-Directed Galaxy)

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰çš„é¡ç¥ç¶“ç¶²çµ¡ä½ˆå±€ï¼ˆåˆ†å±¤å‚ç›´æ’åˆ—ï¼‰åœ¨ç¯€é»å¢å¤šæ™‚æœƒå½¢æˆç„¡é™å‚ç›´å»¶ä¼¸çš„ã€Œæ‘©å¤©å¤§æ¨“ã€ï¼Œé›£ä»¥ç€è¦½ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå°å…¥ D3-Force æˆ–å„å‘ç•°æ€§åŠ›å°å‘æ¼”ç®—æ³• (Force-Directed)ã€‚

- **æ˜Ÿç³»å¼•åŠ›**ï¼šç›¸é—œè¯çš„çŸ¥è­˜ç¯€é»ï¼ˆå¦‚åŒä¸€å“ç‰Œã€åŒä¸€ä¸»é¡Œï¼‰å› å¼•åŠ›è‡ªå‹•èšé›†æˆåœ˜ (Cluster)ã€‚
- **èªç¾©äº’æ–¥**ï¼šä¸ç›¸é—œçš„çŸ¥è­˜ç¾¤é«”ï¼ˆå¦‚ä¸åŒå“ç‰Œï¼‰å› æ–¥åŠ›è‡ªå‹•ç–é›¢ï¼Œå½¢æˆå¤šæ˜Ÿç³»åˆ†ä½ˆã€‚
- **ç©ºé–“åˆ©ç”¨**ï¼šè‡ªå‹•åˆ©ç”¨ 3D/2D å…¨ç•«å¸ƒç©ºé–“ï¼Œé¿å…å–®ä¸€è»¸å‘éåº¦å»¶ä¼¸ã€‚

#### 5.3 DIKW å®Œæ•´å±¤ç´šè¦–è¦ºåŒ–

**æ ¸å¿ƒå•é¡Œ**ï¼šç›®å‰è¦–è¦ºä¸Šåƒ…æœ‰ Data (è—) èˆ‡ Knowledge (ç¶ )ï¼Œç¼ºä¹ Information èˆ‡ Wisdom å±¤ç´šã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šè£œå…¨å››å±¤ç´šå®šç¾©èˆ‡è¦–è¦ºå¯¦ä½œã€‚

| å±¤ç´š | é¡è‰² | å®šç¾© | å¯¦é«”ç¯„ä¾‹ |
|-----|-----|-----|---------|
| **Data** | ğŸ”µ è—è‰² | åŸå§‹æ–‡ä»¶ | ä¸Šå‚³çš„ PDF/Markdown æ–‡ä»¶ |
| **Information** | ğŸ’  é’è‰² | çµæ§‹åŒ–äº‹å¯¦ | è‡ªå‹•èƒå–çš„å¯¦é«” (Entity)ã€é—œéµå­—ç¯€é» |
| **Knowledge** | ğŸŸ¢ ç¶ è‰² | çµæ§‹åŒ–æ¡†æ¶ | åƒ¹å€¼ä¸»å¼µç•«å¸ƒã€SWOT åˆ†æã€çŸ¥è­˜åœ–è­œé—œè¯ |
| **Wisdom** | ğŸŸ£ ç´«è‰² | æ±ºç­–/æˆ°ç•¥ | Agent ç”¢å‡ºçš„ Artifacts (å¦‚æˆ°ç•¥è¦åŠƒæ›¸)ã€æ±ºç­–å»ºè­° |

**å¯¦ä½œè·¯å¾‘**ï¼š
1. **Information å±¤**ï¼šå•Ÿå‹• NLP Named Entity Recognition (NER)ï¼Œå¾ Markdown ä¸­æŠ½å–å‡ºé—œéµå¯¦é«”ä½œç‚ºç¨ç«‹ç¯€é»ã€‚
2. **Wisdom å±¤**ï¼šå°‡ Agent çš„è¼¸å‡º (Artifacts) è¦–ç‚ºç¨ç«‹ç¯€é»ï¼Œé€£çµå…¶åƒè€ƒçš„ Knowledge ç¯€é»ï¼Œå½¢æˆæ±ºç­–æ”¯æ’éˆã€‚

---

## ğŸ–ï¸ Phase 6: ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Executive Command Center)

### æ ¸å¿ƒåƒ¹å€¼å®šä½ï¼šå¾ã€Œè¢«å‹•å„€è¡¨æ¿ã€é€²åŒ–ç‚ºã€Œä¸»å‹•æ™ºæ…§ä¸­æ¨ã€

**æ ¸å¿ƒç†å¿µ**ï¼šæ‹’çµ•ã€Œåœ–è¡¨å¢“åœ°ã€ (Dashboard Graveyard)ã€‚
å‚³çµ±æˆ°æƒ…å®¤å¾€å¾€å †ç Œå¤§é‡æ•¸æ“šèˆ‡åœ–è¡¨ï¼Œå°è‡´è³‡è¨Šéè¼‰ä¸”è¢«å¿½ç•¥ã€‚
æ–°å‹æ…‹çš„æˆ°æƒ…ä¸­æ¨å¿…é ˆå…·å‚™ **Agentic Workflow** çš„ç‰¹è³ªï¼Œå¼·èª¿ **ã€ŒAI ä¸»å‹•ç™¼ç¾ã€** èˆ‡ **ã€Œå°è©±å¼æ¢æŸ¥ã€**ã€‚

#### ç³»çµ±å®šä½å°æ¯”

| ç¶­åº¦ | å‚³çµ±å„€è¡¨æ¿ (Passive) | ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Agentic) |
|-----|-------------------|----------------------|
| **æ ¸å¿ƒåƒ¹å€¼** | å‘ˆç¾æ•¸æ“š (Data Presentation) | **ä¸»å‹•æ´å¯Ÿ (Active Insight)** |
| **è§¸ç™¼æ¨¡å¼** | åç­‰è€é—†æŸ¥çœ‹ | **AI ä¸»å‹•æ¨æ’­ç•°å¸¸èˆ‡æ©Ÿæœƒ** |
| **äº’å‹•æ·±åº¦** | åªèƒ½çœ‹ï¼Œä¸èƒ½å• | **åœ–è¡¨å³å…¥å£ï¼Œé»æ“Šå³å°è©±** |
| **è³‡æ–™ä¾†æº** | å¿…é ˆæ˜¯å®Œç¾çµæ§‹åŒ–æ•¸æ“š | **å®¹ç´é›œäº‚æ–‡ä»¶ (CSV/PDF)ï¼ŒAI è‡ªå‹•èª¿å’Œ** |
| **æ±ºç­–é‚è¼¯** | äººæ‰¾å•é¡Œ -> äººæ‰¾ç­”æ¡ˆ | **AI æ‰¾å•é¡Œ -> äººèˆ‡ AI å…±å‰µç­”æ¡ˆ** |

---

### 6.1 ç³»çµ±æ¶æ§‹è¨­è¨ˆ

#### 6.1.1 ä¸‰å±¤æ™ºæ…§æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ğŸ–ï¸ ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Executive Command Center)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚  â”ƒ  Layer 1: ä¸»å‹•æ…‹å‹¢æ„ŸçŸ¥ (Active Situational Awareness)    â”ƒ  â”‚
â”‚  â”ƒ  ä¸åªæ˜¯ KPI å¡ç‰‡ï¼Œè€Œæ˜¯ã€Œç•°å¸¸ã€èˆ‡ã€Œæ©Ÿæœƒã€çš„æ¨æ’­æµ             â”ƒ  â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¯ æˆ°ç•¥   â”‚ ğŸ“Š ç‡Ÿé‹   â”‚ ğŸ’° è²¡å‹™   â”‚ âš ï¸ é¢¨éšª   â”‚ ğŸŒ æƒ…è³‡   â”‚  â”‚
â”‚  â”‚ "è½å¾Œ5%!" â”‚ "ç•°å¸¸æ´»èº" â”‚ "æ¯›åˆ©ä¸‹æ»‘" â”‚ "åˆè¦è­¦å‘Š" â”‚ "å°æ‰‹é™åƒ¹" â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚  â”ƒ  Layer 2: å°è©±å¼éƒ¨é–€æƒ…å ± (Conversational Intelligence)   â”ƒ  â”‚
â”‚  â”ƒ  è‡ªå‹•åŒæ­¥æ–‡ä»¶æ‘˜è¦ + é»æ“Šå³å•Ÿå‹•æ·±åº¦å°è©±                      â”ƒ  â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ’¼ æ¥­å‹™éƒ¨       â”‚ ğŸ­ ç”Ÿç”¢éƒ¨       â”‚ ğŸ’» ç ”ç™¼éƒ¨       â”‚      â”‚
â”‚  â”‚ [AI æ‘˜è¦ä¸²æµ]   â”‚ [AI æ‘˜è¦ä¸²æµ]   â”‚ [AI æ‘˜è¦ä¸²æµ]   â”‚      â”‚
â”‚  â”‚ â€¢ Q1å ±è¡¨(å·²è®€)  â”‚ â€¢ ç”¢ç·šäº‹æ•…å ±å‘Š   â”‚ â€¢ æŠ€è¡“è©•ä¼°æ–‡ä»¶   â”‚      â”‚
â”‚  â”‚ [ğŸ’¬ è©¢å•ç´°ç¯€]   â”‚ [ğŸ’¬ è©¢å•ç´°ç¯€]   â”‚ [ğŸ’¬ è©¢å•ç´°ç¯€]   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                               â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
â”‚  â”ƒ  Layer 3: æˆ°ç•¥é åˆ¤èˆ‡é€£çµ (Strategic Foresight)           â”ƒ  â”‚
â”‚  â”ƒ  è·¨éƒ¨é–€çŸ¥è­˜é€£çµ + æ¨¡æ“¬æ¨æ¼” + æ±ºç­–å»ºè­°                      â”ƒ  â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– AI æˆ°ç•¥é åˆ¤ (Proactive Alerts)                      â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚
â”‚  â”‚ ğŸ”´ [ç•°å¸¸] è²¡å‹™éƒ¨ã€Œæˆæœ¬ä¸Šå‡ã€ èˆ‡ æ¡è³¼éƒ¨ã€Œä¾›æ‡‰å•†æ¼²åƒ¹ã€é«˜åº¦ç›¸é—œ   â”‚
â”‚  â”‚     â†’ å»ºè­°ç«‹å³å•Ÿå‹•ä¾›æ‡‰éˆè­°åƒ¹æœƒè­°                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.1.2 é—œéµæ ¸å¿ƒï¼šæ•¸æ“šèª¿å’Œèˆ‡æƒ…å ±å±¤ (Data Harmonization & Intelligence Layer)

**æ ¸å¿ƒå•é¡Œ**ï¼š
1.  **è³‡æ–™æ ¼å¼æ··äº‚**ï¼šè²¡å‹™éƒ¨ä¸Šå‚³çš„ CSV æ ¼å¼æ¯æœˆéƒ½è®Šï¼Œç›´æ¥ç•«åœ–æœƒå´©æ½°ã€‚
2.  **ç¼ºä¹è§€é»**ï¼šåªå­˜æ•¸æ“šæ²’ç”¨ï¼Œé‡é»æ˜¯ã€Œé€™ä»£è¡¨ä»€éº¼ï¼Ÿã€ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šåœ¨æ–‡ä»¶èˆ‡æˆ°æƒ…å®¤ä¹‹é–“ï¼Œå»ºç«‹**ã€Œæ™ºæ…§ä¸­ä»‹å±¤ã€**ã€‚

1.  **Metric Store (æŒ‡æ¨™å„²å­˜åº«)** - è™•ç†ã€Œç¡¬æ•¸æ“šã€
    *   **AI ETL**ï¼šç•¶æª”æ¡ˆ (CSV/Excel/PDF) ä¸Šå‚³ï¼ŒAI è‡ªå‹•è¾¨è­˜ä¸¦æ“·å–é—œéµæŒ‡æ¨™ (Key Metrics)ã€‚
    *   **æ¨™æº–åŒ–**ï¼šå°‡ `Total Sales`, `Revenue`, `ç‡Ÿæ¥­é¡` çµ±ä¸€æ˜ å°„ç‚º `metric:revenue`ã€‚
    *   **è¡çªè§£æ±º**ï¼šæ¡ `Latest File Wins` æˆ– `Confidence Check` æ©Ÿåˆ¶ï¼Œç¢ºä¿æˆ°æƒ…å®¤æ•¸æ“šæºå–®ä¸€ä¸”ä¹¾æ·¨ã€‚

2.  **Insight Store (æ´å¯Ÿå„²å­˜åº«)** - è™•ç†ã€Œè»Ÿæƒ…å ±ã€
    *   **æ‘˜è¦åŒæ­¥**ï¼šç•¶æ–‡ä»¶è¢« AI è§£è®€åˆ†é¡å¾Œï¼Œå…¶ã€Œæ‘˜è¦ (Summary)ã€èˆ‡ã€Œé—œéµç™¼ç¾ (Findings)ã€è‡ªå‹•åŒæ­¥è‡³æˆ°æƒ…å®¤ã€‚
    *   **ä¸»å‹•æ¨é€**ï¼šè‹¥æ‘˜è¦ä¸­åŒ…å«ã€Œé¢¨éšªã€ã€ã€Œå»¶é²ã€ã€ã€Œè™§æã€ç­‰é—œéµå­—ï¼Œæå‡å„ªå…ˆç´šï¼Œä¸»å‹•æ¨æ’­çµ¦ä¸»ç®¡ã€‚

---

### 6.2 ç¬¬ä¸€å±¤ï¼šå…¨å±€æ…‹å‹¢æ„ŸçŸ¥ (5 å¤§ KPI æ¨¡çµ„)

#### 6.2.1 æˆ°ç•¥åŸ·è¡Œåº¦ (Strategy Execution)

**æ•¸æ“šä¾†æº**ï¼š
- å¾çŸ¥è­˜æª”æ¡ˆä¸­æå–çš„ OKR ç›®æ¨™ï¼ˆä½¿ç”¨ NLP è­˜åˆ¥ç›®æ¨™èªå¥ï¼‰
- å°ˆæ¡ˆç®¡ç†ç³»çµ± APIï¼ˆè‹¥æ•´åˆï¼‰
- éƒ¨é–€ä¸Šå‚³çš„é€²åº¦å ±å‘Šæ–‡ä»¶

**AI è¨ˆç®—é‚è¼¯**ï¼š
```typescript
// lib/war-room/kpi/strategy-execution.ts

export class StrategyExecutionCalculator {
    async calculateExecutionRate(userId: string): Promise<StrategyKPI> {
        // 1. å¾çŸ¥è­˜åº«æå–æœ¬å¹´åº¦ç›®æ¨™æ–‡ä»¶
        const goalDocs = await this.extractGoalDocuments(userId);

        // 2. AI è§£æç›®æ¨™èˆ‡å®Œæˆç‹€æ…‹
        const objectives = await this.parseObjectivesWithAI(goalDocs);

        // 3. è¨ˆç®—å®Œæˆç‡
        const completedCount = objectives.filter(o => o.status === 'completed').length;
        const executionRate = (completedCount / objectives.length) * 100;

        // 4. AI ç”Ÿæˆæ´å¯Ÿ
        const insight = await this.generateInsight(objectives, executionRate);

        return {
            execution_rate: executionRate,
            total_objectives: objectives.length,
            completed: completedCount,
            on_track: objectives.filter(o => o.status === 'on_track').length,
            at_risk: objectives.filter(o => o.status === 'at_risk').length,
            ai_insight: insight,
            trend: this.calculateTrend(executionRate)
        };
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **ç’°å½¢é€²åº¦åœ–** (Radial Progress)ï¼šä¸­å¤®é¡¯ç¤ºç¸½é«”é”æˆç‡ 82%
- **å­£åº¦é‡Œç¨‹ç¢‘æ™‚é–“è»¸**ï¼šQ1 âœ… â†’ Q2 ğŸ”„ â†’ Q3 â¸ï¸ â†’ Q4 ğŸ“…
- **AI æ´å¯Ÿæ°£æ³¡**ï¼šã€ŒQ1 è¶…å‰ 5%ï¼Œå»ºè­°ææ—©å•Ÿå‹• Q2 é—œéµå°ˆæ¡ˆã€

---

#### 6.2.2 ç‡Ÿé‹å¥åº·åº¦ (Operational Health)

**æ•¸æ“šä¾†æº**ï¼š
- å„éƒ¨é–€æ–‡ä»¶ä¸Šå‚³é »ç‡èˆ‡æ´»èºåº¦
- Agent ä½¿ç”¨ç‡èˆ‡å°è©±å“è³ª
- çŸ¥è­˜åº«æ›´æ–°é »ç‡
- è·¨éƒ¨é–€çŸ¥è­˜å¼•ç”¨æ¬¡æ•¸ï¼ˆå¾èªç¾©åœ–è­œå–å¾—ï¼‰

**å¥åº·åº¦è©•åˆ†å…¬å¼**ï¼š
```typescript
// lib/war-room/kpi/operational-health.ts

export class OperationalHealthCalculator {
    async calculateHealthScore(userId: string): Promise<OperationalKPI> {
        const departments = await this.getUserDepartments(userId);

        let totalScore = 0;
        const deptScores: DepartmentScore[] = [];

        for (const dept of departments) {
            // 1. æ–‡ä»¶æ´»èºåº¦ (40%)
            const docActivity = await this.calculateDocActivity(dept.id);

            // 2. Agent ä½¿ç”¨ç‡ (30%)
            const agentUsage = await this.calculateAgentUsage(dept.id);

            // 3. çŸ¥è­˜æµå‹•æ€§ (20%)ï¼šè·¨éƒ¨é–€å¼•ç”¨æ¬¡æ•¸
            const knowledgeFlow = await this.calculateKnowledgeFlow(dept.id);

            // 4. çŸ¥è­˜å“è³ª (10%)
            const qualityScore = await this.calculateAverageQuality(dept.id);

            const deptScore =
                docActivity * 0.4 +
                agentUsage * 0.3 +
                knowledgeFlow * 0.2 +
                qualityScore * 0.1;

            deptScores.push({
                department_id: dept.id,
                department_name: dept.name,
                score: deptScore,
                metrics: { docActivity, agentUsage, knowledgeFlow, qualityScore }
            });

            totalScore += deptScore;
        }

        const overallHealth = totalScore / departments.length;

        return {
            overall_health: overallHealth,
            status: this.getHealthStatus(overallHealth),
            department_scores: deptScores,
            knowledge_flow_heatmap: await this.generateFlowHeatmap(departments),
            ai_alerts: await this.detectAnomalies(deptScores)
        };
    }

    private getHealthStatus(score: number): string {
        if (score >= 0.8) return 'excellent';
        if (score >= 0.6) return 'good';
        if (score >= 0.4) return 'fair';
        return 'needs_attention';
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **é›·é”åœ–**ï¼šå„éƒ¨é–€æ´»èºåº¦æ¯”è¼ƒ
- **çŸ¥è­˜æµå‹•ç†±åŠ›åœ–**ï¼šéƒ¨é–€é–“çŸ¥è­˜å¼•ç”¨é—œä¿‚ï¼ˆåŠ›å°å‘åœ–ï¼‰
- **ç•°å¸¸åµæ¸¬**ï¼šã€Œè²¡å‹™éƒ¨æœ¬é€±ä¸Šå‚³é‡ â†“30%ï¼Œå¯èƒ½éœ€é—œæ³¨ã€

---

#### 6.2.3 è²¡å‹™ç‹€æ…‹ (Financial Status)

**æ•¸æ“šä¾†æº**ï¼š
- è²¡å‹™å ±è¡¨æ–‡ä»¶ï¼ˆAI è‡ªå‹•è§£æï¼‰
- æœƒè¨ˆç³»çµ± APIï¼ˆè‹¥æ•´åˆï¼‰
- é ç®— vs å¯¦éš›æ”¯å‡ºå°æ¯”

**AI è²¡å‹™åˆ†æ**ï¼š
```typescript
// lib/war-room/kpi/financial-status.ts

export class FinancialStatusAnalyzer {
    async analyzeFinancials(userId: string): Promise<FinancialKPI> {
        // 1. æå–æœ€æ–°è²¡å‹™æ–‡ä»¶
        const financialDocs = await this.extractFinancialDocuments(userId);

        // 2. AI è§£æé—œéµæ•¸æ“š
        const parsedData = await this.parseFinancialsWithAI(financialDocs);

        // 3. è¨ˆç®—é—œéµæŒ‡æ¨™
        const revenue = parsedData.revenue;
        const expenses = parsedData.expenses;
        const budgetVsActual = this.calculateBudgetVariance(parsedData);
        const burnRate = this.calculateBurnRate(parsedData);
        const runway = this.calculateRunway(parsedData);

        // 4. é æ¸¬æœªä¾†è¶¨å‹¢
        const forecast = await this.generateForecast(parsedData);

        // 5. AI é¢¨éšªåµæ¸¬
        const risks = await this.detectFinancialRisks(parsedData);

        return {
            revenue,
            expenses,
            profit_margin: (revenue - expenses) / revenue,
            budget_variance: budgetVsActual,
            burn_rate: burnRate,
            runway_months: runway,
            forecast_next_quarter: forecast,
            risks,
            ai_insight: await this.generateFinancialInsight(parsedData, risks)
        };
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **æŠ˜ç·šåœ– + é æ¸¬å€é–“**ï¼šç‡Ÿæ”¶è¶¨å‹¢ï¼ˆå¯¦éš› vs é ç®— vs AI é æ¸¬ï¼‰
- **ç‡ƒç‡’ç‡å„€è¡¨æ¿**ï¼šè³‡é‡‘å¯ç”¨æœˆæ•¸ï¼ˆRunwayï¼‰
- **æˆæœ¬çµæ§‹æ¨¹ç‹€åœ–**ï¼šå„éƒ¨é–€æ”¯å‡ºä½”æ¯”

---

#### 6.2.4 é¢¨éšªé è­¦ (Risk Alerts)

**é¢¨éšªä¾†æº**ï¼š
```typescript
// lib/war-room/kpi/risk-alerts.ts

export class RiskAlertSystem {
    async detectRisks(userId: string): Promise<RiskKPI> {
        const risks: Risk[] = [];

        // 1. çŸ¥è­˜æ™‚æ•ˆæ€§é¢¨éšª
        const knowledgeRisks = await this.detectKnowledgeDecay(userId);
        risks.push(...knowledgeRisks);

        // 2. å¤–éƒ¨æ–°èæƒ…è³‡é¢¨éšªï¼ˆä¾›æ‡‰éˆã€ç«¶çˆ­å°æ‰‹ã€æ³•è¦ï¼‰
        const externalRisks = await this.detectExternalRisks(userId);
        risks.push(...externalRisks);

        // 3. åˆè¦æ–‡ä»¶åˆ°æœŸé¢¨éšª
        const complianceRisks = await this.detectComplianceExpiry(userId);
        risks.push(...complianceRisks);

        // 4. å…§éƒ¨çŸ¥è­˜è¡çª
        const conflictRisks = await this.detectKnowledgeConflicts(userId);
        risks.push(...conflictRisks);

        // 5. éƒ¨é–€ç•°å¸¸æ´»å‹•
        const operationalRisks = await this.detectOperationalAnomalies(userId);
        risks.push(...operationalRisks);

        // æ’åºï¼šæŒ‰å½±éŸ¿åº¦ Ã— ç·Šæ€¥åº¦
        risks.sort((a, b) => (b.impact * b.urgency) - (a.impact * a.urgency));

        return {
            total_risks: risks.length,
            critical: risks.filter(r => r.level === 'critical').length,
            high: risks.filter(r => r.level === 'high').length,
            medium: risks.filter(r => r.level === 'medium').length,
            risks: risks.slice(0, 10), // é¡¯ç¤ºå‰ 10 å€‹æœ€é‡è¦
            risk_matrix: this.generateRiskMatrix(risks),
            timeline: this.generateRiskTimeline(risks)
        };
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
- **é¢¨éšªçŸ©é™£**ï¼šå½±éŸ¿åº¦ (Y è»¸) vs å¯èƒ½æ€§ (X è»¸)
- **æ™‚é–“è»¸é è­¦**ï¼šæœªä¾† 7/30/90 å¤©é¢¨éšªäº‹ä»¶
- **é¢¨éšªå¡ç‰‡**ï¼š
  ```
  ğŸ”´ é«˜é¢¨éšª | 15 å¤©å¾Œ
  ISO èªè­‰å³å°‡åˆ°æœŸï¼Œéœ€ç«‹å³ç”³è«‹çºŒæœŸ
  [æŸ¥çœ‹æ–‡ä»¶] [å•Ÿå‹•æµç¨‹] [å§”æ´¾è² è²¬äºº]
  ```

---

#### 6.2.5 å¤–éƒ¨æƒ…è³‡ä¸­å¿ƒ (External Intelligence)

**æ ¸å¿ƒåŠŸèƒ½**ï¼šä½¿ç”¨è€…è‡ªè¨‚ç›£æ§ä¸»é¡Œï¼ŒAI è‡ªå‹•æŠ“å–èˆ‡åˆ†æç›¸é—œæ–°è

**è³‡æ–™æ¨¡å‹**ï¼š
```typescript
// lib/war-room/intelligence/watch-topic.ts

export interface WatchTopic {
    id: string;
    user_id: string;
    name: string;                    // å¦‚ã€ŒåŠå°é«”ä¾›æ‡‰éˆå‹•æ…‹ã€
    keywords: string[];              // ['å°ç©é›»', 'æ™¶ç‰‡çŸ­ç¼º', 'ASML']
    news_sources: string[];          // ['Bloomberg', 'Reuters', 'TechCrunch']
    competitors: string[];           // ç«¶çˆ­å°æ‰‹åå–®
    suppliers: string[];             // ä¾›æ‡‰å•†åå–®
    customers: string[];             // é—œéµå®¢æˆ¶åå–®
    risk_threshold: 'low' | 'medium' | 'high'; // åªæ¨é€é”æ¨™çš„æ–°è
    notification_enabled: boolean;
    created_at: string;
}

export interface IntelligenceNews {
    id: string;
    topic_id: string;
    title: string;
    source: string;
    url: string;
    published_at: string;

    // AI åˆ†æçµæœ
    relevance_score: number;         // 0-1ï¼Œèˆ‡æ¥­å‹™çš„ç›¸é—œåº¦
    risk_level: 'low' | 'medium' | 'high' | 'critical';
    impact_areas: string[];          // ['supply_chain', 'pricing', 'competition']
    sentiment: 'positive' | 'neutral' | 'negative';
    ai_summary: string;              // 100 å­—æ‘˜è¦
    key_points: string[];            // 3-5 å€‹é‡é»
    affected_entities: {             // å½±éŸ¿çš„å¯¦é«”
        competitors?: string[];
        suppliers?: string[];
        customers?: string[];
    };

    // ä½¿ç”¨è€…äº’å‹•
    is_read: boolean;
    is_bookmarked: boolean;
    user_notes?: string;
}
```

**AI æ–°èåˆ†ææµç¨‹**ï¼š
```typescript
// lib/war-room/intelligence/news-analyzer.ts

export class NewsIntelligenceAnalyzer {
    /**
     * å®šæ™‚ä»»å‹™ï¼šæ¯å°æ™‚æŠ“å–èˆ‡åˆ†ææ–°è
     */
    async fetchAndAnalyzeNews() {
        const topics = await this.getAllActiveTopics();

        for (const topic of topics) {
            // 1. å¾ NewsAPI / Google News æŠ“å–
            const rawNews = await this.fetchNewsFromAPIs(topic);

            // 2. AI éæ¿¾ç›¸é—œæ€§
            const relevantNews = await this.filterByRelevance(rawNews, topic);

            // 3. AI æ·±åº¦åˆ†æ
            for (const news of relevantNews) {
                const analysis = await this.analyzeWithAI(news, topic);

                // 4. å„²å­˜åˆ°è³‡æ–™åº«
                await this.saveIntelligence({
                    ...news,
                    ...analysis,
                    topic_id: topic.id
                });

                // 5. é«˜é¢¨éšªæ–°èç«‹å³æ¨é€
                if (analysis.risk_level === 'critical' || analysis.risk_level === 'high') {
                    await this.sendInstantNotification(topic.user_id, news, analysis);
                }
            }
        }
    }

    /**
     * AI åˆ†æå–®ä¸€æ–°è
     */
    private async analyzeWithAI(
        news: RawNews,
        topic: WatchTopic
    ): Promise<NewsAnalysis> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­æƒ…å ±åˆ†æå°ˆå®¶ã€‚è«‹åˆ†æä»¥ä¸‹æ–°èå°ä¼æ¥­çš„å½±éŸ¿ï¼š

ã€æ–°èå…§å®¹ã€‘
æ¨™é¡Œï¼š${news.title}
ä¾†æºï¼š${news.source}
å…§å®¹ï¼š${news.content}

ã€ä¼æ¥­èƒŒæ™¯ã€‘
ç›£æ§ä¸»é¡Œï¼š${topic.name}
é—œæ³¨é—œéµå­—ï¼š${topic.keywords.join(', ')}
ç«¶çˆ­å°æ‰‹ï¼š${topic.competitors.join(', ')}
ä¾›æ‡‰å•†ï¼š${topic.suppliers.join(', ')}
é—œéµå®¢æˆ¶ï¼š${topic.customers.join(', ')}

è«‹ä»¥ JSON æ ¼å¼å›è¦†ï¼š
{
  "relevance_score": 0-1 ä¹‹é–“çš„æ•¸å­—,
  "risk_level": "low" | "medium" | "high" | "critical",
  "impact_areas": ["supply_chain", "pricing", "competition", "regulation", "technology"],
  "sentiment": "positive" | "neutral" | "negative",
  "ai_summary": "100å­—å…§çš„æ‘˜è¦",
  "key_points": ["é‡é»1", "é‡é»2", "é‡é»3"],
  "affected_entities": {
    "competitors": ["å—å½±éŸ¿çš„ç«¶çˆ­å°æ‰‹"],
    "suppliers": ["å—å½±éŸ¿çš„ä¾›æ‡‰å•†"],
    "customers": ["å—å½±éŸ¿çš„å®¢æˆ¶"]
  },
  "recommended_actions": ["å»ºè­°çš„æ‡‰å°æªæ–½"]
}
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ å¤–éƒ¨æƒ…è³‡ä¸­å¿ƒ (5 å‰‡é‡è¦æ›´æ–°)                           â”‚
â”‚ [âš™ï¸ ç®¡ç†ç›£æ§ä¸»é¡Œ]                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ ç·Šæ€¥ | 30 åˆ†é˜å‰ | ä¾›æ‡‰éˆé¢¨éšª                         â”‚
â”‚ ä¾›æ‡‰å•† XYZ å®£å¸ƒåœç”¢é—œéµçµ„ä»¶ ABC-123                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ ğŸ“ å½±éŸ¿é ˜åŸŸï¼šä¾›æ‡‰éˆã€ç”Ÿç”¢è¨ˆç•«                            â”‚
â”‚ ğŸ’¡ AI å»ºè­°ï¼š                                             â”‚
â”‚    1. ç«‹å³è¯ç¹«ä¾›æ‡‰å•† B è©¢å•æ›¿ä»£æ–¹æ¡ˆ                      â”‚
â”‚    2. è©•ä¼°åº«å­˜å¯æ”¯æ’å¤©æ•¸ï¼ˆé ä¼° 45 å¤©ï¼‰                   â”‚
â”‚    3. é€šçŸ¥ç”Ÿç”¢éƒ¨èª¿æ•´ Q2 æ’ç¨‹                             â”‚
â”‚ [ğŸ”— æŸ¥çœ‹æ–°è] [ğŸ’¬ è©¢å• AI] [âœ… æ¨™è¨˜å·²è™•ç†]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ é‡è¦ | 2 å°æ™‚å‰ | ç«¶çˆ­å‹•æ…‹                            â”‚
â”‚ ç«¶çˆ­å°æ‰‹æ¨å‡ºä½åƒ¹æ–¹æ¡ˆï¼Œåƒ¹æ ¼æ¯”æˆ‘å€‘ä½ 20%                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚ ğŸ“ å½±éŸ¿é ˜åŸŸï¼šå®šåƒ¹ç­–ç•¥ã€å¸‚å ´ä½”æœ‰ç‡                        â”‚
â”‚ ğŸ’¡ AI å»ºè­°ï¼š                                             â”‚
â”‚    1. åˆ†æå°æ–¹æˆæœ¬çµæ§‹ï¼ˆå¯èƒ½çŠ§ç‰²åˆ©æ½¤æ¶å¸‚å ´ï¼‰             â”‚
â”‚    2. è©•ä¼°æ˜¯å¦è·Ÿé€²é™åƒ¹ vs å¼·åŒ–å·®ç•°åŒ–                     â”‚
â”‚ [ğŸ”— æŸ¥çœ‹æ–°è] [ğŸ’¬ è©¢å• AI] [ğŸ“Š ç«¶å“åˆ†æ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨è€…è¨­å®šä»‹é¢**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ ç®¡ç†æƒ…è³‡ç›£æ§ä¸»é¡Œ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ æ–°å¢ç›£æ§ä¸»é¡Œ]                                         â”‚
â”‚                                                          â”‚
â”‚ ğŸ“Œ åŠå°é«”ä¾›æ‡‰éˆå‹•æ…‹                    [âœï¸ ç·¨è¼¯] [ğŸ—‘ï¸ åˆªé™¤]â”‚
â”‚    é—œéµå­—ï¼šå°ç©é›», æ™¶ç‰‡çŸ­ç¼º, ASML                        â”‚
â”‚    ä¾›æ‡‰å•†ï¼šXYZ Corp, ABC Ltd                             â”‚
â”‚    é¢¨éšªé–¾å€¼ï¼šğŸŸ¡ ä¸­ç­‰ä»¥ä¸Š                                 â”‚
â”‚    æœ¬é€±æ–°èï¼š12 å‰‡ï¼ˆ3 å‰‡é«˜é¢¨éšªï¼‰                         â”‚
â”‚                                                          â”‚
â”‚ ğŸ“Œ AI æŠ€è¡“è¶¨å‹¢                         [âœï¸ ç·¨è¼¯] [ğŸ—‘ï¸ åˆªé™¤]â”‚
â”‚    é—œéµå­—ï¼šGPT, Claude, LLM, AI Agent                   â”‚
â”‚    ç«¶çˆ­å°æ‰‹ï¼šOpenAI, Google, Microsoft                  â”‚
â”‚    é¢¨éšªé–¾å€¼ï¼šğŸŸ¢ å…¨éƒ¨é¡¯ç¤º                                 â”‚
â”‚    æœ¬é€±æ–°èï¼š8 å‰‡ï¼ˆ0 å‰‡é«˜é¢¨éšªï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6.3 ç¬¬äºŒå±¤ï¼šéƒ¨é–€æˆ°æƒ…æ¨¡çµ„

#### éƒ¨é–€å¡ç‰‡è³‡æ–™æ¨¡å‹

```typescript
// lib/war-room/department/department-card.ts

export interface DepartmentCard {
    department_id: string;
    department_name: string;
    department_icon: string;

    // å³æ™‚çµ±è¨ˆ
    stats: {
        total_files: number;
        files_updated_today: number;
        files_updated_this_week: number;
        active_agents: number;
        total_conversations_this_week: number;
        knowledge_health_score: number; // 0-100
    };

    // AI è‡ªå‹•ç”Ÿæˆçš„éƒ¨é–€æ—¥å ±èˆ‡æƒ…å ±æµ
    daily_brief: {
        generated_at: string;
        // ä¾†è‡ª Insight Store çš„åŒæ­¥æ‘˜è¦
        synced_insights: Array<{
            source_file: string;    // ä¾‹å¦‚ "2024_Q1_Revenue.csv"
            summary: string;        // "ç‡Ÿæ”¶æˆé•· 15%ï¼Œä½†æ¯›åˆ©ä¸‹é™ 2%"
            detected_at: string;
            significance: 'high' | 'medium' | 'low';
        }>;
        top_3_updates: string[];        // æœ€é‡è¦çš„ 3 å€‹æ›´æ–°
        key_metrics: Array<{
            label: string;
            value: string;
            trend: 'up' | 'down' | 'stable';
            change_percentage?: number;
            source_id?: string;     // é€£çµå› Metric Store
        }>;
        urgent_items: string[];         // éœ€ç«‹å³é—œæ³¨
        ai_summary: string;             // 100 å­—éƒ¨é–€ç¾æ³ç¸½çµ
    };

    // äº’å‹•åŠŸèƒ½
    actions: {
        start_conversation: boolean;
        view_full_report: boolean;
        download_pdf: boolean;
        view_knowledge_graph: boolean;
    };
}
```

#### AI éƒ¨é–€æ—¥å ±ç”Ÿæˆå™¨

```typescript
// lib/war-room/department/daily-brief-generator.ts

export class DepartmentDailyBriefGenerator {
    /**
     * ç‚ºå–®ä¸€éƒ¨é–€ç”Ÿæˆ AI æ—¥å ±
     */
    async generateDailyBrief(departmentId: string): Promise<DailyBrief> {
        // 1. å–å¾—éƒ¨é–€è¿‘ 7 å¤©çš„æ‰€æœ‰æ–‡ä»¶æ›´æ–°
        const recentFiles = await this.getRecentFiles(departmentId, 7);

        // 2. å–å¾—éƒ¨é–€ Agent çš„å°è©±è¨˜éŒ„
        const conversations = await this.getRecentConversations(departmentId, 7);

        // 3. è¨ˆç®—é—œéµæŒ‡æ¨™è®ŠåŒ–
        const metrics = await this.calculateMetrics(departmentId);

        // 4. AI åˆ†æï¼šæå–é‡é»
        const analysis = await this.analyzeWithAI(recentFiles, conversations, metrics);

        return {
            generated_at: new Date().toISOString(),
            top_3_updates: analysis.top_updates,
            key_metrics: metrics,
            urgent_items: analysis.urgent_items,
            ai_summary: analysis.summary
        };
    }

    /**
     * AI åˆ†æéƒ¨é–€å‹•æ…‹
     */
    private async analyzeWithAI(
        files: File[],
        conversations: Conversation[],
        metrics: Metric[]
    ): Promise<AIAnalysis> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­ç®¡ç†é¡§å•ã€‚è«‹åˆ†æä»¥ä¸‹éƒ¨é–€çš„æœ¬é€±å‹•æ…‹ä¸¦ç”Ÿæˆç°¡å ±ï¼š

ã€æœ¬é€±æ–°å¢/æ›´æ–°æ–‡ä»¶ã€‘
${files.map(f => `- ${f.filename} (${f.category})`).join('\n')}

ã€æœ¬é€± Agent å°è©±é‡é»ã€‘
${conversations.map(c => `- ${c.summary}`).join('\n')}

ã€é—œéµæŒ‡æ¨™è®ŠåŒ–ã€‘
${metrics.map(m => `- ${m.label}: ${m.value} (${m.trend} ${m.change_percentage}%)`).join('\n')}

è«‹ä»¥ JSON æ ¼å¼å›è¦†ï¼š
{
  "top_updates": ["æœ€é‡è¦çš„æ›´æ–°1", "æ›´æ–°2", "æ›´æ–°3"],
  "urgent_items": ["éœ€ç«‹å³é—œæ³¨çš„äº‹é …"],
  "summary": "100å­—å…§çš„éƒ¨é–€ç¾æ³ç¸½çµï¼Œå°ˆæ¥­ä¸”ç²¾ç…‰",
  "insights": ["æ´å¯Ÿ1", "æ´å¯Ÿ2"]
}
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

#### å°è©±å¼æ·±å…¥æ¢æŸ¥ (Conversational Drill-Down)

ç•¶ä½¿ç”¨è€…é»æ“Šã€ŒğŸ’¬ å°è©±ã€æŒ‰éˆ•ï¼š

```typescript
// lib/war-room/department/conversation-modal.ts

export class DepartmentConversationModal {
    /**
     * å•Ÿå‹•éƒ¨é–€å°è©±ï¼ˆè‡ªå‹•è¼‰å…¥è©²éƒ¨é–€æ‰€æœ‰çŸ¥è­˜ï¼‰
     */
    async startConversation(departmentId: string): Promise<ConversationSession> {
        // 1. å–å¾—éƒ¨é–€æ‰€æœ‰æ–‡ä»¶
        const departmentFiles = await this.getDepartmentFiles(departmentId);

        // 2. å»ºç«‹è‡¨æ™‚ Agentï¼ˆé è¼‰å…¥éƒ¨é–€çŸ¥è­˜ï¼‰
        const tempAgent = await this.createDepartmentAgent(departmentId, departmentFiles);

        // 3. AI ç”Ÿæˆå»ºè­°å•é¡Œ
        const suggestedQuestions = await this.generateSuggestedQuestions(
            departmentId,
            departmentFiles
        );

        return {
            session_id: generateSessionId(),
            agent_id: tempAgent.id,
            department_id: departmentId,
            suggested_questions: suggestedQuestions,
            context_loaded: true
        };
    }

    /**
     * AI ç”Ÿæˆå»ºè­°å•é¡Œ
     */
    private async generateSuggestedQuestions(
        departmentId: string,
        files: File[]
    ): Promise<string[]> {
        const recentUpdates = files.slice(0, 5);

        const prompt = `
æ ¹æ“šä»¥ä¸‹éƒ¨é–€æœ€è¿‘çš„æ–‡ä»¶æ›´æ–°ï¼Œç”Ÿæˆ 5 å€‹é«˜éšä¸»ç®¡å¯èƒ½æƒ³å•çš„å•é¡Œï¼š

ã€æœ€è¿‘æ›´æ–°ã€‘
${recentUpdates.map(f => `- ${f.filename}`).join('\n')}

è¦æ±‚ï¼š
1. å•é¡Œè¦èšç„¦æ–¼æ±ºç­–æ”¯æ´ï¼ˆä¸æ˜¯ç´°ç¯€æŸ¥è©¢ï¼‰
2. æ¶µè“‹è¶¨å‹¢åˆ†æã€é¢¨éšªè­˜åˆ¥ã€æ©Ÿæœƒç™¼ç¾
3. æ¯å€‹å•é¡Œä¸è¶…é 20 å­—

ç¯„ä¾‹ï¼š
- æœ¬æœˆæ¥­ç¸¾ä¸‹æ»‘çš„ä¸»è¦åŸå› æ˜¯ä»€éº¼ï¼Ÿ
- å“ªäº›ç”¢å“ç·šè¡¨ç¾æœ€å¥½ï¼Ÿ
- ç«¶å“åˆ†æä¸­æœ€å¤§çš„å¨è„…æ˜¯ä»€éº¼ï¼Ÿ
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return this.parseQuestions(response);
    }
}
```

**å°è©±ä»‹é¢è¨­è¨ˆ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ èˆ‡æ¥­å‹™éƒ¨å°è©±                              [âœ• é—œé–‰]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ ğŸ¤– å·²è¼‰å…¥æ¥­å‹™éƒ¨çš„ 23 ä»½æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥è©¢å•ä»»ä½•å•é¡Œ     â”‚
â”‚                                                          â”‚
â”‚ ğŸ’¡ å»ºè­°å•é¡Œï¼š                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ â€¢ æœ¬æœˆæ¥­ç¸¾é”æˆç‡ç‚ºä½•ï¼Ÿä¸»è¦è²¢ç»ä¾†è‡ªå“ªäº›ç”¢å“ï¼Ÿ      â”‚   â”‚
â”‚ â”‚ â€¢ æœ¬é€±ç°½ç´„çš„å¤§å®¢æˆ¶ ABCï¼Œåˆç´„å…§å®¹é‡é»æ˜¯ä»€éº¼ï¼Ÿ     â”‚   â”‚
â”‚ â”‚ â€¢ ç«¶å“åˆ†æå ±å‘Šä¸­ï¼Œå°æ‰‹çš„æœ€å¤§å„ªå‹¢æ˜¯ä»€éº¼ï¼Ÿ         â”‚   â”‚
â”‚ â”‚ â€¢ å®¢æˆ¶åé¥‹ä¸­æœ€å¸¸æåˆ°çš„ç—›é»æ˜¯ä»€éº¼ï¼Ÿ               â”‚   â”‚
â”‚ â”‚ â€¢ é æ¸¬ Q2 èƒ½å¦é”æˆç›®æ¨™ï¼Ÿ                          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ æ‚¨çš„å•é¡Œï¼š                                       â”‚ â”‚
â”‚ â”‚ [                                                  ]â”‚ â”‚
â”‚ â”‚                                            [ğŸ“¤ é€å‡º]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ ğŸ” å¼•ç”¨ä¾†æºæœƒè‡ªå‹•æ¨™è¨»åœ¨å›ç­”ä¸­                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6.4 ç¬¬ä¸‰å±¤ï¼šAI æ™ºèƒ½æ´å¯Ÿ

#### è·¨éƒ¨é–€çŸ¥è­˜é€£çµ (Cross-Department Insights)

```typescript
// lib/war-room/insights/cross-department-linker.ts

export class CrossDepartmentInsightEngine {
    /**
     * ç™¼ç¾è·¨éƒ¨é–€çš„çŸ¥è­˜é€£çµèˆ‡æ©Ÿæœƒ
     */
    async discoverCrossDepartmentInsights(userId: string): Promise<Insight[]> {
        const insights: Insight[] = [];

        // 1. å–å¾—æ‰€æœ‰éƒ¨é–€æœ€è¿‘çš„æ–‡ä»¶
        const departments = await this.getUserDepartments(userId);
        const recentFilesByDept = new Map<string, File[]>();

        for (const dept of departments) {
            recentFilesByDept.set(
                dept.id,
                await this.getRecentFiles(dept.id, 7)
            );
        }

        // 2. å…©å…©æ¯”è¼ƒéƒ¨é–€ï¼Œå°‹æ‰¾èªç¾©é—œè¯
        for (let i = 0; i < departments.length; i++) {
            for (let j = i + 1; j < departments.length; j++) {
                const deptA = departments[i];
                const deptB = departments[j];

                const filesA = recentFilesByDept.get(deptA.id) || [];
                const filesB = recentFilesByDept.get(deptB.id) || [];

                // 3. AI åˆ†æé—œè¯æ€§
                const connections = await this.findConnections(
                    deptA, filesA,
                    deptB, filesB
                );

                insights.push(...connections);
            }
        }

        // 4. æŒ‰é‡è¦æ€§æ’åº
        insights.sort((a, b) => b.importance_score - a.importance_score);

        return insights.slice(0, 5); // é¡¯ç¤ºå‰ 5 å€‹æœ€é‡è¦
    }

    /**
     * AI åˆ†æå…©éƒ¨é–€é–“çš„çŸ¥è­˜é€£çµ
     */
    private async findConnections(
        deptA: Department, filesA: File[],
        deptB: Department, filesB: File[]
    ): Promise<Insight[]> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­æˆ°ç•¥é¡§å•ã€‚è«‹åˆ†æä»¥ä¸‹å…©å€‹éƒ¨é–€çš„æœ€æ–°å‹•æ…‹ï¼Œæ‰¾å‡ºæ½›åœ¨çš„å”ä½œæ©Ÿæœƒæˆ–é¢¨éšªï¼š

ã€${deptA.name}ã€‘
${filesA.map(f => `- ${f.filename}: ${f.ai_summary}`).join('\n')}

ã€${deptB.name}ã€‘
${filesB.map(f => `- ${f.filename}: ${f.ai_summary}`).join('\n')}

è«‹æ‰¾å‡ºï¼š
1. å…©éƒ¨é–€è³‡è¨Šçš„é—œè¯æ€§ï¼ˆå¦‚ç ”ç™¼æ–°æŠ€è¡“å¯æ‡‰ç”¨æ–¼æ¥­å‹™æ¨å»£ï¼‰
2. æ½›åœ¨çš„å”ä½œæ©Ÿæœƒ
3. è³‡è¨Šä¸ä¸€è‡´æˆ–è¡çª

ä»¥ JSON æ ¼å¼å›è¦†ï¼ˆå¦‚ç„¡ç™¼ç¾å‰‡å›å‚³ç©ºé™£åˆ—ï¼‰ï¼š
[
  {
    "type": "opportunity" | "risk" | "conflict",
    "title": "ç°¡çŸ­æ¨™é¡Œï¼ˆä¸è¶…é 30 å­—ï¼‰",
    "description": "è©³ç´°èªªæ˜",
    "departments": ["${deptA.id}", "${deptB.id}"],
    "related_files": ["file_id_1", "file_id_2"],
    "importance_score": 0-1,
    "recommended_action": "å»ºè­°è¡Œå‹•"
  }
]
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

#### æˆ°ç•¥å»ºè­°å¼•æ“ (Strategy Recommendation Engine)

```typescript
// lib/war-room/insights/strategy-recommender.ts

export class StrategyRecommendationEngine {
    /**
     * ç”Ÿæˆæœ¬é€±æˆ°ç•¥å»ºè­°
     */
    async generateWeeklyRecommendations(userId: string): Promise<Recommendation[]> {
        const recommendations: Recommendation[] = [];

        // 1. å¾å„æ¨¡çµ„æ”¶é›†æ´å¯Ÿ
        const riskInsights = await this.getRiskInsights(userId);
        const opportunityInsights = await this.getOpportunityInsights(userId);
        const crossDeptInsights = await this.getCrossDeptInsights(userId);
        const externalInsights = await this.getExternalInsights(userId);

        // 2. AI ç¶œåˆåˆ†æï¼Œç”Ÿæˆæˆ°ç•¥å»ºè­°
        const strategicRecommendations = await this.synthesizeRecommendations([
            ...riskInsights,
            ...opportunityInsights,
            ...crossDeptInsights,
            ...externalInsights
        ]);

        return strategicRecommendations;
    }

    private async synthesizeRecommendations(
        insights: Insight[]
    ): Promise<Recommendation[]> {
        const prompt = `
ä½ æ˜¯ä¼æ¥­æˆ°ç•¥é¡§å•ã€‚åŸºæ–¼ä»¥ä¸‹æ´å¯Ÿï¼Œç”Ÿæˆ 3-5 å€‹æˆ°ç•¥å»ºè­°ï¼š

ã€æ´å¯Ÿå½™ç¸½ã€‘
${insights.map(i => `[${i.type}] ${i.title}: ${i.description}`).join('\n\n')}

è¦æ±‚ï¼š
1. å»ºè­°è¦å¯åŸ·è¡Œï¼ˆä¸æ˜¯ç©ºæ³›çš„ã€ŒåŠ å¼·XXXã€ï¼‰
2. æ¨™è¨»å„ªå…ˆç´šï¼ˆé«˜/ä¸­/ä½ï¼‰
3. èªªæ˜é æœŸæ•ˆç›Š
4. åˆ—å‡ºä¾æ“šçš„æª”æ¡ˆä¾†æº

ä»¥ JSON æ ¼å¼å›è¦†ï¼š
[
  {
    "priority": "high" | "medium" | "low",
    "category": "risk_mitigation" | "opportunity" | "efficiency" | "innovation",
    "title": "å»ºè­°æ¨™é¡Œ",
    "problem": "è§£æ±ºä»€éº¼å•é¡Œæˆ–æŠ“ä½ä»€éº¼æ©Ÿæœƒ",
    "recommendation": "å…·é«”å»ºè­°è¡Œå‹•",
    "expected_benefit": "é æœŸæ•ˆç›Š",
    "evidence_files": ["file_id_1", "file_id_2"],
    "next_steps": ["æ­¥é©Ÿ1", "æ­¥é©Ÿ2"]
  }
]
        `;

        const response = await this.geminiAPI.generateContent(prompt);
        return JSON.parse(response);
    }
}
```

**è¦–è¦ºå‘ˆç¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– æœ¬é€± AI æˆ°ç•¥å»ºè­° (3 é …)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”´ [é«˜å„ªå…ˆç´š] ä¾›æ‡‰éˆé¢¨éšªç·©è§£                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ğŸ“Œ å•é¡Œï¼šä¾›æ‡‰å•† A åƒ¹æ ¼ä¸Šæ¼² 15%ï¼Œå½±éŸ¿ Q2 æˆæœ¬          â”‚
â”‚ ğŸ’¡ å»ºè­°ï¼š                                             â”‚
â”‚    1. è¯ç¹«ä¾›æ‡‰å•† B èˆ‡ C è©¢åƒ¹ï¼ˆé ä¼°å¯é™ä½ 8% æˆæœ¬ï¼‰    â”‚
â”‚    2. è©•ä¼°æå‰æ¡è³¼ 3 å€‹æœˆåº«å­˜ä»¥é–å®šåƒ¹æ ¼               â”‚
â”‚    3. ç ”ç™¼éƒ¨è©•ä¼°æ›¿ä»£ææ–™å¯è¡Œæ€§                        â”‚
â”‚ ğŸ“Š é æœŸæ•ˆç›Šï¼šç¯€çœ $50K æˆæœ¬ï¼Œé™ä½ä¾›æ‡‰é¢¨éšª             â”‚
â”‚ ğŸ“ ä¾æ“šï¼šæ¡è³¼éƒ¨_ä¾›æ‡‰å•†å ±åƒ¹å–®.pdfã€è²¡å‹™éƒ¨_æˆæœ¬åˆ†æ.xlsxâ”‚
â”‚                                                       â”‚
â”‚ [âœ… æ¨™è¨˜åŸ·è¡Œä¸­] [ğŸ“… è¨­å®šæé†’] [ğŸ’¬ è¨è«–] [â­ï¸ å»¶å¾Œ]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¡ [ä¸­å„ªå…ˆç´š] ç”¢å“å‰µæ–°æ©Ÿæœƒ                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ ğŸ“Œ æ©Ÿæœƒï¼šå®¢æˆ¶è©¢å•ã€ŒAI æ•´åˆã€é—œéµå­—å¢é•· 60% (æœ¬é€±)     â”‚
â”‚ ğŸ’¡ å»ºè­°ï¼š                                             â”‚
â”‚    1. ç ”ç™¼éƒ¨è©•ä¼°åœ¨ç¾æœ‰ç”¢å“åŠ å…¥ AI åŠŸèƒ½çš„æŠ€è¡“å¯è¡Œæ€§    â”‚
â”‚    2. æ¥­å‹™éƒ¨èª¿æŸ¥å®¢æˆ¶å…·é«”éœ€æ±‚èˆ‡ä»˜è²»æ„é¡˜               â”‚
â”‚    3. ç”¢å“éƒ¨è¦åŠƒ Roadmapï¼ŒQ3 æ¨å‡º MVP                â”‚
â”‚ ğŸ“Š é æœŸæ•ˆç›Šï¼šé–‹æ‹“æ–°å¸‚å ´ï¼Œé ä¼°å¢åŠ  15% ç‡Ÿæ”¶            â”‚
â”‚ ğŸ“ ä¾æ“šï¼šæ¥­å‹™éƒ¨_å®¢æˆ¶éœ€æ±‚åˆ†æ.pdfã€ç ”ç™¼éƒ¨_æŠ€è¡“è©•ä¼°.md â”‚
â”‚                                                       â”‚
â”‚ [âœ… æ¨™è¨˜åŸ·è¡Œä¸­] [ğŸ“… è¨­å®šæé†’] [ğŸ’¬ è¨è«–] [â­ï¸ å»¶å¾Œ]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 6.5 æ¬Šé™åˆ†ç´šè¨­è¨ˆ

```typescript
// lib/war-room/permissions/access-control.ts

export enum WarRoomAccessLevel {
    DENIED = 'denied',           // ç„¡æ¬Šé™
    DEPARTMENT = 'department',   // éƒ¨é–€ä¸»ç®¡ï¼šåªèƒ½çœ‹æœ¬éƒ¨é–€
    EXECUTIVE = 'executive',     // C-Levelï¼šå¯çœ‹æ‰€æœ‰éƒ¨é–€
    OWNER = 'owner'              // ä¼æ¥­ä¸»ï¼šå®Œæ•´æ§åˆ¶
}

export class WarRoomAccessControl {
    async checkAccess(userId: string): Promise<WarRoomAccessLevel> {
        const user = await this.getUserProfile(userId);

        // ä¼æ¥­ä¸»
        if (user.role === 'owner') {
            return WarRoomAccessLevel.OWNER;
        }

        // C-Level é«˜éšä¸»ç®¡
        if (['ceo', 'cfo', 'cto', 'coo'].includes(user.role)) {
            return WarRoomAccessLevel.EXECUTIVE;
        }

        // éƒ¨é–€ä¸»ç®¡
        if (user.is_department_head) {
            return WarRoomAccessLevel.DEPARTMENT;
        }

        // ä¸€èˆ¬å“¡å·¥ç„¡æ¬Šé™
        return WarRoomAccessLevel.DENIED;
    }

    async filterVisibleDepartments(
        userId: string,
        allDepartments: Department[]
    ): Promise<Department[]> {
        const accessLevel = await this.checkAccess(userId);

        if (accessLevel === WarRoomAccessLevel.OWNER ||
            accessLevel === WarRoomAccessLevel.EXECUTIVE) {
            return allDepartments; // å¯è¦‹æ‰€æœ‰éƒ¨é–€
        }

        if (accessLevel === WarRoomAccessLevel.DEPARTMENT) {
            const user = await this.getUserProfile(userId);
            const userDept = allDepartments.find(d => d.id === user.department_id);

            if (!userDept) return [];

            // å¯è¦‹æœ¬éƒ¨é–€ + ç›¸é—œéƒ¨é–€ï¼ˆæ‘˜è¦æ¨¡å¼ï¼‰
            return allDepartments.filter(d =>
                d.id === userDept.id ||
                userDept.related_departments.includes(d.id)
            );
        }

        return []; // ç„¡æ¬Šé™
    }
}

/**
 * 6.1.5 æ•¸æ“šèª¿å’Œèˆ‡æƒ…å ±å±¤å¯¦ä½œ (Metric & Insight Store)
 */

// lib/war-room/intelligence/metric-store.ts

export interface MetricDefinition {
    id: string;               // e.g., 'finance_revenue'
    name: string;             // 'æœˆç‡Ÿæ”¶'
    unit: string;             // 'USD', 'NTD', 'Count'
    granularity: 'daily' | 'monthly' | 'quarterly';
    keywords: string[];       // ['Revenue', 'Sales', 'ç‡Ÿæ¥­é¡']
    conflict_policy: 'latest_wins' | 'human_review';
}

export interface MetricValue {
    id: string;
    metric_id: string;
    timestamp: string;        // æ•¸æ“šæ‰€å±¬æ™‚é–“
    value: number;
    dimensions: Record<string, string>; // { department: 'sales', region: 'asia' }
    source_file_id: string;
    confidence: number;
    is_active: boolean;
}

export interface InsightSnippet {
    id: string;
    source_file_id: string;
    department_id: string;
    content: string;         // AI ç”Ÿæˆçš„çŸ­è©•
    tags: string[];          // ['risk', 'opportunity', 'financial']
    significance: number;    // 0-1
    created_at: string;
}

```

### 6.1.6 AI ETL æ•¸æ“šèª¿å’Œå¼•æ“ (AI-Driven ETL Engine)

é€™æ˜¯ä¸è®“æˆ°æƒ…å®¤å´©æ½°çš„æ ¸å¿ƒé‚è¼¯ã€‚

```typescript
// lib/war-room/etl/ai-metric-etl.ts

export class AIMetricETLEngine {
    /**
     * æ ¸å¿ƒæµç¨‹ï¼šå¾ç•°è³ªæ–‡ä»¶èƒå–æ¨™æº–æŒ‡æ¨™
     * @param fileId ä¸Šå‚³çš„æ–‡ä»¶ ID
     */
    async processFileForMetrics(fileId: string): Promise<ETLResult> {
        // 1. æ„åœ–è­˜åˆ¥ï¼šé€™ä»½æ–‡ä»¶åŒ…å«é—œéµæŒ‡æ¨™å—ï¼Ÿ
        const fileContent = await this.getFileContent(fileId);
        const intent = await this.identifyMetricIntent(fileContent);
        
        if (!intent.hasMetrics) {
            return { status: 'skipped', reason: 'no_metrics_found' };
        }

        // 2. ç²å–æŒ‡æ¨™å®šç¾© (Schema)
        const definitions = await this.getMetricDefinitions(intent.detectedMetricTypes);

        // 3. AI æ˜ å°„èˆ‡èƒå– (The "Magic" Step)
        // è®“ LLM å°‡ "csv_col_A", "pdf_table_row_2" è½‰æ›ç‚ºæ¨™æº– metric_id
        const extractedMetrics = await this.extractAndMap(fileContent, definitions);

        // 4. æ¸…æ´—èˆ‡è¡çªæª¢æ¸¬
        const cleansedMetrics = await this.cleanseAndResolveConflicts(extractedMetrics);

        // 5. è¼‰å…¥è‡³ Metric Store
        await this.loadToStore(cleansedMetrics);

        return { status: 'success', count: cleansedMetrics.length };
    }

    /**
     * Step 4: æ¸…æ´—èˆ‡è¡çªæª¢æ¸¬é‚è¼¯
     */
    private async cleanseAndResolveConflicts(
        metrics: RawMetricValue[]
    ): Promise<MetricValue[]> {
        const results: MetricValue[] = [];

        for (const m of metrics) {
            // A. æª¢æŸ¥æ˜¯å¦å­˜åœ¨èˆŠæ•¸æ“š (ä¾‹å¦‚: 1æœˆç‡Ÿæ”¶)
            const existing = await this.metricStore.find({
                metric_id: m.metric_id,
                timestamp: m.timestamp,
                dimensions: m.dimensions
            });

            if (existing) {
                // B. è¡çªè§£æ±ºç­–ç•¥ï¼šLatest Wins
                await this.metricStore.softDelete(existing.id);
                console.log(`[ETL] Overwriting metric ${m.metric_id} from ${existing.source_file_id}`);
            }

            // C. ç•°å¸¸å€¼åµæ¸¬ (Anomaly Detection)
            const isAnomaly = await this.detectAnomaly(m);
            if (isAnomaly) {
                // æ¨™è¨˜ç‚ºå¾…å¯©æ ¸ï¼Œä¸ç›´æ¥ç”Ÿæ•ˆ
                m.is_active = false; 
                await this.createAlert('metric_anomaly', m);
            }

            results.push(m);
        }

        return results;
    }
}
```

---

### 6.6 è³‡æ–™åº«çµæ§‹

```sql
-- æˆ°æƒ…å®¤é…ç½®è¡¨
CREATE TABLE IF NOT EXISTS war_room_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE UNIQUE,

    -- å¤–éƒ¨æƒ…è³‡ç›£æ§ä¸»é¡Œ
    watch_topics JSONB DEFAULT '[]',

    -- å„€è¡¨æ¿ä½ˆå±€åå¥½
    layout_config JSONB DEFAULT '{
        "kpi_order": ["strategy", "operations", "financial", "risk", "intelligence"],
        "department_display_mode": "grid",
        "show_ai_insights": true
    }',

    -- é€šçŸ¥åå¥½
    notification_preferences JSONB DEFAULT '{
        "email_daily_summary": true,
        "push_critical_risks": true,
        "push_high_opportunities": false
    }',

    created_at TIMESTAMPTZ DEFAULT NOW(),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- æŒ‡æ¨™å®šç¾©è¡¨ (Metric Store Definitions)
CREATE TABLE IF NOT EXISTS metric_definitions (
    id VARCHAR(50) PRIMARY KEY, -- e.g. 'finance_revenue'
    name VARCHAR(100) NOT NULL,
    unit VARCHAR(20),
    granularity VARCHAR(20),
    keywords JSONB DEFAULT '[]',
    conflict_policy VARCHAR(20) DEFAULT 'latest_wins'
);

-- æŒ‡æ¨™æ•¸å€¼è¡¨ (Metric Store Values)
CREATE TABLE IF NOT EXISTS metric_values (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    metric_id VARCHAR(50) REFERENCES metric_definitions(id),
    value DECIMAL(20, 4) NOT NULL,
    timestamp TIMESTAMPTZ NOT NULL, -- æ•¸æ“šæ™‚é–“é»
    dimensions JSONB DEFAULT '{}',  -- ç¶­åº¦
    
    source_file_id UUID REFERENCES files(id),
    confidence DECIMAL(3, 2),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    INDEX idx_metrics_query (metric_id, timestamp, is_active)
);

-- æ´å¯Ÿç‰‡æ®µè¡¨ (Insight Store)
CREATE TABLE IF NOT EXISTS insight_snippets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    source_file_id UUID REFERENCES files(id),
    department_id UUID REFERENCES departments(id),
    
    content TEXT NOT NULL,
    tags JSONB DEFAULT '[]',
    significance DECIMAL(3, 2) DEFAULT 0.5, -- é‡è¦æ€§
    
    is_pushed BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å·²æ¨æ’­
    created_at TIMESTAMPTZ DEFAULT NOW(),
    
    INDEX idx_insights_dept (department_id, created_at DESC)
);

-- å¤–éƒ¨æ–°èæƒ…è³‡è¡¨
CREATE TABLE IF NOT EXISTS external_intelligence (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    topic_id VARCHAR(255) NOT NULL,

    -- æ–°èåŸºæœ¬è³‡è¨Š
    title TEXT NOT NULL,
    source VARCHAR(255) NOT NULL,
    url TEXT,
    content TEXT,
    published_at TIMESTAMPTZ NOT NULL,
    fetched_at TIMESTAMPTZ DEFAULT NOW(),

    -- AI åˆ†æçµæœ
    relevance_score DECIMAL(3,2) DEFAULT 0,
    risk_level VARCHAR(10),
    impact_areas JSONB DEFAULT '[]',
    sentiment VARCHAR(10),
    ai_summary TEXT,
    key_points JSONB DEFAULT '[]',
    affected_entities JSONB DEFAULT '{}',
    recommended_actions JSONB DEFAULT '[]',

    -- ä½¿ç”¨è€…äº’å‹•
    is_read BOOLEAN DEFAULT FALSE,
    is_bookmarked BOOLEAN DEFAULT FALSE,
    user_notes TEXT,
    status VARCHAR(20) DEFAULT 'pending',

    reviewed_by UUID REFERENCES user_profiles(id),
    reviewed_at TIMESTAMPTZ,

    created_at TIMESTAMPTZ DEFAULT NOW(),

    INDEX idx_intelligence_user_topic (user_id, topic_id),
    INDEX idx_intelligence_risk (risk_level) WHERE status = 'pending',
    INDEX idx_intelligence_published (published_at DESC)
);

-- éƒ¨é–€æ—¥å ±è¡¨
CREATE TABLE IF NOT EXISTS department_daily_briefs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    department_id UUID REFERENCES departments(id) ON DELETE CASCADE,
    brief_date DATE NOT NULL,

    -- AI ç”Ÿæˆå…§å®¹
    top_updates JSONB DEFAULT '[]',
    key_metrics JSONB DEFAULT '[]',
    urgent_items JSONB DEFAULT '[]',
    ai_summary TEXT,
    insights JSONB DEFAULT '[]',

    -- çµ±è¨ˆæ•¸æ“š
    stats JSONB DEFAULT '{
        "total_files": 0,
        "files_updated_today": 0,
        "active_agents": 0,
        "conversations_count": 0,
        "knowledge_health_score": 0
    }',

    generated_at TIMESTAMPTZ DEFAULT NOW(),

    UNIQUE(department_id, brief_date)
);

-- æˆ°ç•¥å»ºè­°è¡¨
CREATE TABLE IF NOT EXISTS strategic_recommendations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,
    week_start_date DATE NOT NULL,

    priority VARCHAR(10) NOT NULL,
    category VARCHAR(30) NOT NULL,
    title TEXT NOT NULL,
    problem TEXT,
    recommendation TEXT NOT NULL,
    expected_benefit TEXT,
    evidence_files UUID[] DEFAULT '{}',
    next_steps JSONB DEFAULT '[]',

    -- ä½¿ç”¨è€…äº’å‹•
    status VARCHAR(20) DEFAULT 'pending',
    assigned_to UUID REFERENCES user_profiles(id),
    due_date DATE,
    completed_at TIMESTAMPTZ,
    user_notes TEXT,

    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW(),

    INDEX idx_recommendations_user_week (user_id, week_start_date),
    INDEX idx_recommendations_status (status)
);

-- è·¨éƒ¨é–€æ´å¯Ÿè¡¨
CREATE TABLE IF NOT EXISTS cross_department_insights (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES user_profiles(id) ON DELETE CASCADE,

    type VARCHAR(20) NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    departments UUID[] DEFAULT '{}',
    related_files UUID[] DEFAULT '{}',
    importance_score DECIMAL(3,2) DEFAULT 0,
    recommended_action TEXT,

    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    expires_at TIMESTAMPTZ,

    INDEX idx_insights_user (user_id),
    INDEX idx_insights_importance (importance_score DESC)
);
```

---

### 6.7 API ç«¯é»è¦åŠƒ

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|-----|-----|-----|
| `/api/war-room/overview` | GET | å–å¾—æˆ°æƒ…å®¤ç¸½è¦½ï¼ˆ5 å¤§ KPIï¼‰ |
| `/api/war-room/kpi/strategy` | GET | æˆ°ç•¥åŸ·è¡Œåº¦è©³ç´°æ•¸æ“š |
| `/api/war-room/kpi/operations` | GET | ç‡Ÿé‹å¥åº·åº¦è©³ç´°æ•¸æ“š |
| `/api/war-room/kpi/financial` | GET | è²¡å‹™ç‹€æ…‹è©³ç´°æ•¸æ“š |
| `/api/war-room/kpi/risks` | GET | é¢¨éšªé è­¦è©³ç´°æ•¸æ“š |
| `/api/war-room/intelligence` | GET | å¤–éƒ¨æƒ…è³‡åˆ—è¡¨ |
| `/api/war-room/intelligence/topics` | GET/POST | ç®¡ç†ç›£æ§ä¸»é¡Œ |
| `/api/war-room/intelligence/:id/analyze` | POST | é‡æ–°åˆ†æå–®ä¸€æ–°è |
| `/api/war-room/departments` | GET | å–å¾—éƒ¨é–€æˆ°æƒ…å¡ç‰‡åˆ—è¡¨ |
| `/api/war-room/departments/:id/brief` | GET | å–å¾—éƒ¨é–€æ—¥å ± |
| `/api/war-room/departments/:id/chat` | POST | å•Ÿå‹•éƒ¨é–€å°è©± |
| `/api/war-room/insights/cross-department` | GET | è·¨éƒ¨é–€æ´å¯Ÿ |
| `/api/war-room/recommendations` | GET | æœ¬é€±æˆ°ç•¥å»ºè­° |
| `/api/war-room/recommendations/:id/update` | PATCH | æ›´æ–°å»ºè­°ç‹€æ…‹ |
| `/api/war-room/export-pdf` | POST | åŒ¯å‡ºæˆ°æƒ…å®¤ PDF å ±å‘Š |

---

### 6.8 æ’ç¨‹ä»»å‹™

| ä»»å‹™åç¨± | åŸ·è¡Œé »ç‡ | ç”¨é€” | å¯¦ä½œ |
|---------|---------|-----|-----|
| `fetch_external_news` | æ¯å°æ™‚ | æŠ“å–ä¸¦åˆ†æå¤–éƒ¨æ–°è | Cron Job |
| `generate_department_briefs` | æ¯æ—¥ 06:00 | ç”Ÿæˆæ‰€æœ‰éƒ¨é–€æ—¥å ± | Cron Job |
| `calculate_kpi_metrics` | æ¯ 15 åˆ†é˜ | æ›´æ–° 5 å¤§ KPI æŒ‡æ¨™ | Cron Job |
| `discover_cross_dept_insights` | æ¯æ—¥ 07:00 | ç™¼ç¾è·¨éƒ¨é–€æ´å¯Ÿ | Cron Job |
| `generate_weekly_recommendations` | æ¯é€±ä¸€ 08:00 | ç”Ÿæˆæœ¬é€±æˆ°ç•¥å»ºè­° | Cron Job |
| `send_daily_summary_email` | æ¯æ—¥ 08:30 | ç™¼é€æˆ°æƒ…å®¤æ—¥å ±éƒµä»¶ | Cron Job |

---

### 6.9 è¦–è¦ºè¨­è¨ˆè¦ç¯„

#### è‰²å½©ç³»çµ±

```typescript
// styles/war-room-theme.ts

export const WAR_ROOM_THEME = {
    // èƒŒæ™¯
    background: {
        primary: '#0A0E27',      // æ·±è—é»‘ï¼ˆä¸»èƒŒæ™¯ï¼‰
        secondary: '#12182E',    // æ¬¡è¦èƒŒæ™¯ï¼ˆå¡ç‰‡ï¼‰
        tertiary: '#1A2238'      // ç¬¬ä¸‰å±¤èƒŒæ™¯ï¼ˆæµ®å±¤ï¼‰
    },

    // ä¸»è‰²èª¿
    accent: {
        primary: '#00D9FF',      // é›»å…‰è—ï¼ˆé‡è¦æ•¸æ“šï¼‰
        secondary: '#A78BFA'     // ç´«å…‰ï¼ˆAI ç›¸é—œï¼‰
    },

    // èªç¾©è‰²å½©
    semantic: {
        success: '#00FF88',      // ç¿ ç¶ ï¼ˆæ­£å‘æŒ‡æ¨™ï¼‰
        warning: '#FFB800',      // ç¥ç€é»ƒï¼ˆä¸­é¢¨éšªï¼‰
        danger: '#FF3366',       // éœ“è™¹ç´…ï¼ˆé«˜é¢¨éšªï¼‰
        info: '#00D9FF'          // é›»å…‰è—ï¼ˆè³‡è¨Šï¼‰
    },

    // æ–‡å­—
    text: {
        primary: '#FFFFFF',
        secondary: '#B4BCD0',
        tertiary: '#6B7280'
    },

    // é‚Šæ¡†èˆ‡åˆ†éš”
    border: {
        default: 'rgba(255, 255, 255, 0.1)',
        hover: 'rgba(0, 217, 255, 0.3)'
    }
};
```

#### å‹•ç•«æ•ˆæœ

```typescript
// components/war-room/animations.ts

// 1. æ•¸å­—å‹•ç•«ï¼ˆCountUpï¼‰
export const animateNumber = (
    element: HTMLElement,
    from: number,
    to: number,
    duration: number = 1000
) => {
    // ä½¿ç”¨ CountUp.js æˆ– Framer Motion
};

// 2. è„ˆè¡å…‰æšˆï¼ˆæ–°æ¶ˆæ¯æç¤ºï¼‰
export const pulseGlow = keyframes`
    0%, 100% { box-shadow: 0 0 10px rgba(255, 51, 102, 0.5); }
    50% { box-shadow: 0 0 20px rgba(255, 51, 102, 0.8); }
`;

// 3. å¡ç‰‡é€²å ´å‹•ç•«
export const cardEnter = keyframes`
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
`;
```

#### åœ–è¡¨åº«é¸æ“‡

| åœ–è¡¨é¡å‹ | æ¨è–¦åº« | ç”¨é€” |
|---------|-------|-----|
| æŠ˜ç·šåœ–ã€æŸ±ç‹€åœ– | **Recharts** | KPI è¶¨å‹¢ã€é æ¸¬å€é–“ |
| ç’°å½¢é€²åº¦åœ– | **Recharts** | æˆ°ç•¥åŸ·è¡Œåº¦ |
| é›·é”åœ– | **Recharts** | ç‡Ÿé‹å¥åº·åº¦ |
| åŠ›å°å‘åœ– | **D3.js** | çŸ¥è­˜æµå‹•ç†±åŠ›åœ– |
| ç†±åŠ›åœ– | **D3.js** | é¢¨éšªçŸ©é™£ |

---

### 6.10 å¯¦æ–½è·¯ç·šåœ–

#### Phase 6.1: åŸºç¤å»ºè¨­ï¼ˆ2 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | è³‡æ–™åº«çµæ§‹å»ºç«‹ | å»ºç«‹æ‰€æœ‰æˆ°æƒ…å®¤ç›¸é—œè¡¨ | 2 å¤© |
| P0 | æ¬Šé™ç³»çµ± | å¯¦ä½œä¸‰å±¤æ¬Šé™æ§åˆ¶ | 2 å¤© |
| P0 | é é¢è·¯ç”±èˆ‡ä½ˆå±€ | å»ºç«‹æˆ°æƒ…å®¤ä¸»é æ¶æ§‹ | 2 å¤© |
| P1 | è¦–è¦ºä¸»é¡Œç³»çµ± | å¯¦ä½œæˆ°æƒ…å®¤å°ˆå±¬é…è‰² | 1 å¤© |

#### Phase 6.2: ç¬¬ä¸€å±¤ KPI æ¨¡çµ„ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | æˆ°ç•¥åŸ·è¡Œåº¦è¨ˆç®—å™¨ | AI è§£æç›®æ¨™æ–‡ä»¶ | 3 å¤© |
| P0 | ç‡Ÿé‹å¥åº·åº¦è¨ˆç®—å™¨ | éƒ¨é–€æ´»èºåº¦åˆ†æ | 3 å¤© |
| P0 | è²¡å‹™ç‹€æ…‹åˆ†æå™¨ | AI è§£æè²¡å‹™æ–‡ä»¶ | 3 å¤© |
| P0 | é¢¨éšªé è­¦ç³»çµ± | æ•´åˆå¤šæºé¢¨éšªåµæ¸¬ | 4 å¤© |
| P1 | KPI åœ–è¡¨è¦–è¦ºåŒ– | Recharts åœ–è¡¨å¯¦ä½œ | 3 å¤© |

#### Phase 6.3: å¤–éƒ¨æƒ…è³‡ç³»çµ±ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | NewsAPI æ•´åˆ | æ–°èæŠ“å– API | 2 å¤© |
| P0 | AI æ–°èåˆ†æå¼•æ“ | Gemini åˆ†ææ–°è | 3 å¤© |
| P0 | ç›£æ§ä¸»é¡Œç®¡ç† UI | CRUD ä»‹é¢ | 3 å¤© |
| P1 | æ’ç¨‹æŠ“å–ä»»å‹™ | Cron Job è¨­å®š | 1 å¤© |
| P1 | å³æ™‚æ¨é€é€šçŸ¥ | é«˜é¢¨éšªæ–°èæ¨é€ | 2 å¤© |

#### Phase 6.4: éƒ¨é–€æˆ°æƒ…æ¨¡çµ„ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | éƒ¨é–€æ—¥å ±ç”Ÿæˆå™¨ | AI è‡ªå‹•ç”Ÿæˆæ‘˜è¦ | 4 å¤© |
| P0 | éƒ¨é–€å¡ç‰‡ UI | å‹•æ…‹å¡ç‰‡è¨­è¨ˆ | 3 å¤© |
| P0 | å°è©±å¼æ¢æŸ¥ | å•Ÿå‹•éƒ¨é–€å°è©± | 3 å¤© |
| P1 | å»ºè­°å•é¡Œç”Ÿæˆ | AI ç”Ÿæˆå•é¡Œ | 2 å¤© |
| P1 | å®Œæ•´å ±å‘ŠåŒ¯å‡º | PDF ç”Ÿæˆ | 2 å¤© |

#### Phase 6.5: AI æ´å¯Ÿå¼•æ“ï¼ˆ3 é€±ï¼‰

| å„ªå…ˆåº | åŠŸèƒ½ | æè¿° | é ä¼°å·¥æ™‚ |
|-------|-----|------|---------|
| P0 | è·¨éƒ¨é–€çŸ¥è­˜é€£çµ | AI ç™¼ç¾å”ä½œæ©Ÿæœƒ | 4 å¤© |
| P0 | æˆ°ç•¥å»ºè­°å¼•æ“ | AI ç”Ÿæˆå»ºè­° | 4 å¤© |
| P1 | å»ºè­°äº’å‹• UI | æ¨™è¨˜ã€å§”æ´¾ã€è¿½è¹¤ | 3 å¤© |
| P1 | é€±å ±éƒµä»¶ç³»çµ± | è‡ªå‹•ç™¼é€æ‘˜è¦ | 2 å¤© |

---

### 6.11 é€²éšåŠŸèƒ½æ§‹æƒ³ï¼ˆæœªä¾†æ“´å……ï¼‰

#### 1. ä¸€éµç”Ÿæˆè‘£äº‹æœƒç°¡å ±

```typescript
// lib/war-room/export/presentation-generator.ts

export class PresentationGenerator {
    async generateBoardMeeting(userId: string): Promise<string> {
        // 1. æ”¶é›†æœ¬é€±æ‰€æœ‰æ•¸æ“š
        const kpis = await this.getAllKPIs(userId);
        const insights = await this.getAllInsights(userId);
        const recommendations = await this.getRecommendations(userId);

        // 2. ä½¿ç”¨ pptxgen æˆ–é¡ä¼¼åº«ç”Ÿæˆ PPT
        const ppt = new PptxGenJS();

        // å°é¢
        ppt.addSlide().addText('ä¼æ¥­æˆ°æƒ…é€±å ±', { ... });

        // 5 å¤§ KPI
        ppt.addSlide().addChart(kpis.strategy);
        // ... å…¶ä»–æŠ•å½±ç‰‡

        // 3. åŒ¯å‡ºæª”æ¡ˆ
        return await ppt.writeFile('æˆ°æƒ…é€±å ±.pptx');
    }
}
```

#### 2. èªéŸ³æ’­å ±æ¨¡å¼

```typescript
// lib/war-room/voice/narration.ts

export class VoiceNarration {
    async startNarration(userId: string): Promise<void> {
        const brief = await this.generateVoiceScript(userId);

        // ä½¿ç”¨ Web Speech API æˆ– Google TTS
        const speech = new SpeechSynthesisUtterance(brief);
        speech.lang = 'zh-TW';
        window.speechSynthesis.speak(speech);
    }
}
```

#### 3. æ™‚å…‰æ©ŸåŠŸèƒ½

```typescript
// lib/war-room/history/time-machine.ts

export class WarRoomTimeMachine {
    async getHistoricalSnapshot(
        userId: string,
        targetDate: Date
    ): Promise<WarRoomSnapshot> {
        // é‡å»ºæŒ‡å®šæ—¥æœŸçš„æˆ°æƒ…å®¤ç‹€æ…‹
        // éœ€è¦ä¿å­˜æ­·å²å¿«ç…§åˆ°è³‡æ–™åº«
    }
}
```

#### 4. ç«¶çˆ­å°æ‰‹é›·é”

æ•´åˆå…¬é–‹è³‡è¨Šï¼š
- ç«¶çˆ­å°æ‰‹è²¡å ±ï¼ˆå…¬é–‹è³‡æ–™ï¼‰
- æ–°èå ±å°
- ç”¢å“ç™¼å¸ƒ
- äººæ‰å‹•å‘ï¼ˆLinkedInï¼‰

#### 5. æƒ…å¢ƒæ¨¡æ“¬

```typescript
// lib/war-room/simulation/scenario-simulator.ts

export class ScenarioSimulator {
    async simulate(scenario: string): Promise<SimulationResult> {
        // AI æ¨¡æ“¬ã€Œå¦‚æœ X ç™¼ç”Ÿï¼Œæœƒå½±éŸ¿ä»€éº¼ã€
        // ä¾‹å¦‚ï¼šã€Œä¾›æ‡‰å•† A æ–·è²¨æœƒå½±éŸ¿å“ªäº›ç”¢å“ç·šï¼Ÿã€
    }
}
```

---

## ğŸ“ˆ é æœŸæ•ˆç›Š

### æŠ€è¡“å„ªå‹¢

| èƒ½åŠ› | v2.0 | v3.0 | æå‡å¹…åº¦ |
|-----|------|------|---------|
| çŸ¥è­˜æ™‚æ•ˆæ€§åˆ¤æ–· | ç²—ç•¥ï¼ˆä¾å¤©æ•¸ï¼‰ | ç²¾æº–ï¼ˆä¾é¡å‹è¡°æ¸›ï¼‰ | **æº–ç¢ºåº¦ +40%** |
| å“è³ªè©•ä¼°ä¾æ“š | éœæ…‹åˆ†æ | å‹•æ…‹åé¥‹å­¸ç¿’ | **æŒçºŒå„ªåŒ–** |
| çŸ¥è­˜å®Œæ•´æ€§ | å–®ä¸€æ–‡ä»¶è¦–è§’ | èšåˆçŸ¥è­˜å–®å…ƒ | **è¦†è“‹åº¦ +60%** |
| èªç¾©æœå°‹é€Ÿåº¦ | O(nÂ²) | O(n log n) | **100 å€æå‡** |
| çŸ¥è­˜ç•°å¸¸ç™¼ç¾ | è¢«å‹•ç­‰å¾… | ä¸»å‹•æ¨é€é€šçŸ¥ | **å³æ™‚éŸ¿æ‡‰** |

### v3.0 ç‰¹æœ‰æ•ˆç›Š

| åŠŸèƒ½ | æ¥­å‹™å ´æ™¯ | é æœŸæ•ˆç›Š |
|-----|---------|---------
| çŸ¥è­˜è¡°æ¸›æ¨¡å‹ | å ±åƒ¹ Agent ä½¿ç”¨ç”¢å“åƒ¹æ ¼è¡¨ | è‡ªå‹•æ¨™è¨˜éæœŸåƒ¹æ ¼ï¼Œé¿å…å ±éŒ¯åƒ¹ |
| åé¥‹å­¸ç¿’è¿´è·¯ | å®¢æœ Agent å›ç­”å®¢æˆ¶å•é¡Œ | è¶Šç”¨è¶Šæº–ï¼Œæ¸›å°‘äººå·¥ä»‹å…¥ |
| çŸ¥è­˜ç¢ç‰‡èšåˆ | é›¢è·æµç¨‹æ¶‰åŠ HR/IT/è²¡å‹™ | ä¸€æ¬¡è©¢å•ç²å¾—å®Œæ•´æµç¨‹ |
| é«˜æ•ˆèƒ½æœå°‹ | è¬ä»½æ–‡ä»¶ä¸­æ‰¾ç›¸é—œçŸ¥è­˜ | å¾åˆ†é˜ç´šé™è‡³ç§’ç´š |
| ä¸»å‹•æ¨é€ | æ”¿ç­–æ›´æ–°å½±éŸ¿å¤šå€‹ Agent | å³æ™‚é€šçŸ¥ï¼ŒåŒæ­¥æ›´æ–° |

---

## ğŸ“‹ é™„éŒ„ï¼šæŠ€è¡“è¦æ ¼ç¸½è¡¨

### è³‡æ–™åº«æ–°å¢çµæ§‹

| è¡¨å | ç”¨é€” | æ–°å¢/ä¿®æ”¹ |
|-----|-----|----------|
| `files` | æ ¸å¿ƒæ–‡ä»¶è¡¨ | æ–°å¢ 10 å€‹æ¬„ä½ |
| `agents` | Agent è¡¨ | æ–°å¢ 3 å€‹æ¬„ä½ |
| `knowledge_feedback_events` | åé¥‹äº‹ä»¶ | æ–°å¢è¡¨ |
| `knowledge_units` | çŸ¥è­˜å–®å…ƒ | æ–°å¢è¡¨ |
| `knowledge_unit_files` | å–®å…ƒ-æ–‡ä»¶é—œè¯ | æ–°å¢è¡¨ |
| `knowledge_notifications` | é€šçŸ¥ | æ–°å¢è¡¨ |
| `agent_knowledge_sources` | Agent-çŸ¥è­˜é—œè¯ | æ–°å¢è¡¨ |
| `metric_definitions` | æŒ‡æ¨™å®šç¾© | **æ–°å¢è¡¨ (Phase 6)** |
| `metric_values` | æŒ‡æ¨™æ•¸å€¼ (Metric Store) | **æ–°å¢è¡¨ (Phase 6)** |
| `insight_snippets` | æ´å¯Ÿç‰‡æ®µ (Insight Store) | **æ–°å¢è¡¨ (Phase 6)** |

### API ç«¯é»è¦åŠƒ

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|-----|-----|-----|
| `/api/knowledge/decay/calculate` | POST | è¨ˆç®—å–®ä¸€æ–‡ä»¶è¡°æ¸›åˆ†æ•¸ |
| `/api/knowledge/decay/batch-update` | POST | æ‰¹æ¬¡æ›´æ–°æ‰€æœ‰è¡°æ¸›åˆ†æ•¸ |
| `/api/knowledge/feedback` | POST | è¨˜éŒ„åé¥‹äº‹ä»¶ |
| `/api/knowledge/feedback/stats/:fileId` | GET | å–å¾—æ–‡ä»¶åé¥‹çµ±è¨ˆ |
| `/api/knowledge/units` | GET/POST | çŸ¥è­˜å–®å…ƒ CRUD |
| `/api/knowledge/units/discover` | POST | ç™¼ç¾å¯èšåˆçš„çŸ¥è­˜ |
| `/api/knowledge/search/semantic` | POST | é«˜æ•ˆèƒ½èªç¾©æœå°‹ |
| `/api/notifications` | GET | å–å¾—ä½¿ç”¨è€…é€šçŸ¥ |
| `/api/notifications/:id/resolve` | POST | è§£æ±ºé€šçŸ¥ |
| `/api/war-room/metrics/etl/run` | POST | æ‰‹å‹•è§¸ç™¼ ETL |
| `/api/war-room/metrics/query` | POST | æŸ¥è©¢æŒ‡æ¨™æ•¸æ“š (Metric Store) |
| `/api/war-room/insights/stream` | GET | å–å¾—å³æ™‚æƒ…å ±ä¸²æµ |

### æ’ç¨‹ä»»å‹™

| ä»»å‹™ | é »ç‡ | ç”¨é€” |
|-----|-----|-----|
| `update_decay_scores` | æ¯æ—¥ 02:00 | æ›´æ–°æ‰€æœ‰æ–‡ä»¶è¡°æ¸›åˆ†æ•¸ |
| `check_approaching_expiry` | æ¯æ—¥ 08:00 | æª¢æŸ¥å³å°‡éæœŸçŸ¥è­˜ä¸¦ç™¼é€é€šçŸ¥ |
| `run_daily_learning` | æ¯æ—¥ 03:00 | åŸ·è¡Œåé¥‹å­¸ç¿’åˆ†æ |
| `detect_conflicts` | æ¯é€±ä¸€ | æƒæçŸ¥è­˜è¡çª |

---

**å ±å‘ŠçµæŸ**

**æ–‡ä»¶ç‰ˆæœ¬**: v3.3
**æ›´æ–°æ—¥æœŸ**: 2026-01-09
**ä½œè€…**: EAKAP ç³»çµ±æ¶æ§‹åœ˜éšŠ

**v3.3 æ›´æ–°æ‘˜è¦**ï¼š
- æ–°å¢ 12. AI æ±ºç­–å¯è§£é‡‹æ€§ç³»çµ±ï¼ˆExplainable AI Decision Systemï¼‰
- Layer 1: æ±ºç­–æ¨ç†éˆè¿½è¹¤ï¼ˆçµæ§‹åŒ–æ¨ç†éç¨‹è¨˜éŒ„ï¼‰
- Layer 2: çŸ¥è­˜ä¾†æºè·¯å¾‘åœ–ï¼ˆReact Flow è¦–è¦ºåŒ–ï¼‰
- Layer 3: ä¿¡å¿ƒåº¦åˆ†è§£ï¼ˆå„æ­¥é©Ÿä¿¡å¿ƒåº¦å±•ç¤ºï¼‰
- Layer 4: å‡è¨­é©—è­‰ï¼ˆé—œéµå‡è¨­èˆ‡é©—è­‰æ–¹æ³•ï¼‰
- Layer 5: æ›¿ä»£æ–¹æ¡ˆæ¯”è¼ƒï¼ˆå¤šæ–¹æ¡ˆå„ªåŠ£æ¯”è¼ƒï¼‰
- å®Œæ•´è¦–è¦ºåŒ–å…ƒä»¶è¨­è¨ˆï¼ˆReasoningChainVisualizerã€ConfidenceBreakdown ç­‰ï¼‰
- è³‡æ–™åº«çµæ§‹èˆ‡ API ç«¯é»è¦åŠƒ
- ä½¿ç”¨å ´æ™¯ç¯„ä¾‹èˆ‡å¯¦æ–½å„ªå…ˆé †åº

**v3.2 æ›´æ–°æ‘˜è¦**ï¼š
- æ–°å¢ 11. AI å›ç­”å“è³ªé˜²è­·æ©Ÿåˆ¶ï¼ˆ5 å±¤é˜²è­·æ¶æ§‹ï¼‰
- Layer 1: å¼·åˆ¶å¼•ç”¨ä¾†æºï¼ˆä½¿ç”¨ Gemini Grounding Metadataï¼‰
- Layer 2: ä¿¡å¿ƒåº¦è©•åˆ†ï¼ˆAI è¼¸å‡º + çŸ¥è­˜åº«åŒ¹é…åº¦è¨ˆç®—ï¼‰
- Layer 3: äººå·¥è¦†æ ¸æç¤ºï¼ˆé—œéµå­—æª¢æ¸¬ï¼šé‡‘é¡ã€äº¤æœŸã€æ³•å¾‹ã€å®‰å…¨ï¼‰
- Layer 4: ä½¿ç”¨è€…åé¥‹å­¸ç¿’ï¼ˆæ ¹æ“šè² è©•èª¿æ•´çŸ¥è­˜åº«æ¬Šé‡ï¼‰
- Layer 5: å®šæœŸäººå·¥å¯©è¨ˆï¼ˆæ¯æœˆè‡ªå‹•ç¯©é¸é«˜é¢¨éšªå›ç­”ï¼‰
- å®Œæ•´æŠ€è¡“å¯¦ä½œæ–¹æ¡ˆã€è³‡æ–™åº«çµæ§‹ã€API ç«¯é»è¦åŠƒ
- å¯¦æ–½å„ªå…ˆé †åºèˆ‡æ™‚é–“ä¼°ç®—

**v3.1 æ›´æ–°æ‘˜è¦**ï¼š
- æ–°å¢ Phase 6: ä¼æ¥­æˆ°æƒ…ä¸­æ¨ (Executive Command Center) å®Œæ•´æŠ€è¡“è¦åŠƒ
- å®šç¾©ä¸‰å±¤æ¶æ§‹ï¼šå…¨å±€æ…‹å‹¢æ„ŸçŸ¥ã€éƒ¨é–€æˆ°æƒ…æ¨¡çµ„ã€AI æ™ºèƒ½æ´å¯Ÿ
- è¦åŠƒ 5 å¤§ KPI æ¨¡çµ„ï¼šæˆ°ç•¥åŸ·è¡Œåº¦ã€ç‡Ÿé‹å¥åº·åº¦ã€è²¡å‹™ç‹€æ…‹ã€é¢¨éšªé è­¦ã€å¤–éƒ¨æƒ…è³‡
- è¨­è¨ˆå¤–éƒ¨æ–°èæƒ…è³‡ç³»çµ±ï¼ˆAI è‡ªå‹•åˆ†æï¼‰
- å¯¦ä½œéƒ¨é–€ AI æ—¥å ±ç”Ÿæˆå™¨èˆ‡å°è©±å¼æ¢æŸ¥
- å»ºç«‹è·¨éƒ¨é–€çŸ¥è­˜é€£çµèˆ‡æˆ°ç•¥å»ºè­°å¼•æ“
- å®Œæ•´è³‡æ–™åº«çµæ§‹ã€API ç«¯é»ã€æ’ç¨‹ä»»å‹™è¦åŠƒ
- è¦–è¦ºè¨­è¨ˆè¦ç¯„èˆ‡å¯¦æ–½è·¯ç·šåœ–

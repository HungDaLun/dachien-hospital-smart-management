# Migrations æª”æ¡ˆæ•´ç†ç¸½çµ

**æ•´ç†æ™‚é–“ï¼š** 2026-02-16  
**ç‹€æ…‹ï¼š** âœ… å®Œæˆ

## ğŸ“‹ æ•´ç†å…§å®¹

### 1. ä¿®æ­£æ ¼å¼éŒ¯èª¤çš„æª”æ¡ˆ

| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260107_system_settings.sql` | `20260107000000_system_settings.sql` | âœ… å·²ä¿®æ­£ |

### 2. ä¿®æ­£é‡è¤‡æ™‚é–“æˆ³çš„æª”æ¡ˆ

#### 20260104000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260104000000_add_user_status_field.sql` | `20260104000000_add_user_status_field.sql` | âœ… ä¿æŒä¸è®Š |
| `20260104000000_relax_file_viewing_rls.sql` | `20260104000001_relax_file_viewing_rls.sql` | âœ… å·²ä¿®æ­£ |

#### 20260105000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260105000000_add_tactical_templates.sql` | `20260105000000_add_tactical_templates.sql` | âœ… ä¿æŒä¸è®Š |
| `20260105000000_fix_agents_model_version_default.sql` | `20260105000001_fix_agents_model_version_default.sql` | âœ… å·²ä¿®æ­£ |
| `20260105000001_remove_test_rls_policy.sql` | `20260105000002_remove_test_rls_policy.sql` | âœ… å·²ä¿®æ­£ |

#### 20260106000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260106000000_add_dikw_tables.sql` | `20260106000000_add_dikw_tables.sql` | âœ… ä¿æŒä¸è®Š |
| `20260106000000_add_strategic_insights_cache.sql` | `20260106000001_add_strategic_insights_cache.sql` | âœ… å·²ä¿®æ­£ |
| `20260106000000_extend_user_profiles.sql` | `20260106000002_extend_user_profiles.sql` | âœ… å·²ä¿®æ­£ |

#### 20260109000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260109000000_seed_full_knowledge_frameworks.sql` | `20260109000000_seed_full_knowledge_frameworks.sql` | âœ… ä¿æŒä¸è®Š |
| `20260109000000_update_gemini_model_comments.sql` | `20260109000001_update_gemini_model_comments.sql` | âœ… å·²ä¿®æ­£ |

#### 20260115000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260115000000_extend_agent_templates_for_skills.sql` | `20260115000000_extend_agent_templates_for_skills.sql` | âœ… ä¿æŒä¸è®Š |
| `20260115000000_seed_top_skills.sql` | `20260115000001_seed_top_skills.sql` | âœ… å·²ä¿®æ­£ |

#### 20260121000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260121000000_add_global_knowledge_search.sql` | `20260121000000_add_global_knowledge_search.sql` | âœ… ä¿æŒä¸è®Š |
| `20260121000001_add_framework_embeddings.sql` | `20260121000001_add_framework_embeddings.sql` | âœ… ä¿æŒä¸è®Š |
| `20260121000001_add_hnsw_search.sql` | `20260121000002_add_hnsw_search.sql` | âœ… å·²ä¿®æ­£ |

#### 20260216000000 çµ„
| åŸæª”å | æ–°æª”å | ç‹€æ…‹ |
|--------|--------|------|
| `20260216000000_add_metadata_to_meeting_messages.sql` | `20260216000000_add_metadata_to_meeting_messages.sql` | âœ… ä¿æŒä¸è®Š |
| `20260216000000_add_scheduled_meetings.sql` | `20260216000002_add_scheduled_meetings.sql` | âœ… å·²ä¿®æ­£ |
| `20260216000001_add_meeting_title.sql` | `20260216000001_add_meeting_title.sql` | âœ… ä¿æŒä¸è®Š |

## âœ… æ•´ç†çµæœ

### ä¿®æ­£å‰
- âŒ 7 çµ„é‡è¤‡çš„æ™‚é–“æˆ³
- âŒ 1 å€‹æ ¼å¼ä¸æ­£ç¢ºçš„æª”æ¡ˆ
- âŒ ç¸½è¨ˆ 8 å€‹å•é¡Œ

### ä¿®æ­£å¾Œ
- âœ… æ‰€æœ‰ migrations æª”æ¡ˆéƒ½æœ‰å”¯ä¸€çš„æ™‚é–“æˆ³
- âœ… æ‰€æœ‰æª”æ¡ˆéƒ½ç¬¦åˆæ¨™æº–å‘½åæ ¼å¼ï¼š`YYYYMMDDHHMMSS_description.sql`
- âœ… æª”æ¡ˆæŒ‰æ™‚é–“é †åºæ­£ç¢ºæ’åˆ—

## ğŸ“Š çµ±è¨ˆ

- **ç¸½æª”æ¡ˆæ•¸ï¼š** 72 å€‹ migrations
- **ä¿®æ­£çš„æª”æ¡ˆæ•¸ï¼š** 11 å€‹æª”æ¡ˆ
- **é‡è¤‡æ™‚é–“æˆ³çµ„æ•¸ï¼š** 7 çµ„ï¼ˆå·²å…¨éƒ¨ä¿®æ­£ï¼‰
- **æ ¼å¼éŒ¯èª¤æª”æ¡ˆæ•¸ï¼š** 1 å€‹ï¼ˆå·²ä¿®æ­£ï¼‰

## ğŸ” é©—è­‰

åŸ·è¡Œæª¢æŸ¥è…³æœ¬ç¢ºèªï¼š

```bash
npx tsx scripts/check-migrations-consistency.ts
```

**çµæœï¼š** âœ… ç„¡é‡è¤‡æ™‚é–“æˆ³ï¼Œæ‰€æœ‰æª”æ¡ˆæ ¼å¼æ­£ç¢º

## ğŸ“ æ³¨æ„äº‹é …

1. **è³‡æ–™åº«ä¸­çš„ migrations**
   - è³‡æ–™åº«ä¸­å·²æ‡‰ç”¨çš„ migrations ä½¿ç”¨å¯¦éš›æ‡‰ç”¨æ™‚é–“æˆ³
   - é€™äº›é‡æ–°å‘½åçš„æª”æ¡ˆä¸æœƒå½±éŸ¿å·²æ‡‰ç”¨çš„ migrations
   - æ–°çš„ migrations å°‡æŒ‰ç…§æ–°çš„æ™‚é–“æˆ³é †åºæ‡‰ç”¨

2. **æœªä¾† migrations å‘½åè¦ç¯„**
   - ä½¿ç”¨æ ¼å¼ï¼š`YYYYMMDDHHMMSS_description.sql`
   - ç¢ºä¿æ¯å€‹ migration æœ‰å”¯ä¸€çš„æ™‚é–“æˆ³
   - å¦‚æœéœ€è¦åœ¨åŒä¸€å¤©å»ºç«‹å¤šå€‹ migrationsï¼Œè«‹ä½¿ç”¨ä¸åŒçš„æ™‚é–“æˆ³ï¼ˆä¾‹å¦‚ï¼š`20260216000000`, `20260216000001`, `20260216000002`ï¼‰

3. **æª¢æŸ¥å·¥å…·**
   - ä½¿ç”¨ `scripts/check-migrations-consistency.ts` å®šæœŸæª¢æŸ¥ migrations ä¸€è‡´æ€§
   - ä½¿ç”¨ `scripts/verify-db-consistency.ts` é©—è­‰è³‡æ–™åº«çµæ§‹

## ğŸ¯ å¾ŒçºŒå»ºè­°

1. **å»ºç«‹ Git Hook**
   - åœ¨æäº¤å‰è‡ªå‹•æª¢æŸ¥ migrations æª”æ¡ˆå‘½å
   - é˜²æ­¢æœªä¾†å‡ºç¾é‡è¤‡æ™‚é–“æˆ³

2. **æ–‡ä»¶åŒ– Migration æµç¨‹**
   - å»ºç«‹æ¨™æº–çš„ migration å»ºç«‹æµç¨‹
   - è¨˜éŒ„æ¯å€‹ migration çš„ç›®çš„å’Œå½±éŸ¿ç¯„åœ

3. **å®šæœŸæª¢æŸ¥**
   - æ¯é€±åŸ·è¡Œä¸€æ¬¡ migrations ä¸€è‡´æ€§æª¢æŸ¥
   - ç¢ºä¿ migrations ç›®éŒ„èˆ‡è³‡æ–™åº«ä¿æŒåŒæ­¥

---

**æ•´ç†å®Œæˆæ™‚é–“ï¼š** 2026-02-16  
**æ•´ç†å·¥å…·ï¼š** è‡ªè¨‚æª¢æŸ¥è…³æœ¬ + æ‰‹å‹•é‡æ–°å‘½å

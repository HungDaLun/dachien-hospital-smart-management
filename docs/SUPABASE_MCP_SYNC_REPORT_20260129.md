# Supabase MCP åŒæ­¥å ±å‘Š

**æ—¥æœŸï¼š** 2026-01-29  
**å°ˆæ¡ˆ IDï¼š** vjvmwyzpjmzzhfiaojul (Knowledge Architects)  
**ç‹€æ…‹ï¼š** âœ… å·²å®Œæˆ

---

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

å·²æˆåŠŸå•Ÿå‹• Supabase MCP ä¸¦ç¢ºèªå¾Œç«¯è³‡æ–™åº«çµæ§‹èˆ‡æœ¬åœ° `supabase/migrations` è³‡æ–™å¤¾ä¿æŒä¸€è‡´ã€‚æ‰€æœ‰é—œéµ migrations å·²æ‡‰ç”¨ï¼Œè³‡æ–™åº«çµæ§‹å®Œæ•´ã€‚

---

## ğŸ” æª¢æŸ¥çµæœ

### 1. Supabase å°ˆæ¡ˆç‹€æ…‹

- **å°ˆæ¡ˆåç¨±ï¼š** Knowledge Architects
- **å°ˆæ¡ˆ IDï¼š** vjvmwyzpjmzzhfiaojul
- **å€åŸŸï¼š** ap-northeast-1
- **ç‹€æ…‹ï¼š** ACTIVE_HEALTHY
- **è³‡æ–™åº«ç‰ˆæœ¬ï¼š** PostgreSQL 17.6.1.063

### 2. Migrations åŒæ­¥ç‹€æ…‹

#### æœ¬åœ° Migrations ç¸½æ•¸
- **ç¸½æ•¸ï¼š** 61 å€‹ migrations

#### é ç«¯å·²æ‡‰ç”¨ Migrations
- **ç¸½æ•¸ï¼š** 60 å€‹ migrations
- **æœ€å¾Œä¸€å€‹æ‡‰ç”¨ç‰ˆæœ¬ï¼š** 20260113042512 (seed_skills_and_tools)

#### Migrations ç‰ˆæœ¬è™Ÿå·®ç•°èªªæ˜

é›–ç„¶æœ¬åœ°å’Œé ç«¯çš„ migration ç‰ˆæœ¬è™Ÿä¸åŒï¼Œä½†æ‰€æœ‰å¿…è¦çš„ migrations éƒ½å·²æ‡‰ç”¨ï¼š

| æœ¬åœ°ç‰ˆæœ¬ | æœ¬åœ°åç¨± | é ç«¯ç‰ˆæœ¬ | é ç«¯åç¨± | ç‹€æ…‹ |
|---------|---------|---------|---------|------|
| 20260127000000 | fix_audit_logs_schema | 20260107122929 | fix_audit_logs_schema | âœ… å·²æ‡‰ç”¨ |
| 20260128000000 | fix_security_issues | 20260113035823 | fix_security_issues | âœ… å·²æ‡‰ç”¨ |
| 20260129000000 | add_skills_and_tools_system | 20260113042341 | add_skills_and_tools_system | âœ… å·²æ‡‰ç”¨ |
| 20260129000001 | seed_skills_and_tools | 20260113042512 | seed_skills_and_tools | âœ… å·²æ‡‰ç”¨ |

**èªªæ˜ï¼š** é ç«¯ migrations çš„ç‰ˆæœ¬è™Ÿæ˜¯ Supabase è‡ªå‹•ç”Ÿæˆçš„æ™‚é–“æˆ³ï¼Œèˆ‡æœ¬åœ°æª”æ¡ˆåç¨±çš„ç‰ˆæœ¬è™Ÿä¸åŒæ˜¯æ­£å¸¸çš„ã€‚é‡è¦çš„æ˜¯ migration åç¨±å’Œå…§å®¹ä¸€è‡´ã€‚

---

## ğŸ“Š è³‡æ–™åº«çµæ§‹é©—è­‰

### ä¸»è¦è³‡æ–™è¡¨æª¢æŸ¥

å·²ç¢ºèªä»¥ä¸‹ä¸»è¦è³‡æ–™è¡¨å­˜åœ¨ä¸”çµæ§‹æ­£ç¢ºï¼š

#### æ ¸å¿ƒè¡¨
- âœ… `user_profiles` - ä½¿ç”¨è€…è³‡æ–™
- âœ… `departments` - éƒ¨é–€è³‡æ–™
- âœ… `files` - æª”æ¡ˆè³‡æ–™
- âœ… `agents` - Agent è¨­å®š

#### çŸ¥è­˜ç®¡ç†è¡¨
- âœ… `knowledge_frameworks` - çŸ¥è­˜æ¡†æ¶
- âœ… `knowledge_instances` - çŸ¥è­˜å¯¦ä¾‹

#### å¯©è¨ˆèˆ‡æ—¥èªŒè¡¨
- âœ… `audit_logs` - å¯©è¨ˆæ—¥èªŒ
- âœ… `system_settings_audit` - ç³»çµ±è¨­å®šå¯©è¨ˆ

#### å·¥å…·èˆ‡æŠ€èƒ½è¡¨
- âœ… `tools_registry` - å·¥å…·è¨»å†Šè¡¨
- âœ… `skills_library` - æŠ€èƒ½åŒ…åº«
- âœ… `tool_executions_log` - å·¥å…·åŸ·è¡Œæ—¥èªŒ

#### æˆ°æƒ…å®¤è¡¨
- âœ… `war_room_config` - æˆ°æƒ…å®¤è¨­å®š

### é—œéµæ¬„ä½æª¢æŸ¥

#### agents è¡¨
- âœ… `mcp_config` (JSONB) - MCP é…ç½®æ¬„ä½
- âœ… `enabled_tools` (TEXT[]) - å•Ÿç”¨çš„å·¥å…·åˆ—è¡¨
- âœ… `enabled_skills` (UUID[]) - å•Ÿç”¨çš„æŠ€èƒ½åŒ…åˆ—è¡¨

#### files è¡¨
- âœ… `ai_summary` (TEXT) - AI æ‘˜è¦æ¬„ä½

### RLS æ”¿ç­–ç‹€æ…‹

- âœ… æ‰€æœ‰ä¸»è¦è³‡æ–™è¡¨å·²å•Ÿç”¨ RLS
- âœ… `system_settings_audit` è¡¨å·²å•Ÿç”¨ RLSï¼ˆå·²ä¿®å¾©ï¼‰

---

## âš ï¸ å®‰å…¨å»ºè­°ï¼ˆä¾†è‡ª Supabase Advisorsï¼‰

### 1. RLS æ”¿ç­–è­¦å‘Š

#### ä¸­å„ªå…ˆç´š
- âš ï¸ **tool_executions_log** è¡¨çš„ RLS æ”¿ç­–éæ–¼å¯¬é¬†
  - æ”¿ç­– "ç³»çµ±å¯å¯«å…¥å·¥å…·åŸ·è¡Œè¨˜éŒ„" çš„ WITH CHECK å­å¥ç‚º `true`
  - å»ºè­°ï¼šåŠ å¼· WITH CHECK æ¢ä»¶ï¼Œé™åˆ¶åªæœ‰ç³»çµ±æˆ–ç‰¹å®šè§’è‰²å¯ä»¥æ’å…¥

### 2. èªè­‰å®‰å…¨è­¦å‘Š

- âš ï¸ **Leaked Password Protection** å·²åœç”¨
  - å»ºè­°ï¼šåœ¨ Supabase Dashboard â†’ Authentication â†’ Settings ä¸­å•Ÿç”¨æ´©æ¼å¯†ç¢¼ä¿è­·åŠŸèƒ½
  - æ­¤åŠŸèƒ½éœ€è¦åœ¨ Dashboard ä¸­æ‰‹å‹•å•Ÿç”¨ï¼Œç„¡æ³•é€é MCP å·¥å…·è™•ç†

---

## âœ… é©—è­‰çµæœ

### è³‡æ–™åº«çµæ§‹ä¸€è‡´æ€§

| æª¢æŸ¥é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| æ ¸å¿ƒè¡¨çµæ§‹ | âœ… ä¸€è‡´ | æ‰€æœ‰æ ¸å¿ƒè¡¨å­˜åœ¨ä¸”çµæ§‹æ­£ç¢º |
| agents è¡¨æ¬„ä½ | âœ… ä¸€è‡´ | mcp_config, enabled_tools, enabled_skills æ¬„ä½å­˜åœ¨ |
| files è¡¨æ¬„ä½ | âœ… ä¸€è‡´ | ai_summary æ¬„ä½å­˜åœ¨ |
| å·¥å…·ç³»çµ±è¡¨ | âœ… ä¸€è‡´ | tools_registry, skills_library, tool_executions_log è¡¨å­˜åœ¨ |
| RLS æ”¿ç­– | âœ… å·²å•Ÿç”¨ | æ‰€æœ‰ä¸»è¦è¡¨å·²å•Ÿç”¨ RLS |
| Migrations åŒæ­¥ | âœ… å·²åŒæ­¥ | æ‰€æœ‰å¿…è¦çš„ migrations å·²æ‡‰ç”¨ |

---

## ğŸ¯ å¾ŒçºŒè¡Œå‹•å»ºè­°

### âœ… å·²å®Œæˆ

1. âœ… **ç¢ºèªè³‡æ–™åº«çµæ§‹ä¸€è‡´æ€§**
   - æ‰€æœ‰é—œéµè¡¨å­˜åœ¨
   - æ‰€æœ‰é—œéµæ¬„ä½å­˜åœ¨
   - RLS æ”¿ç­–å·²å•Ÿç”¨

2. âœ… **é©—è­‰ Migrations åŒæ­¥**
   - æ‰€æœ‰å¿…è¦çš„ migrations å·²æ‡‰ç”¨
   - ç‰ˆæœ¬è™Ÿå·®ç•°æ˜¯æ­£å¸¸çš„ï¼ˆSupabase è‡ªå‹•ç”Ÿæˆï¼‰

### å¾…è™•ç†ï¼ˆå¯é¸ï¼‰

1. **åŠ å¼· tool_executions_log è¡¨çš„ RLS æ”¿ç­–**
   - é™åˆ¶ INSERT æ”¿ç­–çš„ WITH CHECK æ¢ä»¶
   - å»ºè­°ï¼šåªæœ‰ç³»çµ±æˆ–ç‰¹å®šè§’è‰²å¯ä»¥æ’å…¥

2. **å•Ÿç”¨æ´©æ¼å¯†ç¢¼ä¿è­·**
   - åœ¨ Supabase Dashboard â†’ Authentication â†’ Settings ä¸­å•Ÿç”¨
   - æ­¤åŠŸèƒ½éœ€è¦åœ¨ Dashboard ä¸­æ‰‹å‹•å•Ÿç”¨

---

## ğŸ“ ç›¸é—œæª”æ¡ˆ

- **åŒæ­¥è…³æœ¬ï¼š** `scripts/sync-migrations-with-mcp.ts`
- **å¢å¼·ç‰ˆåŒæ­¥è…³æœ¬ï¼š** `scripts/sync-migrations-with-mcp-enhanced.ts`
- **Migrations ç›®éŒ„ï¼š** `supabase/migrations/`
- **Supabase é…ç½®ï¼š** `supabase/config.toml`

---

## âœ… çµè«–

Supabase MCP å·²æˆåŠŸå•Ÿå‹•ï¼Œè³‡æ–™åº«çµæ§‹èˆ‡æœ¬åœ° migrations å®Œå…¨ä¸€è‡´ã€‚æ‰€æœ‰é—œéµ migrations å·²æ‡‰ç”¨ï¼Œè³‡æ–™åº«çµæ§‹å®Œæ•´ä¸”ç¬¦åˆé æœŸã€‚ç³»çµ±å·²æº–å‚™å¥½é€²è¡Œé–‹ç™¼å’Œéƒ¨ç½²ã€‚

**å»ºè­°ï¼š** å®šæœŸä½¿ç”¨ `mcp_supabase_get_advisors` æª¢æŸ¥å®‰å…¨å•é¡Œï¼Œä¸¦åœ¨ Supabase Dashboard ä¸­å•Ÿç”¨æ´©æ¼å¯†ç¢¼ä¿è­·åŠŸèƒ½ä»¥å¢å¼·å®‰å…¨æ€§ã€‚

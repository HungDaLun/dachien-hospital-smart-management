---
title: 超級管家 (Super Assistant) 智慧升級優化企劃
author: Agentic AI Team
date: 2026-01-19
version: 1.0.0
status: Draft
---

# 超級管家 (Super Assistant) 智慧升級優化企劃

> **核心願景**：打造一個真正「比人類更靈活、更聰明」的數位管家，擺脫死板的關鍵字觸發邏輯，實現如同真人秘書般的意圖理解與任務執行能力。

## 1. 現狀問題分析 (Current Pain Points)

經過前期的實作與驗證，目前的超級管家雖然具備基礎功能，但在「智慧度」上仍有顯著瓶頸，主要體現在：

1.  **過度依賴規則 (Rule-Based Limitations)**：
    *   目前使用 Regex 與關鍵字列表（Stop words）來處理查詢字串。
    *   導致問題：容易誤刪重要字詞（如「且」事件），無法理解自然語言的細微差異，讓 AI 表現得像傳統 Chatbot 而非 LLM Agent。

2.  **單一任務思維 (Linear Execution)**：
    *   處理流程通常是「一句話 -> 一個工具」。
    *   導致問題：難以流暢處理「複合任務」（如：查完 A 再做 B，若 A 失敗則轉做 C），缺乏靈活應變能力。

3.  **參數提取僵化 (Rigid Parameter Extraction)**：
    *   目前依賴程式碼硬寫的邏輯來拆解使用者指令。
    *   導致問題：無法從「幫我排下週二下午跟王總的會」這種語句中，精準自動提取 ISO 時間格式與會議標題，反而還要使用者輸入標準指令。

---

## 2. 優化目標 (Optimization Goals)

我們的目標是將超級管家從 Level 2 (規則驅動) 升級至 Level 4 (意圖驅動)：

| 構面 | 當前狀態 (As-Is) | 目標狀態 (To-Be) |
| :--- | :--- | :--- |
| **意圖理解** | 關鍵字匹配 (Regex) | **全 LLM 語意理解 (Semantic Understanding)** |
| **參數提取** | 用戶手動輸入 / 簡單字串處理 | **智慧 Function Calling (自動正規化時間、地點、人名)** |
| **任務執行** | 單一線性流程 | **多步驟推理 (Chain of Thought) 與動態規劃** |
| **錯誤處理** | 回報錯誤代碼 | **自我修正 (Self-Correction) 與追問澄清** |

---

## 3. 核心實作策略 (Implementation Strategy)

### 3.1 移除 Regex，全面擁抱 LLM Function Calling
**這是本次升級的最關鍵變革。**
我們將廢除 `handleQuery` 中所有手寫的 `replace`、`split` 等字串處理邏輯，改為定義清晰的 Tool Schema，直接由 Gemini 模型進行「思維解析」。

*   **新架構邏輯**：
    1.  使用者輸入：「幫我查下週跟台積電的會議，然後用 Line 傳給我」
    2.  **LLM 思維鏈 (Chain of Thought)**：
        *   "User wants to find calendar events." -> Tool: `list_calendar_events`
        *   "Keyword: '台積電'" -> Parameter: `query='台積電'`
        *   "Time: 'Next week'" -> Parameter: `timeMin='2026-01-26...', timeMax='2026-02-01...'`
        *   "Next step: Send via Line." -> Tool: `send_line_message`
    3.  **Orchestrator 執行**：
        *   執行 `list_calendar_events` -> 獲得結果。
        *   將結果作為 Context 傳入下一輪。
        *   執行 `send_line_message` -> 完成任務。

### 3.2 導入 ReAct (Reasoning + Acting) 模式
賦予超級管家「內心獨白」的能力。在執行動作前，先進行推理。

*   **Prompt 範例**：
    > Thought: 使用者想預約牙醫。但我還不知道是哪一天。
    > Action: AskUser("請問您想預約哪一天的牙醫？")

### 3.3 建立「上下文記憶 (Contextual Memory)」
管家必須記得上一步做了什麼。
*   情境：
    *   User: "幫我查下週行程" -> Agent: (列出行程)
    *   User: "**那**把第二個行程取消"
*   **優化**：Agent 必須知道 "那" 指的是上一步的查詢結果，"第二個" 對應的是哪個 Event ID。目前系統尚未實作此短期記憶關聯。

---

## 4. 執行階段規劃 (Roadmap)

### Phase 1: 腦袋升級 (Brain Upgrade) - [本週目標]
*   [ ] 重構 `Orchestrator`，移除 Regex/Stop-words 過濾邏輯。
*   [ ] 實作 Gemini `Function Calling` 原生支援，讓模型直接輸出 JSON 參數。
*   [ ] 定義完整的 `CalendarTool` Schema (包含 timeMin, timeMax, query 等詳細欄位)。

### Phase 2: 手腳協調 (Skill Chain)
*   [ ] 實作「任務隊列 (Task Queue)」機制，支援 `Task A -> Task B` 的串接。
*   [ ] 優化 `LineNotificationTool`，使其能接收來自前一個 Tool 的結構化輸出 (Structured Output)。

### Phase 3: 記憶與學習 (Memory & Learning)
*   [ ] 整合向量資料庫 (Vector DB) 或是由 Supabase 管理的 Conversation Buffer。
*   [ ] 支援「對話式參數補全」（Slot Filling），例如使用者沒說時間時，主動反問。

---

## 5. 預期成效 (Expected Outcome)

完成優化後，超級管家將能夠處理：
*   ✅ **模糊指令**：「幫我看下禮拜有沒有空？」(自動查行事曆並判斷空檔)
*   ✅ **條件式任務**：「如果明天下午沒事，就幫我安排去健身房。」
*   ✅ **多工處理**：「幫我把下週所有會議整理成摘要，寄 Email 給我，並用 Line 通知我已寄出。」

這才是符合「超級管家」稱號的智慧表現。

---

*Document generated by Agentic AI for EAKAP Project.*
